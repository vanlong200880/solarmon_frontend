{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import BaseComponent from'../../../../BaseComponent';import Libs from'../../../../../utils/Libs';import Constants from'../../../../../utils/Constants';import AddDevicePopupJsx from'./AddDevicePopup.jsx';import AddDevicePopupValidate from'./AddDevicePopupValidate';import DeviceTypeService from'../../../../../services/DeviceTypeService';import DeviceGroupService from'../../../../../services/DeviceGroupService';import DeviceService from'../../../../../services/DeviceService';var AddDevicePopup=/*#__PURE__*/function(_BaseComponent){_inherits(AddDevicePopup,_BaseComponent);var _super=_createSuper(AddDevicePopup);function AddDevicePopup(props){var _this;_classCallCheck(this,AddDevicePopup);_this=_super.call(this,props);_this.onClickDeviceShare=function(){_this.setState({showDeviceShare:true},function(){document.body.classList.add('modal-multi');});};_this.onClickCloseDeviceShare=function(status){if(status){_this.getListDeviceByProject();}_this.setState({showDeviceShare:false},function(){document.body.classList.remove('modal-multi');});};_this.onClickDeleteDevice=function(index){if(!Libs.isArrayData(_this.state.dataList))return;var item=_this.state.dataList[index];if(Libs.isObjectEmpty(item))return;_this.setState({showDeleteDevice:true,curItemDelete:item},function(){document.body.classList.add('modal-multi');});};_this.onClickCloseDeleteDevice=function(status){if(status){_this.getListDeviceByProject();}_this.setState({curItemDelete:{},showDeleteDevice:false},function(){document.body.classList.remove('modal-multi');});};_this.onItemClick=function(index){if(!Libs.isArrayData(_this.state.dataList))return;var item=_this.state.dataList[index];item.screen_mode=Constants.SCREEN_MODE.EDIT;if(Libs.isObjectEmpty(item))return;_this.setState({curItem:Object.assign({},item)});};_this.onIsVirtualChange=function(index){var curItemProject=_this.state.curItemProject;if(!Libs.isArrayData(_this.state.dataList))return;var item=_this.state.dataList[index],self=_assertThisInitialized(_this);item.screen_mode=Constants.SCREEN_MODE.EDIT;item.id_language=_this.employee.id_language;var isActiveUpdate=item.is_virtual;if(isActiveUpdate*1===1){isActiveUpdate=0;}else{isActiveUpdate=1;}item.id_project=curItemProject.id;item.is_virtual=isActiveUpdate;item.updated_by=_this.employee.first_name+' '+_this.employee.last_name;DeviceService.instance.updateIsVirtual(item,function(status,msg){if(status){self.setState({dataList:self.state.dataList});}});};_this.onStatusChange=function(index){var curItemProject=_this.state.curItemProject;if(!Libs.isArrayData(_this.state.dataList))return;var item=_this.state.dataList[index],self=_assertThisInitialized(_this);item.screen_mode=Constants.SCREEN_MODE.EDIT;item.id_language=_this.employee.id_language;var isActiveUpdate=item.status;if(isActiveUpdate*1===1){isActiveUpdate=0;}else{isActiveUpdate=1;}item.id_project=curItemProject.id;item.status=isActiveUpdate;item.updated_by=_this.employee.first_name+' '+_this.employee.last_name;DeviceService.instance.updateStatus(item,function(status,msg){if(status){self.setState({dataList:self.state.dataList});}});};_this.handleDropdownChange=function(item,name){var self=_assertThisInitialized(_this);var curItem=self.state.curItem;var t=_this.props.t;if(name==='id_device_type'){if(Libs.isObjectEmpty(item)){curItem.id_device_type='';}else{var value=item.value;curItem[name]=value;self.setValidateMessage({id_device_type:''},true);}}if(name==='id_device_group'){if(Libs.isObjectEmpty(item)){curItem.id_device_group='';}else{var value=item.value;curItem[name]=value;self.setValidateMessage({id_device_group:''},true);}}self.setState({curItem:curItem});};_this.state={curItemProject:_this.props.curItem,curItem:{},curItemDelete:{},dataDeviceType:[],dataDeviceGroup:[],dataList:[],searchParam:{},showDeleteDevice:false,showDeviceShare:false};_this.jsxTemplate=AddDevicePopupJsx;_this.handleDropdownChange=_this.handleDropdownChange.bind(_assertThisInitialized(_this));return _this;}/**\n     * @description Called immediately after the component is mounted in the DOM. Called after the render function\n     * @author Long.Pham 12/05/2021\n     */_createClass(AddDevicePopup,[{key:\"componentDidMount\",value:function componentDidMount(){this.getDeviceType();this.getDeviceGroup();this.getListDeviceByProject();}},{key:\"getListDeviceByProject\",value:/**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */function getListDeviceByProject(){var self=this;var _this$state=this.state,curItemProject=_this$state.curItemProject,searchParam=_this$state.searchParam;searchParam.id_project=curItemProject.id;searchParam.id_language=this.employee.id_language;DeviceService.instance.getListDeviceByProject(searchParam,function(data,total_row){if(Libs.isArrayData(data)){self.setState({dataList:data});}else{self.setState({dataList:[]});}self.forceUpdate();});}/**\n     * ge list device type\n     * @author Long.Pham 2019-06-03\n     */},{key:\"getDeviceType\",value:function getDeviceType(){var self=this;var params={id_language:this.employee.id_language};DeviceTypeService.instance.getDropdownList(params,function(data,total_row){if(Libs.isArrayData(data)){self.setState({dataDeviceType:data});}else{self.setState({dataDeviceType:[]});}});}/**\n     * ge list device group\n     * @author Long.Pham 2019-06-03\n     */},{key:\"getDeviceGroup\",value:function getDeviceGroup(){var self=this;var params={id_language:this.employee.id_language};DeviceGroupService.instance.getDropdownList(params,function(data,total_row){if(Libs.isArrayData(data)){self.setState({dataDeviceGroup:data});}else{self.setState({dataDeviceGroup:[]});}});}},{key:\"validateOne\",value:/**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */function(){var _validateOne=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var target,name,value,param,v,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:target=event.target;name=target.name;value=target.value;if(!name){_context.next=10;break;}param=_defineProperty({},name,value);v=new AddDevicePopupValidate(this.props);_context.next=8;return v.validateOne(param,name);case 8:error=_context.sent;if(error!=null){this.setValidateMessage(error,true);}case 10:case\"end\":return _context.stop();}}},_callee,this);}));function validateOne(_x){return _validateOne.apply(this,arguments);}return validateOne;}()/**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */},{key:\"onSave\",value:function(){var _onSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this$state2,curItem,curItemProject,self,params,screenMode,v,errors;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$state2=this.state,curItem=_this$state2.curItem,curItemProject=_this$state2.curItemProject,self=this;curItem.id_project=curItemProject.id;params=Object.assign({},this.state.curItem);screenMode=!Libs.isBlank(curItem.id)?Constants.SCREEN_MODE.EDIT:!Libs.isBlank(this.props.curItem.screen_mode)?this.props.curItem.screen_mode:Constants.SCREEN_MODE.ADD;v=new AddDevicePopupValidate(this.props);_context2.next=7;return v.FLValidationAll(curItem);case 7:errors=_context2.sent;if(!errors){_context2.next=11;break;}this.setValidateMessage(errors);return _context2.abrupt(\"return\");case 11://remove message validation\nthis.removeAllValidateMessage();params.screen_mode=screenMode;params.iso_code_lang=this.employee.lang;params.id_language=this.employee.id_language;params.iso_code=this.employee.iso_code;DeviceService.instance.save(params,function(status,data,msg){if(status){self.toast(msg,\"info\");self.setState({curItem:{}},function(){self.getListDeviceByProject();});}else if(data){self.setValidateMessage(data);}else if(!Libs.isBlank(msg)){self.toast(msg,\"error\");}},true);case 17:case\"end\":return _context2.stop();}}},_callee2,this);}));function onSave(){return _onSave.apply(this,arguments);}return onSave;}()}]);return AddDevicePopup;}(BaseComponent);export default AddDevicePopup;","map":{"version":3,"sources":["/Volumes/Data/sources/solarmon_production/solarmon_frontend/src/containers/views/desktop/ModuleSystem/Project/AddDevicePopup.js"],"names":["BaseComponent","Libs","Constants","AddDevicePopupJsx","AddDevicePopupValidate","DeviceTypeService","DeviceGroupService","DeviceService","AddDevicePopup","props","onClickDeviceShare","setState","showDeviceShare","document","body","classList","add","onClickCloseDeviceShare","status","getListDeviceByProject","remove","onClickDeleteDevice","index","isArrayData","state","dataList","item","isObjectEmpty","showDeleteDevice","curItemDelete","onClickCloseDeleteDevice","onItemClick","screen_mode","SCREEN_MODE","EDIT","curItem","Object","assign","onIsVirtualChange","curItemProject","self","id_language","employee","isActiveUpdate","is_virtual","id_project","id","updated_by","first_name","last_name","instance","updateIsVirtual","msg","onStatusChange","updateStatus","handleDropdownChange","name","t","id_device_type","value","setValidateMessage","id_device_group","dataDeviceType","dataDeviceGroup","searchParam","jsxTemplate","bind","getDeviceType","getDeviceGroup","data","total_row","forceUpdate","params","getDropdownList","event","target","param","v","validateOne","error","screenMode","isBlank","ADD","FLValidationAll","errors","removeAllValidateMessage","iso_code_lang","lang","iso_code","save","toast"],"mappings":"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","sourcesContent":["\nimport BaseComponent from '../../../../BaseComponent';\nimport Libs from '../../../../../utils/Libs';\nimport Constants from '../../../../../utils/Constants';\nimport AddDevicePopupJsx from './AddDevicePopup.jsx';\nimport AddDevicePopupValidate from './AddDevicePopupValidate';\nimport DeviceTypeService from '../../../../../services/DeviceTypeService';\nimport DeviceGroupService from '../../../../../services/DeviceGroupService';\nimport DeviceService from '../../../../../services/DeviceService';\n\nclass AddDevicePopup extends BaseComponent {\n    constructor(props) {\n        super(props);\n        this.state = {\n            curItemProject: this.props.curItem,\n            curItem: {},\n            curItemDelete: {},\n            dataDeviceType: [],\n            dataDeviceGroup: [],\n            dataList: [],\n            searchParam: {},\n            showDeleteDevice: false,\n            showDeviceShare: false\n        }\n\n        this.jsxTemplate = AddDevicePopupJsx;\n        this.handleDropdownChange = this.handleDropdownChange.bind(this);\n    }\n    /**\n     * @description Called immediately after the component is mounted in the DOM. Called after the render function\n     * @author Long.Pham 12/05/2021\n     */\n    componentDidMount() {\n        this.getDeviceType();\n        this.getDeviceGroup();\n        this.getListDeviceByProject();\n    }\n\n    \n    onClickDeviceShare = () => {\n        this.setState({\n            showDeviceShare: true\n        }, () => {\n            document.body.classList.add('modal-multi');\n        })\n    }\n\n    onClickCloseDeviceShare = (status) => {\n        if (status) {\n            this.getListDeviceByProject();\n        }\n        this.setState({\n            showDeviceShare: false\n        }, () => {\n            document.body.classList.remove('modal-multi');\n        });\n\n    }\n\n\n    onClickDeleteDevice = (index) => {\n        if (!Libs.isArrayData(this.state.dataList)) return;\n        var item = this.state.dataList[index];\n        if (Libs.isObjectEmpty(item)) return;\n        this.setState({\n            showDeleteDevice: true,\n            curItemDelete: item\n        }, () => {\n            document.body.classList.add('modal-multi');\n        })\n    }\n\n    onClickCloseDeleteDevice = (status) => {\n        if (status) {\n            this.getListDeviceByProject();\n        }\n\n        this.setState({\n            curItemDelete: {},\n            showDeleteDevice: false\n        }, () => {\n            document.body.classList.remove('modal-multi');\n        });\n\n    }\n\n\n    /**\n     * @description Item click event\n     * @author Long.Pham 12-05-2021\n     * @param index element in the list\n     */\n    onItemClick = (index) => {\n        if (!Libs.isArrayData(this.state.dataList)) return;\n        var item = this.state.dataList[index];\n        item.screen_mode = Constants.SCREEN_MODE.EDIT;\n        if (Libs.isObjectEmpty(item)) return;\n        this.setState({\n            curItem: Object.assign({}, item)\n        });\n    }\n\n    /**\n     * @description Item click event change status\n     * @author Long.Pham 12-05-2021\n     * @param index element in the list\n     */\n    onIsVirtualChange = (index) => {\n        var { curItemProject } = this.state;\n        if (!Libs.isArrayData(this.state.dataList)) return;\n        var item = this.state.dataList[index], self = this;\n        item.screen_mode = Constants.SCREEN_MODE.EDIT;\n        item.id_language = this.employee.id_language;\n\n        var isActiveUpdate = item.is_virtual;\n        if (isActiveUpdate * 1 === 1) {\n            isActiveUpdate = 0;\n        }\n        else {\n            isActiveUpdate = 1;\n        }\n        item.id_project = curItemProject.id;\n        item.is_virtual = isActiveUpdate;\n        item.updated_by = this.employee.first_name + ' ' + this.employee.last_name;\n\n        DeviceService.instance.updateIsVirtual(item, function (status, msg) {\n            if (status) {\n                self.setState({\n                    dataList: self.state.dataList\n                });\n            }\n        });\n    }\n\n    onStatusChange = (index) =>{\n        var { curItemProject } = this.state;\n        if (!Libs.isArrayData(this.state.dataList)) return;\n        var item = this.state.dataList[index], self = this;\n        item.screen_mode = Constants.SCREEN_MODE.EDIT;\n        item.id_language = this.employee.id_language;\n\n        var isActiveUpdate = item.status;\n        if (isActiveUpdate * 1 === 1) {\n            isActiveUpdate = 0;\n        }\n        else {\n            isActiveUpdate = 1;\n        }\n        item.id_project = curItemProject.id;\n        item.status = isActiveUpdate;\n        item.updated_by = this.employee.first_name + ' ' + this.employee.last_name;\n\n        DeviceService.instance.updateStatus(item, function (status, msg) {\n            if (status) {\n                self.setState({\n                    dataList: self.state.dataList\n                });\n            }\n        });\n    }\n\n    /**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */\n    getListDeviceByProject() {\n        let self = this;\n        var { curItemProject, searchParam } = this.state;\n        searchParam.id_project = curItemProject.id;\n        searchParam.id_language = this.employee.id_language;\n        DeviceService.instance.getListDeviceByProject(searchParam, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataList: data\n                });\n\n            } else {\n                self.setState({\n                    dataList: []\n                });\n            }\n            self.forceUpdate();\n        });\n    }\n\n    /**\n     * ge list device type\n     * @author Long.Pham 2019-06-03\n     */\n    getDeviceType() {\n        let self = this;\n        var params = {\n            id_language: this.employee.id_language\n        };\n\n        DeviceTypeService.instance.getDropdownList(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataDeviceType: data\n                });\n            } else {\n                self.setState({\n                    dataDeviceType: []\n                });\n            }\n        })\n    }\n\n\n    /**\n     * ge list device group\n     * @author Long.Pham 2019-06-03\n     */\n    getDeviceGroup() {\n        let self = this;\n        var params = {\n            id_language: this.employee.id_language\n        };\n\n        DeviceGroupService.instance.getDropdownList(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataDeviceGroup: data\n                });\n            } else {\n                self.setState({\n                    dataDeviceGroup: []\n                });\n            }\n        })\n    }\n\n    handleDropdownChange = (item, name) => {\n        var self = this;\n        let curItem = self.state.curItem;\n        var { t } = this.props;\n\n        if (name === 'id_device_type') {\n            if (Libs.isObjectEmpty(item)) {\n                curItem.id_device_type = '';\n            } else {\n                var value = item.value;\n                curItem[name] = value;\n                self.setValidateMessage({ id_device_type: '' }, true);\n            }\n        }\n\n        if (name === 'id_device_group') {\n            if (Libs.isObjectEmpty(item)) {\n                curItem.id_device_group = '';\n            } else {\n                var value = item.value;\n                curItem[name] = value;\n                self.setValidateMessage({ id_device_group: '' }, true);\n            }\n        }\n\n        self.setState({\n            curItem: curItem\n        });\n    }\n\n\n    /**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */\n    async validateOne(event) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value\n        if (name) {\n            let param = {\n                [name]: value\n            }\n            let v = new AddDevicePopupValidate(this.props);\n            let error = await v.validateOne(param, name);\n            if (error != null) {\n                this.setValidateMessage(error, true);\n            }\n        }\n    }\n\n\n    /**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */\n    async onSave() {\n        var { curItem, curItemProject } = this.state, self = this;\n        curItem.id_project = curItemProject.id;\n        var params = Object.assign({}, this.state.curItem);\n        var screenMode = (!Libs.isBlank(curItem.id)) ? Constants.SCREEN_MODE.EDIT : ((!Libs.isBlank(this.props.curItem.screen_mode)) ? this.props.curItem.screen_mode : Constants.SCREEN_MODE.ADD);\n        let v = new AddDevicePopupValidate(this.props);\n        let errors = await v.FLValidationAll(curItem);\n        if (errors) {\n            this.setValidateMessage(errors);\n            return;\n        }\n        //remove message validation\n        this.removeAllValidateMessage();\n        params.screen_mode = screenMode;\n        params.iso_code_lang = this.employee.lang;\n        params.id_language = this.employee.id_language;\n        params.iso_code = this.employee.iso_code;\n\n        DeviceService.instance.save(params, function (status, data, msg) {\n            if (status) {\n                self.toast(msg, \"info\");\n                self.setState({\n                    curItem: {}\n                }, () => {\n                    self.getListDeviceByProject();\n                })\n            }\n            else if (data) {\n                self.setValidateMessage(data);\n            }\n\n            else if (!Libs.isBlank(msg)) {\n                self.toast(msg, \"error\");\n            }\n        }, true);\n    }\n}\nexport default AddDevicePopup;"]},"metadata":{},"sourceType":"module"}