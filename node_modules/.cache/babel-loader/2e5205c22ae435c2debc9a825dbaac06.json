{"ast":null,"code":"import _classCallCheck from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import DeviceChartingJsx from'./DeviceCharting.jsx';import BaseComponent from'../../../../../BaseComponent';import Libs from'../../../../../../utils/Libs';import{withTranslation}from'react-i18next';import AnalyticsService from'../../../../../../services/AnalyticsService';import MainDeviceService from'../../../../../../services/MainDeviceService';import*as FileSaver from'file-saver';import*as XLSX from'xlsx';import moment from'moment';var DeviceCharting=/*#__PURE__*/function(_BaseComponent){_inherits(DeviceCharting,_BaseComponent);var _super=_createSuper(DeviceCharting);function DeviceCharting(props,context){var _this;_classCallCheck(this,DeviceCharting);_this=_super.call(this,props,context);_this.handleClickOutside=function(event){var target=event.target;var chartParams=_this.state.chartParams,self=_assertThisInitialized(_this);if(!_this.wrapperRef.current.contains(target)){if(chartParams.show_filter){chartParams.show_filter=false;self.setState({chartParams:chartParams});}}};_this.onClickFilter=function(value){var _this$state=_this.state,chartParams=_this$state.chartParams,dataFilter=_this$state.dataFilter,curItem=_this$state.curItem;var self=_assertThisInitialized(_this);if(!Libs.isArrayData(dataFilter))return;var item=Libs.find(dataFilter,'id',value);if(Libs.isObjectEmpty(item))return;chartParams.id_filter=item.id;chartParams.text_filter=item.text;chartParams.show_filter=false;chartParams.showNextBtn=false;switch(value){case'today':chartParams.start_date=Libs.getCurrentMMDDYYYYHI();chartParams.end_date=Libs.getCurrentMMDDYYYYHI();chartParams.max_date=Libs.getCurrentMMDDYYYYHI();break;case'3_day':chartParams.end_date=Libs.getCurrentDDMMYYYY();chartParams.start_date=moment(Libs.addDays(Libs.getCurrentMMDDYYYYHI(),-2)).format('DD/MM/YYYY');chartParams.start_max_date=moment(Libs.addDays(Libs.getCurrentMMDDYYYYHI(),-2)).format('DD/MM/YYYY');chartParams.max_date=Libs.getCurrentDDMMYYYY();break;case'this_month':chartParams.max_date=moment().format('MM/YYYY');chartParams.end_date=moment().format('MM/YYYY');break;case'last_month':chartParams.max_date=moment().format('MM/YYYY');var tlast=new Date(Libs.getCurrentMMDDYYYYHI());var ylast=tlast.getFullYear(),mlast=tlast.getMonth();chartParams.end_date=moment(Libs.addMonths(new Date(ylast,mlast,1),-1)).endOf('month').format('MM/YYYY');chartParams.start_date=moment(Libs.addMonths(new Date(ylast,mlast,1),-1)).format('MM/YYYY');break;case'lifetime':case'12_month':chartParams.max_date=moment().format('MM/YYYY');chartParams.end_date=moment().format('MM/YYYY');chartParams.start_date=moment(Libs.addMonths(Libs.getCurrentMMDDYYYYHI(),-12)).format('MM/YYYY');break;// case 'lifetime':\n//     chartParams.start_date = moment(curItem.commissioning).format('MM/DD/YYYY HH:mm:ss');\n//     chartParams.end_date = Libs.getCurrentMMDDYYYYHI();\n//     break;\n}_this.setState({chartParams:chartParams},function(){self.loadDataChart();});};_this.changeViewMinute=function(value){var chartParams=_this.state.chartParams,self=_assertThisInitialized(_this);if(Libs.isBlank(value))return;chartParams.data_send_time=value;_this.setState({chartParams:chartParams},function(){self.loadDataChart();});};_this.onClickShowFilter=function(){var chartParams=_this.state.chartParams;chartParams.show_filter=true;_this.setState({chartParams:chartParams});};_this.downloadData=function(){var dataExport=_this.state.dataExport;if(Libs.isArrayData(dataExport)){var SheetNames=[],Sheets={};var fileType='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';var fileExtension='.xlsx';for(var i=0;i<dataExport.length;i++){SheetNames.push(dataExport[i].name);var dataSheets=[];var dataRows=dataExport[i].data;if(Libs.isArrayData(dataRows)){dataRows.map(function(item,index){dataSheets.push(item);});}var ws=XLSX.utils.json_to_sheet(dataSheets,{skipHeader:false});Sheets[dataExport[i].name]=ws;}var wb={SheetNames:SheetNames,Sheets:Sheets};var excelBuffer=XLSX.write(wb,{bookType:'xlsx',type:'array'});var data=new Blob([excelBuffer],{type:fileType});FileSaver.saveAs(data,\"export-charting-\"+moment().format('YYYY-MM-DD_hh:mm:ss')+fileExtension);}};_this.state={curItem:_this.props.curItem,dataParameter:[],chartToolOption:{},dataExport:[],chartParams:{id_filter:'today',text_filter:'Today',show_filter:false,max_date:Libs.getCurrentDDMMYYYY(),data_send_time:1},dataFilter:[{id:\"today\",text:\"Today\"},{id:\"3_day\",text:\"3 days\"},{id:\"this_month\",text:\"This month\"},{id:\"last_month\",text:\"Last month\"},{id:\"12_month\",text:\"Last 12 months\"},{id:\"lifetime\",text:\"Lifetime\"}]};_this.jsxTemplate=DeviceChartingJsx;_this.handleParameterInputChange=_this.handleParameterInputChange.bind(_assertThisInitialized(_this));_this.wrapperRef=/*#__PURE__*/React.createRef();return _this;}_createClass(DeviceCharting,[{key:\"componentDidMount\",value:function componentDidMount(){this.getDataListHardware();this.loadConfigDefaultDate();document.addEventListener('click',this.handleClickOutside);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){document.removeEventListener('click',this.handleClickOutside);}},{key:\"loadConfigDefaultDate\",value:function loadConfigDefaultDate(){var chartParams=this.state.chartParams;switch(chartParams.id_filter){case'today':chartParams.max_date=Libs.getCurrentMMDDYYYYHI();chartParams.end_date=Libs.getCurrentMMDDYYYYHI();break;case'3_day':chartParams.end_date=Libs.getCurrentDDMMYYYY();chartParams.start_date=moment(Libs.addDays(Libs.getCurrentMMDDYYYYHI(),-2)).format('DD/MM/YYYY');chartParams.start_max_date=moment(Libs.addDays(Libs.getCurrentMMDDYYYYHI(),-2)).format('DD/MM/YYYY');break;case'this_month':chartParams.max_date=moment().format('MM/YYYY');chartParams.end_date=moment().format('MM/YYYY');break;case'last_month':chartParams.max_date=moment().format('MM/YYYY');var tlast=new Date(Libs.getCurrentMMDDYYYYHI());var ylast=tlast.getFullYear(),mlast=tlast.getMonth();chartParams.end_date=moment(Libs.addMonths(new Date(ylast,mlast,1),-1)).endOf('month').format('MM/YYYY');chartParams.start_date=moment(Libs.addMonths(new Date(ylast,mlast,1),-1)).format('MM/YYYY');break;case'lifetime':case'12_month':chartParams.max_date=moment().format('MM/YYYY');chartParams.end_date=moment().format('MM/YYYY');var tlast=new Date(Libs.getCurrentMMDDYYYYHI());var ylast=tlast.getFullYear(),mlast=tlast.getMonth();chartParams.start_date=moment(Libs.addMonths(new Date(ylast,mlast,1),-12)).format('MM/YYYY');chartParams.max_start_date=moment(Libs.addMonths(Libs.getCurrentMMDDYYYYHI(),-12)).format('MM/YYYY');break;}this.setState({chartParams:chartParams});}/**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */},{key:\"getDataListHardware\",value:function getDataListHardware(){var self=this;var curItem=this.state.curItem;var params=Object.assign({},curItem);params.id_language=this.employee.id_language;params.id_employee=this.employee.id_employee;params.type='private';MainDeviceService.instance.getDataListHardware(params,function(data,total_row){if(Libs.isArrayData(data)){self.setState({dataParameter:data});}else{self.setState({dataParameter:[]});}});}},{key:\"handleParameterInputChange\",value:function handleParameterInputChange(e,index){var _this$state2=this.state,dataParameter=_this$state2.dataParameter,curItem=_this$state2.curItem,self=this;if(!Libs.isArrayData(dataParameter))return;var item=dataParameter[index];if(Libs.isObjectEmpty(item))return;dataParameter[index].is_checked=dataParameter[index].is_checked?0:1;dataParameter[index].id_device=curItem.id;this.setState({dataParameter:dataParameter},function(){self.loadDataChart();});}/**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */},{key:\"handleInputDateChange\",value:function handleInputDateChange(event){var target=event.target;var name=target.name;var self=this;var value=target.value;if(target.type==='checkbox'){value=target.checked?1:0;}if(name){var chartParams=this.state.chartParams;switch(chartParams.id_filter){case'today':case'last_month':case'this_month':chartParams.start_date=value;chartParams[name]=value;break;case'3_day':if(name=='start_date'){chartParams.start_date=value;var arrDate=value.split('/');if(arrDate){var currentDate=arrDate[2]+'/'+arrDate[1]+\"/\"+arrDate[0];chartParams.end_date=moment(Libs.addDays(currentDate,2)).format('DD/MM/YYYY');}}if(name=='end_date'){chartParams.end_date=value;var _arrDate=value.split('/');if(_arrDate){var _currentDate=_arrDate[2]+'/'+_arrDate[1]+\"/\"+_arrDate[0];chartParams.start_date=moment(Libs.addDays(_currentDate,-2)).format('DD/MM/YYYY');}}break;case'12_month':if(name=='start_date'){chartParams.start_date=value;var _arrDate2=value.split('/');if(_arrDate2){var _currentDate2=_arrDate2[1]+'/'+_arrDate2[0]+'/01';var startOfMonth=moment(_currentDate2).startOf('month').format('YYYY-MM-DD');chartParams.end_date=moment(Libs.addMonths(startOfMonth,12)).format('MM/YYYY');}}if(name=='end_date'){chartParams.end_date=value;var _arrDate3=value.split('/');if(_arrDate3){var _currentDate3=_arrDate3[1]+'/'+_arrDate3[0]+'/01';var _startOfMonth=moment(_currentDate3).startOf('month').format('YYYY-MM-DD');chartParams.start_date=moment(Libs.addMonths(_startOfMonth,-12)).format('MM/YYYY');}}break;}self.setState({chartParams:chartParams});self.loadDataChart();}}},{key:\"loadDataChart\",value:function loadDataChart(){var _this2=this;var _this$state3=this.state,chartParams=_this$state3.chartParams,dataDevice=_this$state3.dataDevice,dataParameter=_this$state3.dataParameter,curItem=_this$state3.curItem,self=this;var chartToolOption={};var dataDevice=[];if(!Libs.isObjectEmpty(curItem)){dataDevice.push(curItem);}if(!Libs.isArrayData(dataDevice)||!Libs.isArrayData(dataParameter))return;var params={};switch(chartParams.id_filter){case'today':params.start_date=Libs.convertAllFormatDate(Libs.dateFormat(chartParams.start_date,\"MM/DD/YYYY\",\"MM/DD/YYYY\")+\" 00:00:00\");params.end_date=Libs.convertAllFormatDate(Libs.dateFormat(chartParams.end_date,\"MM/DD/YYYY\",\"MM/DD/YYYY\")+\" 19:00:00\");break;case'3_day':params.start_date=Libs.dateFormat(chartParams.start_date,\"MM/DD/YYYY\",\"MM/DD/YYYY\")+\" 00:00:00\";params.end_date=Libs.dateFormat(chartParams.end_date,\"MM/DD/YYYY\",\"MM/DD/YYYY\")+\" 19:00:00\";break;case'last_month':case'this_month':params.start_date=Libs.dateFormat(Libs.getCurrentMMDDYYYYHI(),\"DD\",\"MM/DD/YYYY\")+\"/\"+chartParams.start_date+\" 00:00:00\";params.end_date=Libs.dateFormat(Libs.getCurrentMMDDYYYYHI(),\"DD\",\"MM/DD/YYYY\")+\"/\"+chartParams.end_date+\" 19:00:00\";break;case'lifetime':case'12_month':params.start_date=Libs.dateFormat(Libs.getCurrentMMDDYYYYHI(),\"DD\",\"MM/DD/YYYY\")+\"/\"+chartParams.start_date+\" 00:00:00\";params.end_date=Libs.dateFormat(Libs.getCurrentMMDDYYYYHI(),\"DD\",\"MM/DD/YYYY\")+\"/\"+chartParams.end_date+\" 19:00:00\";break;}params.id_language=this.employee.id_language;params.id_employee=this.employee.id_employee;var filterDevice=dataDevice.reduce(function(acc,current){var x=acc.find(function(item){return item.id===current.id;});if(!x){return acc.concat([current]);}else{return acc;}},[]);params.dataDevice=filterDevice;params.filterBy=chartParams.id_filter;params.data_send_time=chartParams.data_send_time;params.type='private';var elHeight=document.getElementById('chart-view').clientHeight-80;chartToolOption.chart={zoomType:'xy',height:elHeight?elHeight:null};chartToolOption.credits={enabled:false};chartToolOption.exporting={enabled:true};chartToolOption.title={text:null,align:'left'};chartToolOption.xAxis=[];chartToolOption.yAxis=[];chartToolOption.tooltip={shared:true,crosshairs:true};chartToolOption.plotOptions={series:{turboThreshold:5000},column:{stacking:'normal'}};chartToolOption.series=[];var tickInterval=24;switch(chartParams.id_filter){case'today':if(chartParams.data_send_time==1){tickInterval=24;}else if(chartParams.data_send_time==2){tickInterval=12;}else if(chartParams.data_send_time==3){tickInterval=2;}break;case'3_day':if(chartParams.data_send_time==1){tickInterval=168;}else if(chartParams.data_send_time==2){tickInterval=57;}else if(chartParams.data_send_time==3){tickInterval=15;}break;case'last_month':case'this_month':tickInterval=4;break;case'lifetime':case'12_month':tickInterval=1;break;}var paramerter=dataParameter.filter(function(item){return item.is_checked==1;});if(!Libs.isArrayData(paramerter))return;AnalyticsService.instance.getChartByListDevice(params,function(data,total_row){if(Libs.isArrayData(data)){var categories=[],series=[],yAxis=[];var yAxisUnit=[];for(var i=0;i<paramerter.length;i++){if(i===0){yAxisUnit.push(paramerter[i]);yAxis.push({gridLineWidth:1,lineWidth:1,labels:{enabled:true},title:{text:!Libs.isBlank(paramerter[i].unit)?paramerter[i].unit:'',enabled:true},opposite:false});}else{var findyAxisUnit=Libs.find(yAxisUnit,'unit',paramerter[i].unit);if(Libs.isObjectEmpty(findyAxisUnit)){yAxisUnit.push(paramerter[i]);yAxis.push({gridLineWidth:1,lineWidth:1,labels:{enabled:true},title:{text:!Libs.isBlank(paramerter[i].unit)?paramerter[i].unit:'',enabled:true},opposite:true});}}var idyAxis=0;if(Libs.isArrayData(yAxisUnit)){yAxisUnit.map(function(h,index){if(paramerter[i].unit==h.unit){idyAxis=index;}});}for(var k=0,lenk=data.length;k<lenk;k++){var seriesItem={name:paramerter[i].name,type:'spline',yAxis:idyAxis,tooltip:{valueSuffix:' '+(!Libs.isBlank(paramerter[i].unit)?paramerter[i].unit:'')},data:[],gridLineWidth:1,lineWidth:1,marker:{radius:1.5,enabled:false}};var dataRow=data[k].data;var itemData=[];if(Libs.isArrayData(dataRow)){for(var j=0;j<dataRow.length;j++){// generate series\nvar value=!Libs.isBlank(dataRow[j][paramerter[i].slug])&&dataRow[j][paramerter[i].slug]>0?dataRow[j][paramerter[i].slug]:null;itemData.push([dataRow[j].time_full,value]);if(k===0){categories.push(dataRow[j].categories_time);}}}seriesItem.data=itemData;series.push(seriesItem);}}if(Libs.isArrayData(categories)&&Libs.isArrayData(series)&&Libs.isArrayData(yAxis)){chartToolOption.xAxis=[{categories:categories,alignTicks:true,tickInterval:tickInterval}];chartToolOption.series=series;chartToolOption.yAxis=yAxis;_this2.setState({chartToolOption:chartToolOption,dataExport:data});self.forceUpdate();}}else{self.setState({chartToolOption:{},dataExport:[]});}});}},{key:\"render\",value:function render(){return this.jsxTemplate.call(this);}}]);return DeviceCharting;}(BaseComponent);var HighOrderComponentTranslated=withTranslation('common')(DeviceCharting);export default HighOrderComponentTranslated;","map":{"version":3,"sources":["/Volumes/Data/sources/solars/frontend/src/containers/views/desktop/ModulePrivate/Device/DeviceCharting/DeviceCharting.js"],"names":["React","DeviceChartingJsx","BaseComponent","Libs","withTranslation","AnalyticsService","MainDeviceService","FileSaver","XLSX","moment","DeviceCharting","props","context","handleClickOutside","event","target","chartParams","state","self","wrapperRef","current","contains","show_filter","setState","onClickFilter","value","dataFilter","curItem","isArrayData","item","find","isObjectEmpty","id_filter","id","text_filter","text","showNextBtn","start_date","getCurrentMMDDYYYYHI","end_date","max_date","getCurrentDDMMYYYY","addDays","format","start_max_date","tlast","Date","ylast","getFullYear","mlast","getMonth","addMonths","endOf","loadDataChart","changeViewMinute","isBlank","data_send_time","onClickShowFilter","downloadData","dataExport","SheetNames","Sheets","fileType","fileExtension","i","length","push","name","dataSheets","dataRows","data","map","index","ws","utils","json_to_sheet","skipHeader","wb","excelBuffer","write","bookType","type","Blob","saveAs","dataParameter","chartToolOption","jsxTemplate","handleParameterInputChange","bind","createRef","getDataListHardware","loadConfigDefaultDate","document","addEventListener","removeEventListener","max_start_date","params","Object","assign","id_language","employee","id_employee","instance","total_row","e","is_checked","id_device","checked","arrDate","split","currentDate","startOfMonth","startOf","dataDevice","convertAllFormatDate","dateFormat","filterDevice","reduce","acc","x","concat","filterBy","elHeight","getElementById","clientHeight","chart","zoomType","height","credits","enabled","exporting","title","align","xAxis","yAxis","tooltip","shared","crosshairs","plotOptions","series","turboThreshold","column","stacking","tickInterval","paramerter","filter","getChartByListDevice","categories","yAxisUnit","gridLineWidth","lineWidth","labels","unit","opposite","findyAxisUnit","idyAxis","h","k","lenk","seriesItem","valueSuffix","marker","radius","dataRow","itemData","j","slug","time_full","categories_time","alignTicks","forceUpdate","call","HighOrderComponentTranslated"],"mappings":"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","sourcesContent":["import React from 'react';\nimport DeviceChartingJsx from './DeviceCharting.jsx';\nimport BaseComponent from '../../../../../BaseComponent';\nimport Libs from '../../../../../../utils/Libs';\nimport { withTranslation } from 'react-i18next';\nimport AnalyticsService from '../../../../../../services/AnalyticsService';\nimport MainDeviceService from '../../../../../../services/MainDeviceService';\nimport * as FileSaver from 'file-saver';\nimport * as XLSX from 'xlsx';\nimport moment from 'moment';\n\nclass DeviceCharting extends BaseComponent {\n\n    constructor(props, context) {\n        super(props, context);\n\n        this.state = {\n            curItem: this.props.curItem,\n            dataParameter: [],\n            chartToolOption: {},\n            dataExport: [],\n            chartParams: {\n                id_filter: 'today',\n                text_filter: 'Today',\n                show_filter: false,\n                max_date: Libs.getCurrentDDMMYYYY(),\n                data_send_time: 1\n            },\n\n            dataFilter: [\n                { id: \"today\", text: \"Today\" },\n                { id: \"3_day\", text: \"3 days\" },\n                { id: \"this_month\", text: \"This month\" },\n                { id: \"last_month\", text: \"Last month\" },\n                { id: \"12_month\", text: \"Last 12 months\" },\n                { id: \"lifetime\", text: \"Lifetime\" }\n            ],\n        };\n        this.jsxTemplate = DeviceChartingJsx;\n\n        this.handleParameterInputChange = this.handleParameterInputChange.bind(this);\n        this.wrapperRef = React.createRef();\n\n    }\n\n    componentDidMount() {\n        \n        this.getDataListHardware();\n        this.loadConfigDefaultDate();\n        document.addEventListener('click', this.handleClickOutside);\n    }\n\n    componentWillUnmount() {\n        document.removeEventListener('click', this.handleClickOutside)\n    }\n\n    handleClickOutside = (event) => {\n        const { target } = event;\n        var { chartParams } = this.state, self = this;\n        if (!this.wrapperRef.current.contains(target)) {\n            if (chartParams.show_filter) {\n                chartParams.show_filter = false;\n                self.setState({\n                    chartParams: chartParams\n                })\n            }\n        }\n    }\n\n\n    loadConfigDefaultDate() {\n        var { chartParams } = this.state;\n        switch (chartParams.id_filter) {\n            case 'today':\n                chartParams.max_date = Libs.getCurrentMMDDYYYYHI();\n                chartParams.end_date = Libs.getCurrentMMDDYYYYHI();\n                break;\n            case '3_day':\n                chartParams.end_date = Libs.getCurrentDDMMYYYY();\n                chartParams.start_date = moment(Libs.addDays(Libs.getCurrentMMDDYYYYHI(), -2)).format('DD/MM/YYYY');\n                chartParams.start_max_date = moment(Libs.addDays(Libs.getCurrentMMDDYYYYHI(), -2)).format('DD/MM/YYYY');\n                break;\n            case 'this_month':\n                chartParams.max_date = moment().format('MM/YYYY');\n                chartParams.end_date = moment().format('MM/YYYY');\n                break;\n            case 'last_month':\n                chartParams.max_date = moment().format('MM/YYYY');\n                var tlast = new Date(Libs.getCurrentMMDDYYYYHI());\n                var ylast = tlast.getFullYear(), mlast = tlast.getMonth();\n                chartParams.end_date = moment(Libs.addMonths(new Date(ylast, mlast, 1), -1)).endOf('month').format('MM/YYYY');\n                chartParams.start_date = moment(Libs.addMonths(new Date(ylast, mlast, 1), -1)).format('MM/YYYY');\n\n                break;\n            case 'lifetime':\n            case '12_month':\n                chartParams.max_date = moment().format('MM/YYYY');\n                chartParams.end_date = moment().format('MM/YYYY');\n                var tlast = new Date(Libs.getCurrentMMDDYYYYHI());\n                var ylast = tlast.getFullYear(), mlast = tlast.getMonth();\n                chartParams.start_date = moment(Libs.addMonths(new Date(ylast, mlast, 1), -12)).format('MM/YYYY');\n                chartParams.max_start_date = moment(Libs.addMonths(Libs.getCurrentMMDDYYYYHI(), -12)).format('MM/YYYY');\n                break;\n        }\n        this.setState({\n            chartParams: chartParams\n        })\n    }\n\n    /**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */\n    getDataListHardware() {\n        let self = this;\n        var { curItem } = this.state;\n        let params = Object.assign({}, curItem);\n        params.id_language = this.employee.id_language;\n        params.id_employee = this.employee.id_employee;\n        params.type = 'private';\n        MainDeviceService.instance.getDataListHardware(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataParameter: data\n                });\n\n            } else {\n                self.setState({\n                    dataParameter: []\n                });\n            }\n        });\n    }\n\n    handleParameterInputChange(e, index) {\n        var { dataParameter, curItem } = this.state, self = this;\n        if (!Libs.isArrayData(dataParameter)) return;\n        var item = dataParameter[index];\n        if (Libs.isObjectEmpty(item)) return;\n\n        dataParameter[index].is_checked = dataParameter[index].is_checked ? 0 : 1;\n        dataParameter[index].id_device = curItem.id;\n        this.setState({\n            dataParameter: dataParameter\n        }, () => {\n            self.loadDataChart();\n        });\n    }\n\n    /**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */\n    handleInputDateChange(event) {\n        let target = event.target;\n        let name = target.name;\n        var self = this;\n        let value = target.value;\n        if (target.type === 'checkbox') {\n            value = target.checked ? 1 : 0;\n        }\n\n        if (name) {\n            let { chartParams } = this.state;\n            switch (chartParams.id_filter) {\n                case 'today':\n                case 'last_month':\n                case 'this_month':\n                    chartParams.start_date = value;\n                    chartParams[name] = value;\n                    break;\n                case '3_day':\n                    if (name == 'start_date') {\n                        chartParams.start_date = value;\n                        let arrDate = value.split('/');\n                        if (arrDate) {\n                            let currentDate = arrDate[2] + '/' + arrDate[1] + \"/\" + arrDate[0];\n                            chartParams.end_date = moment(Libs.addDays(currentDate, 2)).format('DD/MM/YYYY');\n                        }\n                    }\n\n                    if (name == 'end_date') {\n                        chartParams.end_date = value;\n                        let arrDate = value.split('/');\n                        if (arrDate) {\n                            let currentDate = arrDate[2] + '/' + arrDate[1] + \"/\" + arrDate[0];\n                            chartParams.start_date = moment(Libs.addDays(currentDate, -2)).format('DD/MM/YYYY');\n                        }\n                    }\n\n                    break;\n                case '12_month':\n                    if (name == 'start_date') {\n                        chartParams.start_date = value;\n                        let arrDate = value.split('/');\n                        if (arrDate) {\n                            let currentDate = arrDate[1] + '/' + arrDate[0] + '/01';\n                            const startOfMonth = moment(currentDate).startOf('month').format('YYYY-MM-DD');\n                            chartParams.end_date = moment(Libs.addMonths(startOfMonth, 12)).format('MM/YYYY');\n                        }\n                    }\n\n                    if (name == 'end_date') {\n                        chartParams.end_date = value;\n                        let arrDate = value.split('/');\n                        if (arrDate) {\n                            let currentDate = arrDate[1] + '/' + arrDate[0] + '/01';\n                            const startOfMonth = moment(currentDate).startOf('month').format('YYYY-MM-DD');\n                            chartParams.start_date = moment(Libs.addMonths(startOfMonth, -12)).format('MM/YYYY');\n                        }\n                    }\n                    break;\n            }\n\n            self.setState({\n                chartParams: chartParams\n            });\n            self.loadDataChart();\n        }\n    }\n\n    onClickFilter = (value) => {\n        var { chartParams, dataFilter, curItem } = this.state;\n        var self = this;\n        if (!Libs.isArrayData(dataFilter)) return;\n        var item = Libs.find(dataFilter, 'id', value);\n        if (Libs.isObjectEmpty(item)) return;\n\n        chartParams.id_filter = item.id;\n        chartParams.text_filter = item.text;\n        chartParams.show_filter = false;\n        chartParams.showNextBtn = false;\n\n        switch (value) {\n            case 'today':\n                chartParams.start_date = Libs.getCurrentMMDDYYYYHI();\n                chartParams.end_date = Libs.getCurrentMMDDYYYYHI();\n                chartParams.max_date = Libs.getCurrentMMDDYYYYHI();\n                break;\n            case '3_day':\n                chartParams.end_date = Libs.getCurrentDDMMYYYY();\n                chartParams.start_date = moment(Libs.addDays(Libs.getCurrentMMDDYYYYHI(), -2)).format('DD/MM/YYYY');\n                chartParams.start_max_date = moment(Libs.addDays(Libs.getCurrentMMDDYYYYHI(), -2)).format('DD/MM/YYYY');\n                chartParams.max_date = Libs.getCurrentDDMMYYYY();\n                break;\n\n            case 'this_month':\n                chartParams.max_date = moment().format('MM/YYYY');\n                chartParams.end_date = moment().format('MM/YYYY');\n                break;\n            case 'last_month':\n                chartParams.max_date = moment().format('MM/YYYY');\n                var tlast = new Date(Libs.getCurrentMMDDYYYYHI());\n                var ylast = tlast.getFullYear(), mlast = tlast.getMonth();\n                chartParams.end_date = moment(Libs.addMonths(new Date(ylast, mlast, 1), -1)).endOf('month').format('MM/YYYY');\n                chartParams.start_date = moment(Libs.addMonths(new Date(ylast, mlast, 1), -1)).format('MM/YYYY');\n                break;\n\n            case 'lifetime':\n            case '12_month':\n                chartParams.max_date = moment().format('MM/YYYY');\n                chartParams.end_date = moment().format('MM/YYYY');\n                chartParams.start_date = moment(Libs.addMonths(Libs.getCurrentMMDDYYYYHI(), -12)).format('MM/YYYY');\n\n                break;\n            // case 'lifetime':\n            //     chartParams.start_date = moment(curItem.commissioning).format('MM/DD/YYYY HH:mm:ss');\n            //     chartParams.end_date = Libs.getCurrentMMDDYYYYHI();\n            //     break;\n        }\n\n        this.setState({\n            chartParams: chartParams\n        }, () => {\n            self.loadDataChart();\n        });\n    }\n\n\n\n    changeViewMinute = (value) => {\n        var chartParams = this.state.chartParams, self = this;\n        if (Libs.isBlank(value)) return;\n        chartParams.data_send_time = value;\n        this.setState({ chartParams: chartParams }, () => {\n            self.loadDataChart();\n        });\n    }\n\n\n    onClickShowFilter = () => {\n        var { chartParams } = this.state;\n        chartParams.show_filter = true;\n        this.setState({\n            chartParams: chartParams\n        });\n    }\n\n\n    loadDataChart() {\n        var { chartParams, dataDevice, dataParameter, curItem } = this.state, self = this;\n        var chartToolOption = {};\n        var dataDevice = [];\n        if (!Libs.isObjectEmpty(curItem)) {\n            dataDevice.push(curItem);\n        }\n        if (!Libs.isArrayData(dataDevice) || !Libs.isArrayData(dataParameter)) return;\n        var params = {};\n        switch (chartParams.id_filter) {\n            case 'today':\n                params.start_date = Libs.convertAllFormatDate(Libs.dateFormat(chartParams.start_date, \"MM/DD/YYYY\", \"MM/DD/YYYY\") + \" 00:00:00\");\n                params.end_date = Libs.convertAllFormatDate(Libs.dateFormat(chartParams.end_date, \"MM/DD/YYYY\", \"MM/DD/YYYY\") + \" 19:00:00\");\n                break;\n            case '3_day':\n                params.start_date = Libs.dateFormat(chartParams.start_date, \"MM/DD/YYYY\", \"MM/DD/YYYY\") + \" 00:00:00\";\n                params.end_date = Libs.dateFormat(chartParams.end_date, \"MM/DD/YYYY\", \"MM/DD/YYYY\") + \" 19:00:00\";\n                break;\n            case 'last_month':\n            case 'this_month':\n                params.start_date = Libs.dateFormat(Libs.getCurrentMMDDYYYYHI(), \"DD\", \"MM/DD/YYYY\") + \"/\" + chartParams.start_date + \" 00:00:00\";\n                params.end_date = Libs.dateFormat(Libs.getCurrentMMDDYYYYHI(), \"DD\", \"MM/DD/YYYY\") + \"/\" + chartParams.end_date + \" 19:00:00\";\n                break;\n            case 'lifetime':\n            case '12_month':\n                params.start_date = Libs.dateFormat(Libs.getCurrentMMDDYYYYHI(), \"DD\", \"MM/DD/YYYY\") + \"/\" + chartParams.start_date + \" 00:00:00\";\n                params.end_date = Libs.dateFormat(Libs.getCurrentMMDDYYYYHI(), \"DD\", \"MM/DD/YYYY\") + \"/\" + chartParams.end_date + \" 19:00:00\";\n                break;\n        }\n\n\n\n        params.id_language = this.employee.id_language;\n        params.id_employee = this.employee.id_employee;\n\n        const filterDevice = dataDevice.reduce((acc, current) => {\n            const x = acc.find(item => item.id === current.id);\n            if (!x) {\n                return acc.concat([current]);\n            } else {\n                return acc;\n            }\n        }, []);\n\n\n        params.dataDevice = filterDevice;\n        params.filterBy = chartParams.id_filter;\n        params.data_send_time = chartParams.data_send_time;\n        params.type = 'private';\n\n        let elHeight = (document.getElementById('chart-view').clientHeight) - 80;\n        chartToolOption.chart = { zoomType: 'xy', height: elHeight ? elHeight : null };\n        chartToolOption.credits = { enabled: false };\n        chartToolOption.exporting = { enabled: true };\n        chartToolOption.title = {\n            text: null,\n            align: 'left'\n        };\n        chartToolOption.xAxis = [];\n        chartToolOption.yAxis = [];\n        chartToolOption.tooltip = {\n            shared: true,\n            crosshairs: true\n        };\n        chartToolOption.plotOptions = {\n            series: {\n                turboThreshold: 5000\n            },\n            column: {\n                stacking: 'normal'\n            }\n        };\n        chartToolOption.series = [];\n        var tickInterval = 24;\n        switch (chartParams.id_filter) {\n            case 'today':\n                if (chartParams.data_send_time == 1) {\n                    tickInterval = 24;\n                } else if (chartParams.data_send_time == 2) {\n                    tickInterval = 12;\n                } else if (chartParams.data_send_time == 3) {\n                    tickInterval = 2;\n                }\n\n                break;\n            case '3_day':\n                if (chartParams.data_send_time == 1) {\n                    tickInterval = 168;\n                } else if (chartParams.data_send_time == 2) {\n                    tickInterval = 57;\n                } else if (chartParams.data_send_time == 3) {\n                    tickInterval = 15;\n                }\n                break;\n            case 'last_month':\n            case 'this_month':\n                tickInterval = 4;\n                break;\n            case 'lifetime':\n            case '12_month':\n                tickInterval = 1;\n                break;\n        }\n\n        var paramerter = dataParameter.filter((item) => item.is_checked == 1);\n        if (!Libs.isArrayData(paramerter)) return;\n\n        AnalyticsService.instance.getChartByListDevice(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                var categories = [], series = [], yAxis = [];\n                var yAxisUnit = [];\n                for (var i = 0; i < paramerter.length; i++) {\n                    if (i === 0) {\n                        yAxisUnit.push(paramerter[i]);\n                        yAxis.push({\n                            gridLineWidth: 1,\n                            lineWidth: 1,\n                            labels: {\n                                enabled: true\n                            },\n                            title: {\n                                text: (!Libs.isBlank(paramerter[i].unit) ? paramerter[i].unit : ''),\n                                enabled: true\n                            },\n                            opposite: false\n                        });\n                    } else {\n                        var findyAxisUnit = Libs.find(yAxisUnit, 'unit', paramerter[i].unit);\n                        if (Libs.isObjectEmpty(findyAxisUnit)) {\n                            yAxisUnit.push(paramerter[i]);\n                            yAxis.push({\n                                gridLineWidth: 1,\n                                lineWidth: 1,\n                                labels: {\n                                    enabled: true\n                                },\n                                title: {\n                                    text: (!Libs.isBlank(paramerter[i].unit) ? paramerter[i].unit : ''),\n                                    enabled: true\n                                },\n                                opposite: true\n                            });\n                        }\n                    }\n\n                    var idyAxis = 0;\n\n                    if (Libs.isArrayData(yAxisUnit)) {\n                        yAxisUnit.map((h, index) => {\n                            if (paramerter[i].unit == h.unit) {\n                                idyAxis = index;\n                            }\n                        })\n                    }\n\n                    for (let k = 0, lenk = data.length; k < lenk; k++) {\n                        var seriesItem = {\n                            name: paramerter[i].name,\n                            type: 'spline',\n                            yAxis: idyAxis,\n                            tooltip: {\n                                valueSuffix: ' ' + (!Libs.isBlank(paramerter[i].unit) ? paramerter[i].unit : '')\n                            },\n                            data: [],\n                            gridLineWidth: 1,\n                            lineWidth: 1,\n                            marker: {\n                                radius: 1.5,\n                                enabled: false\n                            }\n                        };\n\n                        var dataRow = data[k].data;\n                        var itemData = [];\n                        if (Libs.isArrayData(dataRow)) {\n                            for (let j = 0; j < dataRow.length; j++) {\n                                // generate series\n                                var value = (!Libs.isBlank(dataRow[j][paramerter[i].slug]) && dataRow[j][paramerter[i].slug] > 0) ? dataRow[j][paramerter[i].slug] : null;\n                                itemData.push([dataRow[j].time_full, value]);\n                                if (k === 0) {\n                                    categories.push(dataRow[j].categories_time);\n                                }\n                            }\n                        }\n\n\n                        seriesItem.data = itemData;\n                        series.push(seriesItem);\n                    }\n                }\n\n                if (Libs.isArrayData(categories) && Libs.isArrayData(series) && Libs.isArrayData(yAxis)) {\n                    chartToolOption.xAxis = [\n                        {\n                            categories: categories,\n                            alignTicks: true,\n                            tickInterval: tickInterval\n                        }\n                    ];\n                    chartToolOption.series = series;\n                    chartToolOption.yAxis = yAxis;\n\n                    this.setState({\n                        chartToolOption: chartToolOption,\n                        dataExport: data\n                    });\n                    self.forceUpdate()\n                }\n            } else {\n                self.setState({\n                    chartToolOption: {},\n                    dataExport: []\n                });\n            }\n        });\n    }\n\n    downloadData = () => {\n        var { dataExport } = this.state;\n        if (Libs.isArrayData(dataExport)) {\n            var SheetNames = [], Sheets = {};\n            const fileType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';\n            const fileExtension = '.xlsx';\n            for (var i = 0; i < dataExport.length; i++) {\n                SheetNames.push(dataExport[i].name);\n                var dataSheets = [];\n                var dataRows = dataExport[i].data;\n                if (Libs.isArrayData(dataRows)) {\n                    dataRows.map((item, index) => {\n                        dataSheets.push(item);\n                    })\n                }\n                const ws = XLSX.utils.json_to_sheet(dataSheets, { skipHeader: false });\n                Sheets[dataExport[i].name] = ws;\n            }\n\n            const wb = {\n                SheetNames: SheetNames,\n                Sheets: Sheets\n            };\n            const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\n            const data = new Blob([excelBuffer], { type: fileType });\n            FileSaver.saveAs(data, \"export-charting-\" + moment().format('YYYY-MM-DD_hh:mm:ss') + fileExtension);\n        }\n    }\n\n    render() {\n        return this.jsxTemplate.call(this)\n    }\n}\n\nconst HighOrderComponentTranslated = withTranslation('common')(DeviceCharting)\nexport default HighOrderComponentTranslated;"]},"metadata":{},"sourceType":"module"}