{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import DeviceJsx from'./Device.jsx';import BaseComponent from'../../../../BaseComponent';import Libs from'../../../../../utils/Libs';import{withTranslation}from'react-i18next';import Constants from'../../../../../utils/Constants';import MainDeviceService from'../../../../../services/MainDeviceService';import*as FileSaver from'file-saver';import*as XLSX from'xlsx';import moment from'moment';var Device=/*#__PURE__*/function(_BaseComponent){_inherits(Device,_BaseComponent);var _super=_createSuper(Device);function Device(props,context){var _this;_classCallCheck(this,Device);_this=_super.call(this,props,context);_this.onClickControlCalender=function(index){var dataListInverter=_this.state.dataListInverter;if(!Libs.isArrayData(dataListInverter))return;var item=dataListInverter[index];if(Libs.isObjectEmpty(item))return;_this.setState({showControlCalendar:true,curItem:item});};_this.onCloseControlCalender=function(){_this.setState({showControlCalendar:false});};_this.onClickOnOff=function(index){var dataListInverter=_this.state.dataListInverter;if(!Libs.isArrayData(dataListInverter))return;var item=dataListInverter[index];if(Libs.isObjectEmpty(item))return;_this.setState({showOnOffPopup:true,curItem:item});};_this.onClickCloseOnOff=function(status){if(status){_this.getListInverter();}_this.setState({showOnOffPopup:false});};_this.downloadData=function(){var dataList=_this.state.dataList;var t=_this.props.t;if(!Libs.isArrayData(dataList))return;var dataExport=[];for(var i=0,len=dataList.length;i<len;i++){var itemLevel=dataList[i].alerts;var error=0,warning=0,info=0,fatal=0,debug=0;if(Libs.isArrayData(itemLevel)){for(var j=0,leng=itemLevel.length;j<leng;j++){switch(parseInt(itemLevel[j].id)){case 1:error=itemLevel[j].total_alert;break;case 2:warning=itemLevel[j].total_alert;break;case 3:info=itemLevel[j].total_alert;break;case 4:fatal=itemLevel[j].total_alert;break;case 5:debug=itemLevel[j].total_alert;break;}}}dataExport.push({'ID':dataList[i].id,'Device name':dataList[i].name,'Model':dataList[i].model,'Serial number':dataList[i].serial_number,'Device type':dataList[i].device_type_name,'Power now':!Libs.isBlank(dataList[i].power_now)?Libs.formatNum(dataList[i].power_now,'#,###.##')+\" kW\":\"N/A\",'Energy today':!Libs.isBlank(dataList[i].energy_today)?Libs.formatNum(dataList[i].energy_today,'#,###.##')+\" kWh\":\"N/A\",'Lifetime':!Libs.isBlank(dataList[i].lifetime)?Libs.formatElectricalUnit(dataList[i].lifetime,'h'):\"N/A\",'Error':error,'Warning':warning,'Info':info,'Fatal':fatal,'Debug':debug});}var fileType='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';var fileExtension='.xlsx';var ws=XLSX.utils.json_to_sheet(dataExport,{skipHeader:false});var wb={SheetNames:['Alerts'],Sheets:{'Alerts':ws}};var excelBuffer=XLSX.write(wb,{bookType:'xlsx',type:'array'});var data=new Blob([excelBuffer],{type:fileType});FileSaver.saveAs(data,\"Export-alerts-\"+moment().format('YYYY-MM-DD_hh:mm:ss')+fileExtension);};_this.onClickViewDevice=function(index){var dataList=_this.state.dataList;if(!Libs.isArrayData(dataList))return;var item=dataList[index];if(Libs.isObjectEmpty(item))return;item.screen_mode=Constants.SCREEN_MODE.ADD;_this.setState({show_tab:1,curItem:item,viewDevice:true});};_this.onClickChartDevice=function(index){var dataList=_this.state.dataList;if(!Libs.isArrayData(dataList))return;var item=dataList[index];if(Libs.isObjectEmpty(item))return;item.screen_mode=Constants.SCREEN_MODE.ADD;_this.setState({show_tab:3,curItem:item,viewDevice:true});// let curItem = this.state.curItem;\n// curItem.data_send_time = 1;\n// curItem.type = 1;\n// curItem.screen_mode = Constants.SCREEN_MODE.ADD;\n// this.setState({\n//     curItem: curItem,\n//     show_tab: 3,\n//     viewDevice: true\n// });\n};_this.viewAlertDevice=function(index){var _this$state=_this.state,dataList=_this$state.dataList,curItem=_this$state.curItem;if(!Libs.isArrayData(dataList))return;var item=dataList[index];if(Libs.isObjectEmpty(item))return;curItem.screen_mode=Constants.SCREEN_MODE.ADD;_this.setState({curItem:Object.assign(curItem,item),show_tab:2,viewDevice:true});};_this.onClickCloseViewDevice=function(status){if(status){// this.getList();\n}_this.setState({viewDevice:false});};_this.jsxTemplate=DeviceJsx;_this.state={hash_id:!Libs.isObjectEmpty(_this.params)?_this.params.id:null,curItem:{},dataList:[],dataListInverter:[],show_tab:1,tab_on_off:1,showOnOffPopup:false,showControlCalendar:false,searchParam:{limit:Constants.COMMON.LIMIT,offset:0,index:1,max_date:Libs.getCurrentDDMMYYYY(),current_date:Libs.getCurrentDDMMYYYY()},viewDevice:false,formSearch:false};_this.paging={total:0,current:1,currentInput:1};_this.inputChangedHandler=_this.inputChangedHandler.bind(_assertThisInitialized(_this));_this.inputChangedEnter=_this.inputChangedEnter.bind(_assertThisInitialized(_this));_this.inputChangedBlue=_this.inputChangedBlue.bind(_assertThisInitialized(_this));return _this;}_createClass(Device,[{key:\"componentDidMount\",value:function componentDidMount(){var tab_on_off=this.state.tab_on_off;if(tab_on_off==2){this.getListInverter();}else{this.getList();}}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(nextProps){var _this2=this;var self=this;var tab_on_off=this.state.tab_on_off;if(nextProps.match.params.id!==this.props.match.params.id){this.setState({hash_id:nextProps.match.params.id},function(){if(tab_on_off==2){_this2.getListInverter();}else{_this2.getList();}});}}},{key:\"setTabOnOff\",value:function setTabOnOff(index){var self=this;this.setState({tab_on_off:index},function(){if(index==2){self.getListInverter();}else{self.getList();}});}/**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */},{key:\"getListInverter\",value:function getListInverter(){var self=this;var params=this.state.searchParam;params.id_language=this.employee.id_language;params.id_employee=this.employee.id_employee;params.hash_id=this.state.hash_id;params.type='private';MainDeviceService.instance.getListInverter(params,function(data,total_row){if(Libs.isArrayData(data)){self.setState({dataListInverter:data});}else{self.setState({dataListInverter:[]});}self.forceUpdate();});}/**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */},{key:\"handleInputDateChange\",value:function handleInputDateChange(event){var target=event.target;var name=target.name;var self=this;var value=target.value;if(target.type==='checkbox'){value=target.checked?1:0;}if(name){var searchParam=this.state.searchParam;searchParam[name]=value;this.setState({searchParam:searchParam},function(){self.getPowerNowByDay();});}}},{key:\"getPowerNowByDay\",value:function(){var _getPowerNowByDay=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$state2,dataList,searchParam,self;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$state2=this.state,dataList=_this$state2.dataList,searchParam=_this$state2.searchParam,self=this;if(Libs.isArrayData(dataList)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:searchParam=Object.assign({},searchParam);searchParam.current_date=Libs.dateFormat(searchParam.current_date,'YYYY-MM-DD HH:mm:ss','DD/MM/YYYY HH:mm:ss');searchParam.dataList=dataList;_context.next=8;return MainDeviceService.instance.getPowerNowByDay(searchParam,function(data){if(data){self.setState({dataList:data.dataList});}},false);case 8:case\"end\":return _context.stop();}}},_callee,this);}));function getPowerNowByDay(){return _getPowerNowByDay.apply(this,arguments);}return getPowerNowByDay;}()},{key:\"getList\",value:/**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */function getList(){var self=this;var params=this.state.searchParam;params.id_language=this.employee.id_language;params.id_employee=this.employee.id_employee;params.hash_id=this.state.hash_id;params.type='private';MainDeviceService.instance.getListDeviceByHashId(params,function(data,total_row){if(Libs.isArrayData(data)){self.setState({dataList:data});var total=parseInt(total_row/self.state.searchParam.limit);if(total_row%self.state.searchParam.limit>0){total=total+1;}self.paging.total=total;self.paging.current=self.state.searchParam.index;self.paging.currentInput=self.state.searchParam.index;self.state.total_row=total_row;}else{self.setState({dataList:[],total_row:0});self.paging.total=0;self.paging.current=1;self.paging.currentInput=1;}self.forceUpdate();});}},{key:\"inputChangedHandler\",value:function inputChangedHandler(event){var self=this;var target=event.target;var name=target.name;var value=target.value;if(name==='current'){if(!Libs.isBlank(value)){var t=this.props.t;if(!Libs.isNumber(value)){self.toast(t('common.page_is_number'),\"error\");return;}}self.paging.currentInput=value;self.forceUpdate();}if(name==='limit'){var searchParam=this.state.searchParam;searchParam.limit=value;this.setState({searchParam:searchParam},function(){self.getList();});}}},{key:\"inputChangedEnter\",value:function inputChangedEnter(event){var self=this;if(event.key==='Enter'){var currentInput=this.paging.currentInput;if(!Libs.isBlank(currentInput)){var t=this.props.t;if(!Libs.isNumber(currentInput)){self.toast(t('common.page_is_number'),\"error\");return;}}if(Libs.isBlank(currentInput)&&!Libs.isNumber(currentInput))return;if(parseInt(currentInput)>this.paging.total){currentInput=self.paging.total;}if(currentInput<=0){currentInput=1;}self.paging.current=currentInput;self.paging.currentInput=currentInput;this.onSelectPage(currentInput);self.forceUpdate();}}},{key:\"inputChangedBlue\",value:function inputChangedBlue(event){var self=this;var target=event.target;var name=target.name;if(name==='current'){var currentInput=this.paging.currentInput;if(!Libs.isBlank(currentInput)){var t=this.props.t;if(!Libs.isNumber(currentInput)){self.toast(t('common.page_is_number'),\"error\");return;}}if(Libs.isBlank(currentInput)&&!Libs.isNumber(currentInput))return;if(parseInt(currentInput)>this.paging.total){currentInput=self.paging.total;}if(currentInput<=0){currentInput=1;}self.paging.current=currentInput;self.paging.currentInput=currentInput;this.onSelectPage(currentInput);self.forceUpdate();}}/**\n     * @description Select page in pagging\n     * @author long.pham 09/05/2021\n     * @param {int} index\n     */},{key:\"onSelectPage\",value:function onSelectPage(index){var self=this;self.state.searchParam.index=index;if(index>0){self.state.searchParam.offset=(index-1)*self.state.searchParam.limit;}else{self.state.searchParam.offset=0;}self.getList();}/**\n     * @description reload data\n     * @author long.pham 09/05/2021\n     * @param {int} index\n     */},{key:\"onClickReload\",value:function onClickReload(){var self=this;self.getList();}/**\n    * Func filter table\n    * @author Long.Pham 12-05-2021\n    * @param  {Object} e\n    */},{key:\"onSort\",value:function onSort(event,sortKey){this.state.searchParam.sort_column=sortKey;this.state.searchParam.order_by=this.state.searchParam.order_by===''||this.state.searchParam.order_by==='asc'?'desc':'asc';this.getList();}/**\n      * @description Call form search\n      * @author Long.Pham 12/05/2021\n      */},{key:\"onSearch\",value:function onSearch(){var formSearch=this.state.formSearch===false?true:false;this.setState({formSearch:formSearch});}},{key:\"onResetSearch\",value:function onResetSearch(){var self=this;var searchParam=this.state.searchParam;searchParam.name=null;searchParam.id=null;searchParam.index=1;searchParam.offset=0;self.paging.current=1;self.paging.currentInput=1;self.paging.total=1;self.setState({searchParam:searchParam},function(){self.getList();});}/**\n     * Func search\n     * @author Long.Pham 12/05/2021\n     * @param  {Object} e\n     */},{key:\"handleSearch\",value:function handleSearch(){this.getList();}},{key:\"render\",value:function render(){return this.jsxTemplate.call(this);}}]);return Device;}(BaseComponent);var HighOrderComponentTranslated=withTranslation('common')(Device);export default HighOrderComponentTranslated;","map":{"version":3,"sources":["/Volumes/Data/sources/solarmon_production/solarmon_frontend/src/containers/views/desktop/ModulePrivate/Device/Device.js"],"names":["DeviceJsx","BaseComponent","Libs","withTranslation","Constants","MainDeviceService","FileSaver","XLSX","moment","Device","props","context","onClickControlCalender","index","dataListInverter","state","isArrayData","item","isObjectEmpty","setState","showControlCalendar","curItem","onCloseControlCalender","onClickOnOff","showOnOffPopup","onClickCloseOnOff","status","getListInverter","downloadData","dataList","t","dataExport","i","len","length","itemLevel","alerts","error","warning","info","fatal","debug","j","leng","parseInt","id","total_alert","push","name","model","serial_number","device_type_name","isBlank","power_now","formatNum","energy_today","lifetime","formatElectricalUnit","fileType","fileExtension","ws","utils","json_to_sheet","skipHeader","wb","SheetNames","Sheets","excelBuffer","write","bookType","type","data","Blob","saveAs","format","onClickViewDevice","screen_mode","SCREEN_MODE","ADD","show_tab","viewDevice","onClickChartDevice","viewAlertDevice","Object","assign","onClickCloseViewDevice","jsxTemplate","hash_id","params","tab_on_off","searchParam","limit","COMMON","LIMIT","offset","max_date","getCurrentDDMMYYYY","current_date","formSearch","paging","total","current","currentInput","inputChangedHandler","bind","inputChangedEnter","inputChangedBlue","getList","nextProps","self","match","id_language","employee","id_employee","instance","total_row","forceUpdate","event","target","value","checked","getPowerNowByDay","dateFormat","getListDeviceByHashId","isNumber","toast","key","onSelectPage","sortKey","sort_column","order_by","call","HighOrderComponentTranslated"],"mappings":"2tCAAA,MAAOA,CAAAA,SAAP,KAAsB,cAAtB,CACA,MAAOC,CAAAA,aAAP,KAA0B,2BAA1B,CACA,MAAOC,CAAAA,IAAP,KAAiB,2BAAjB,CACA,OAASC,eAAT,KAAgC,eAAhC,CACA,MAAOC,CAAAA,SAAP,KAAsB,gCAAtB,CACA,MAAOC,CAAAA,iBAAP,KAA8B,2CAA9B,CACA,MAAO,GAAKC,CAAAA,SAAZ,KAA2B,YAA3B,CACA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,MAAtB,CACA,MAAOC,CAAAA,MAAP,KAAmB,QAAnB,C,GAEMC,CAAAA,M,wGAEF,gBAAYC,KAAZ,CAAmBC,OAAnB,CAA4B,wCACxB,uBAAMD,KAAN,CAAaC,OAAb,EADwB,MA6D5BC,sBA7D4B,CA6DH,SAACC,KAAD,CAAW,CAChC,GAAMC,CAAAA,gBAAN,CAA2B,MAAKC,KAAhC,CAAMD,gBAAN,CACA,GAAI,CAACZ,IAAI,CAACc,WAAL,CAAiBF,gBAAjB,CAAL,CAAyC,OACzC,GAAIG,CAAAA,IAAI,CAAGH,gBAAgB,CAACD,KAAD,CAA3B,CACA,GAAIX,IAAI,CAACgB,aAAL,CAAmBD,IAAnB,CAAJ,CAA8B,OAC9B,MAAKE,QAAL,CAAc,CACVC,mBAAmB,CAAE,IADX,CAEVC,OAAO,CAAEJ,IAFC,CAAd,EAKH,CAvE2B,OAyE5BK,sBAzE4B,CAyEH,UAAM,CAC3B,MAAKH,QAAL,CAAc,CACVC,mBAAmB,CAAE,KADX,CAAd,EAIH,CA9E2B,OAiF5BG,YAjF4B,CAiFb,SAACV,KAAD,CAAW,CACtB,GAAMC,CAAAA,gBAAN,CAA2B,MAAKC,KAAhC,CAAMD,gBAAN,CACA,GAAI,CAACZ,IAAI,CAACc,WAAL,CAAiBF,gBAAjB,CAAL,CAAyC,OACzC,GAAIG,CAAAA,IAAI,CAAGH,gBAAgB,CAACD,KAAD,CAA3B,CACA,GAAIX,IAAI,CAACgB,aAAL,CAAmBD,IAAnB,CAAJ,CAA8B,OAC9B,MAAKE,QAAL,CAAc,CACVK,cAAc,CAAE,IADN,CAEVH,OAAO,CAAEJ,IAFC,CAAd,EAKH,CA3F2B,OA6F5BQ,iBA7F4B,CA6FR,SAACC,MAAD,CAAY,CAC5B,GAAIA,MAAJ,CAAY,CACR,MAAKC,eAAL,GACH,CACD,MAAKR,QAAL,CAAc,CACVK,cAAc,CAAE,KADN,CAAd,EAIH,CArG2B,OAsL5BI,YAtL4B,CAsLb,UAAM,CACjB,GAAMC,CAAAA,QAAN,CAAmB,MAAKd,KAAxB,CAAMc,QAAN,CACA,GAAMC,CAAAA,CAAN,CAAY,MAAKpB,KAAjB,CAAMoB,CAAN,CACA,GAAI,CAAC5B,IAAI,CAACc,WAAL,CAAiBa,QAAjB,CAAL,CAAiC,OAEjC,GAAIE,CAAAA,UAAU,CAAG,EAAjB,CACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAR,CAAWC,GAAG,CAAGJ,QAAQ,CAACK,MAA/B,CAAuCF,CAAC,CAAGC,GAA3C,CAAgDD,CAAC,EAAjD,CAAqD,CACjD,GAAIG,CAAAA,SAAS,CAAGN,QAAQ,CAACG,CAAD,CAAR,CAAYI,MAA5B,CACA,GAAIC,CAAAA,KAAK,CAAG,CAAZ,CAAeC,OAAO,CAAG,CAAzB,CAA4BC,IAAI,CAAG,CAAnC,CAAsCC,KAAK,CAAG,CAA9C,CAAiDC,KAAK,CAAG,CAAzD,CACA,GAAIvC,IAAI,CAACc,WAAL,CAAiBmB,SAAjB,CAAJ,CAAiC,CAC7B,IAAK,GAAIO,CAAAA,CAAC,CAAG,CAAR,CAAWC,IAAI,CAAGR,SAAS,CAACD,MAAjC,CAAyCQ,CAAC,CAAGC,IAA7C,CAAmDD,CAAC,EAApD,CAAwD,CACpD,OAAQE,QAAQ,CAACT,SAAS,CAACO,CAAD,CAAT,CAAaG,EAAd,CAAhB,EACI,IAAK,EAAL,CACIR,KAAK,CAAGF,SAAS,CAACO,CAAD,CAAT,CAAaI,WAArB,CACA,MACJ,IAAK,EAAL,CACIR,OAAO,CAAGH,SAAS,CAACO,CAAD,CAAT,CAAaI,WAAvB,CACA,MACJ,IAAK,EAAL,CACIP,IAAI,CAAGJ,SAAS,CAACO,CAAD,CAAT,CAAaI,WAApB,CACA,MACJ,IAAK,EAAL,CACIN,KAAK,CAAGL,SAAS,CAACO,CAAD,CAAT,CAAaI,WAArB,CACA,MACJ,IAAK,EAAL,CACIL,KAAK,CAAGN,SAAS,CAACO,CAAD,CAAT,CAAaI,WAArB,CACA,MAfR,CAiBH,CACJ,CACDf,UAAU,CAACgB,IAAX,CAAgB,CACZ,KAAMlB,QAAQ,CAACG,CAAD,CAAR,CAAYa,EADN,CAEZ,cAAehB,QAAQ,CAACG,CAAD,CAAR,CAAYgB,IAFf,CAGZ,QAASnB,QAAQ,CAACG,CAAD,CAAR,CAAYiB,KAHT,CAIZ,gBAAiBpB,QAAQ,CAACG,CAAD,CAAR,CAAYkB,aAJjB,CAKZ,cAAerB,QAAQ,CAACG,CAAD,CAAR,CAAYmB,gBALf,CAMZ,YAAa,CAACjD,IAAI,CAACkD,OAAL,CAAavB,QAAQ,CAACG,CAAD,CAAR,CAAYqB,SAAzB,CAAD,CAAuCnD,IAAI,CAACoD,SAAL,CAAezB,QAAQ,CAACG,CAAD,CAAR,CAAYqB,SAA3B,CAAsC,UAAtC,EAAoD,KAA3F,CAAmG,KANpG,CAOZ,eAAgB,CAACnD,IAAI,CAACkD,OAAL,CAAavB,QAAQ,CAACG,CAAD,CAAR,CAAYuB,YAAzB,CAAD,CAA0CrD,IAAI,CAACoD,SAAL,CAAezB,QAAQ,CAACG,CAAD,CAAR,CAAYuB,YAA3B,CAAyC,UAAzC,EAAuD,MAAjG,CAAyG,KAP7G,CAQZ,WAAY,CAACrD,IAAI,CAACkD,OAAL,CAAavB,QAAQ,CAACG,CAAD,CAAR,CAAYwB,QAAzB,CAAD,CAAsCtD,IAAI,CAACuD,oBAAL,CAA0B5B,QAAQ,CAACG,CAAD,CAAR,CAAYwB,QAAtC,CAAgD,GAAhD,CAAtC,CAA6F,KAR7F,CASZ,QAASnB,KATG,CAUZ,UAAWC,OAVC,CAWZ,OAAQC,IAXI,CAYZ,QAASC,KAZG,CAaZ,QAASC,KAbG,CAAhB,EAeH,CAED,GAAMiB,CAAAA,QAAQ,CAAG,iFAAjB,CACA,GAAMC,CAAAA,aAAa,CAAG,OAAtB,CACA,GAAMC,CAAAA,EAAE,CAAGrD,IAAI,CAACsD,KAAL,CAAWC,aAAX,CAAyB/B,UAAzB,CAAqC,CAAEgC,UAAU,CAAE,KAAd,CAArC,CAAX,CACA,GAAMC,CAAAA,EAAE,CAAG,CACPC,UAAU,CAAE,CAAC,QAAD,CADL,CAEPC,MAAM,CAAE,CAAE,SAAUN,EAAZ,CAFD,CAAX,CAIA,GAAMO,CAAAA,WAAW,CAAG5D,IAAI,CAAC6D,KAAL,CAAWJ,EAAX,CAAe,CAAEK,QAAQ,CAAE,MAAZ,CAAoBC,IAAI,CAAE,OAA1B,CAAf,CAApB,CACA,GAAMC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,CAAS,CAACL,WAAD,CAAT,CAAwB,CAAEG,IAAI,CAAEZ,QAAR,CAAxB,CAAb,CACApD,SAAS,CAACmE,MAAV,CAAiBF,IAAjB,CAAuB,iBAAmB/D,MAAM,GAAGkE,MAAT,CAAgB,qBAAhB,CAAnB,CAA4Df,aAAnF,EACH,CA/O2B,OAwR5BgB,iBAxR4B,CAwRR,SAAC9D,KAAD,CAAW,CAC3B,GAAMgB,CAAAA,QAAN,CAAmB,MAAKd,KAAxB,CAAMc,QAAN,CACA,GAAI,CAAC3B,IAAI,CAACc,WAAL,CAAiBa,QAAjB,CAAL,CAAiC,OACjC,GAAIZ,CAAAA,IAAI,CAAGY,QAAQ,CAAChB,KAAD,CAAnB,CACA,GAAIX,IAAI,CAACgB,aAAL,CAAmBD,IAAnB,CAAJ,CAA8B,OAE9BA,IAAI,CAAC2D,WAAL,CAAmBxE,SAAS,CAACyE,WAAV,CAAsBC,GAAzC,CACA,MAAK3D,QAAL,CAAc,CACV4D,QAAQ,CAAE,CADA,CAEV1D,OAAO,CAAEJ,IAFC,CAGV+D,UAAU,CAAE,IAHF,CAAd,EAKH,CApS2B,OAuS5BC,kBAvS4B,CAuSP,SAACpE,KAAD,CAAW,CAC5B,GAAMgB,CAAAA,QAAN,CAAmB,MAAKd,KAAxB,CAAMc,QAAN,CACA,GAAI,CAAC3B,IAAI,CAACc,WAAL,CAAiBa,QAAjB,CAAL,CAAiC,OACjC,GAAIZ,CAAAA,IAAI,CAAGY,QAAQ,CAAChB,KAAD,CAAnB,CACA,GAAIX,IAAI,CAACgB,aAAL,CAAmBD,IAAnB,CAAJ,CAA8B,OAE9BA,IAAI,CAAC2D,WAAL,CAAmBxE,SAAS,CAACyE,WAAV,CAAsBC,GAAzC,CACA,MAAK3D,QAAL,CAAc,CACV4D,QAAQ,CAAE,CADA,CAEV1D,OAAO,CAAEJ,IAFC,CAGV+D,UAAU,CAAE,IAHF,CAAd,EAMA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACH,CA9T2B,OAgU5BE,eAhU4B,CAgUV,SAACrE,KAAD,CAAW,CACzB,gBAA4B,MAAKE,KAAjC,CAAMc,QAAN,aAAMA,QAAN,CAAgBR,OAAhB,aAAgBA,OAAhB,CACA,GAAI,CAACnB,IAAI,CAACc,WAAL,CAAiBa,QAAjB,CAAL,CAAiC,OACjC,GAAIZ,CAAAA,IAAI,CAAGY,QAAQ,CAAChB,KAAD,CAAnB,CACA,GAAIX,IAAI,CAACgB,aAAL,CAAmBD,IAAnB,CAAJ,CAA8B,OAC9BI,OAAO,CAACuD,WAAR,CAAsBxE,SAAS,CAACyE,WAAV,CAAsBC,GAA5C,CACA,MAAK3D,QAAL,CAAc,CACVE,OAAO,CAAE8D,MAAM,CAACC,MAAP,CAAc/D,OAAd,CAAuBJ,IAAvB,CADC,CAEV8D,QAAQ,CAAE,CAFA,CAGVC,UAAU,CAAE,IAHF,CAAd,EAKH,CA3U2B,OA6U5BK,sBA7U4B,CA6UH,SAAC3D,MAAD,CAAY,CACjC,GAAIA,MAAJ,CAAY,CACR;AACH,CACD,MAAKP,QAAL,CAAc,CACV6D,UAAU,CAAE,KADF,CAAd,EAGH,CApV2B,CAExB,MAAKM,WAAL,CAAmBtF,SAAnB,CACA,MAAKe,KAAL,CAAa,CACTwE,OAAO,CAAE,CAACrF,IAAI,CAACgB,aAAL,CAAmB,MAAKsE,MAAxB,CAAD,CAAmC,MAAKA,MAAL,CAAY3C,EAA/C,CAAoD,IADpD,CAETxB,OAAO,CAAE,EAFA,CAGTQ,QAAQ,CAAE,EAHD,CAITf,gBAAgB,CAAE,EAJT,CAKTiE,QAAQ,CAAE,CALD,CAMTU,UAAU,CAAE,CANH,CAOTjE,cAAc,CAAE,KAPP,CAQTJ,mBAAmB,CAAE,KARZ,CASTsE,WAAW,CAAE,CACTC,KAAK,CAAEvF,SAAS,CAACwF,MAAV,CAAiBC,KADf,CAETC,MAAM,CAAE,CAFC,CAGTjF,KAAK,CAAE,CAHE,CAITkF,QAAQ,CAAE7F,IAAI,CAAC8F,kBAAL,EAJD,CAKTC,YAAY,CAAE/F,IAAI,CAAC8F,kBAAL,EALL,CATJ,CAgBThB,UAAU,CAAE,KAhBH,CAiBTkB,UAAU,CAAE,KAjBH,CAAb,CAoBA,MAAKC,MAAL,CAAc,CACVC,KAAK,CAAE,CADG,CAEVC,OAAO,CAAE,CAFC,CAGVC,YAAY,CAAE,CAHJ,CAAd,CAKA,MAAKC,mBAAL,CAA2B,MAAKA,mBAAL,CAAyBC,IAAzB,+BAA3B,CACA,MAAKC,iBAAL,CAAyB,MAAKA,iBAAL,CAAuBD,IAAvB,+BAAzB,CACA,MAAKE,gBAAL,CAAwB,MAAKA,gBAAL,CAAsBF,IAAtB,+BAAxB,CA9BwB,aAgC3B,C,oDAED,4BAAoB,CAChB,GAAMf,CAAAA,UAAN,CAAqB,KAAK1E,KAA1B,CAAM0E,UAAN,CACA,GAAIA,UAAU,EAAI,CAAlB,CAAqB,CACjB,KAAK9D,eAAL,GACH,CAFD,IAEO,CACH,KAAKgF,OAAL,GACH,CAEJ,C,yCAED,mCAA0BC,SAA1B,CAAqC,iBACjC,GAAIC,CAAAA,IAAI,CAAG,IAAX,CACA,GAAMpB,CAAAA,UAAN,CAAqB,KAAK1E,KAA1B,CAAM0E,UAAN,CACA,GAAImB,SAAS,CAACE,KAAV,CAAgBtB,MAAhB,CAAuB3C,EAAvB,GAA8B,KAAKnC,KAAL,CAAWoG,KAAX,CAAiBtB,MAAjB,CAAwB3C,EAA1D,CAA8D,CAC1D,KAAK1B,QAAL,CAAc,CACVoE,OAAO,CAAEqB,SAAS,CAACE,KAAV,CAAgBtB,MAAhB,CAAuB3C,EADtB,CAAd,CAEG,UAAM,CACL,GAAI4C,UAAU,EAAI,CAAlB,CAAqB,CACjB,MAAI,CAAC9D,eAAL,GACH,CAFD,IAEO,CACH,MAAI,CAACgF,OAAL,GACH,CACJ,CARD,EASH,CACJ,C,2BA6CD,qBAAY9F,KAAZ,CAAmB,CACf,GAAIgG,CAAAA,IAAI,CAAG,IAAX,CACA,KAAK1F,QAAL,CAAc,CACVsE,UAAU,CAAE5E,KADF,CAAd,CAEG,UAAM,CACL,GAAIA,KAAK,EAAI,CAAb,CAAgB,CACZgG,IAAI,CAAClF,eAAL,GACH,CAFD,IAEO,CACHkF,IAAI,CAACF,OAAL,GACH,CACJ,CARD,EAUH,CAGD;AACJ;AACA;AACA,O,+BACI,0BAAkB,CACd,GAAIE,CAAAA,IAAI,CAAG,IAAX,CACA,GAAIrB,CAAAA,MAAM,CAAG,KAAKzE,KAAL,CAAW2E,WAAxB,CACAF,MAAM,CAACuB,WAAP,CAAqB,KAAKC,QAAL,CAAcD,WAAnC,CACAvB,MAAM,CAACyB,WAAP,CAAqB,KAAKD,QAAL,CAAcC,WAAnC,CACAzB,MAAM,CAACD,OAAP,CAAiB,KAAKxE,KAAL,CAAWwE,OAA5B,CACAC,MAAM,CAAClB,IAAP,CAAc,SAAd,CACAjE,iBAAiB,CAAC6G,QAAlB,CAA2BvF,eAA3B,CAA2C6D,MAA3C,CAAmD,SAACjB,IAAD,CAAO4C,SAAP,CAAqB,CACpE,GAAIjH,IAAI,CAACc,WAAL,CAAiBuD,IAAjB,CAAJ,CAA4B,CACxBsC,IAAI,CAAC1F,QAAL,CAAc,CACVL,gBAAgB,CAAEyD,IADR,CAAd,EAGH,CAJD,IAIO,CACHsC,IAAI,CAAC1F,QAAL,CAAc,CACVL,gBAAgB,CAAE,EADR,CAAd,EAGH,CACD+F,IAAI,CAACO,WAAL,GACH,CAXD,EAYH,CAED;AACJ;AACA;AACA,O,qCACI,+BAAsBC,KAAtB,CAA6B,CACzB,GAAIC,CAAAA,MAAM,CAAGD,KAAK,CAACC,MAAnB,CACA,GAAItE,CAAAA,IAAI,CAAGsE,MAAM,CAACtE,IAAlB,CACA,GAAI6D,CAAAA,IAAI,CAAG,IAAX,CACA,GAAIU,CAAAA,KAAK,CAAGD,MAAM,CAACC,KAAnB,CACA,GAAID,MAAM,CAAChD,IAAP,GAAgB,UAApB,CAAgC,CAC5BiD,KAAK,CAAGD,MAAM,CAACE,OAAP,CAAiB,CAAjB,CAAqB,CAA7B,CACH,CAED,GAAIxE,IAAJ,CAAU,CACN,GAAM0C,CAAAA,WAAN,CAAsB,KAAK3E,KAA3B,CAAM2E,WAAN,CACAA,WAAW,CAAC1C,IAAD,CAAX,CAAoBuE,KAApB,CACA,KAAKpG,QAAL,CAAc,CAAEuE,WAAW,CAAXA,WAAF,CAAd,CAA+B,UAAM,CACjCmB,IAAI,CAACY,gBAAL,GACH,CAFD,EAGH,CACJ,C,yHAGD,2LACoC,KAAK1G,KADzC,CACUc,QADV,cACUA,QADV,CACoB6D,WADpB,cACoBA,WADpB,CACgDmB,IADhD,CACuD,IADvD,IAES3G,IAAI,CAACc,WAAL,CAAiBa,QAAjB,CAFT,iEAGQ6D,WAHR,CAGsBP,MAAM,CAACC,MAAP,CAAc,EAAd,CAAkBM,WAAlB,CAHtB,CAIIA,WAAW,CAACO,YAAZ,CAA2B/F,IAAI,CAACwH,UAAL,CAAgBhC,WAAW,CAACO,YAA5B,CAA0C,qBAA1C,CAAiE,qBAAjE,CAA3B,CACAP,WAAW,CAAC7D,QAAZ,CAAuBA,QAAvB,CALJ,sBAMUxB,CAAAA,iBAAiB,CAAC6G,QAAlB,CAA2BO,gBAA3B,CAA4C/B,WAA5C,CAAyD,SAAAnB,IAAI,CAAI,CACnE,GAAIA,IAAJ,CAAU,CACNsC,IAAI,CAAC1F,QAAL,CAAc,CACVU,QAAQ,CAAE0C,IAAI,CAAC1C,QADL,CAAd,EAGH,CACJ,CANK,CAMH,KANG,CANV,4D,iIA0EA;AACJ;AACA;AACA,OACI,kBAAU,CACN,GAAIgF,CAAAA,IAAI,CAAG,IAAX,CACA,GAAIrB,CAAAA,MAAM,CAAG,KAAKzE,KAAL,CAAW2E,WAAxB,CACAF,MAAM,CAACuB,WAAP,CAAqB,KAAKC,QAAL,CAAcD,WAAnC,CACAvB,MAAM,CAACyB,WAAP,CAAqB,KAAKD,QAAL,CAAcC,WAAnC,CACAzB,MAAM,CAACD,OAAP,CAAiB,KAAKxE,KAAL,CAAWwE,OAA5B,CACAC,MAAM,CAAClB,IAAP,CAAc,SAAd,CACAjE,iBAAiB,CAAC6G,QAAlB,CAA2BS,qBAA3B,CAAiDnC,MAAjD,CAAyD,SAACjB,IAAD,CAAO4C,SAAP,CAAqB,CAC1E,GAAIjH,IAAI,CAACc,WAAL,CAAiBuD,IAAjB,CAAJ,CAA4B,CACxBsC,IAAI,CAAC1F,QAAL,CAAc,CACVU,QAAQ,CAAE0C,IADA,CAAd,EAIA,GAAI6B,CAAAA,KAAK,CAAGxD,QAAQ,CAACuE,SAAS,CAAGN,IAAI,CAAC9F,KAAL,CAAW2E,WAAX,CAAuBC,KAApC,CAApB,CACA,GAAIwB,SAAS,CAAGN,IAAI,CAAC9F,KAAL,CAAW2E,WAAX,CAAuBC,KAAnC,CAA2C,CAA/C,CAAkD,CAC9CS,KAAK,CAAGA,KAAK,CAAG,CAAhB,CACH,CACDS,IAAI,CAACV,MAAL,CAAYC,KAAZ,CAAoBA,KAApB,CACAS,IAAI,CAACV,MAAL,CAAYE,OAAZ,CAAsBQ,IAAI,CAAC9F,KAAL,CAAW2E,WAAX,CAAuB7E,KAA7C,CACAgG,IAAI,CAACV,MAAL,CAAYG,YAAZ,CAA2BO,IAAI,CAAC9F,KAAL,CAAW2E,WAAX,CAAuB7E,KAAlD,CACAgG,IAAI,CAAC9F,KAAL,CAAWoG,SAAX,CAAuBA,SAAvB,CAEH,CAdD,IAcO,CACHN,IAAI,CAAC1F,QAAL,CAAc,CACVU,QAAQ,CAAE,EADA,CAEVsF,SAAS,CAAE,CAFD,CAAd,EAIAN,IAAI,CAACV,MAAL,CAAYC,KAAZ,CAAoB,CAApB,CACAS,IAAI,CAACV,MAAL,CAAYE,OAAZ,CAAsB,CAAtB,CACAQ,IAAI,CAACV,MAAL,CAAYG,YAAZ,CAA2B,CAA3B,CACH,CACDO,IAAI,CAACO,WAAL,GACH,CAzBD,EA0BH,C,mCAoED,6BAAoBC,KAApB,CAA2B,CACvB,GAAIR,CAAAA,IAAI,CAAG,IAAX,CACA,GAAIS,CAAAA,MAAM,CAAGD,KAAK,CAACC,MAAnB,CACA,GAAItE,CAAAA,IAAI,CAAGsE,MAAM,CAACtE,IAAlB,CACA,GAAIuE,CAAAA,KAAK,CAAGD,MAAM,CAACC,KAAnB,CACA,GAAIvE,IAAI,GAAK,SAAb,CAAwB,CACpB,GAAI,CAAC9C,IAAI,CAACkD,OAAL,CAAamE,KAAb,CAAL,CAA0B,CACtB,GAAMzF,CAAAA,CAAN,CAAY,KAAKpB,KAAjB,CAAMoB,CAAN,CACA,GAAI,CAAC5B,IAAI,CAAC0H,QAAL,CAAcL,KAAd,CAAL,CAA2B,CACvBV,IAAI,CAACgB,KAAL,CAAW/F,CAAC,CAAC,uBAAD,CAAZ,CAAuC,OAAvC,EACA,OACH,CACJ,CAED+E,IAAI,CAACV,MAAL,CAAYG,YAAZ,CAA2BiB,KAA3B,CACAV,IAAI,CAACO,WAAL,GACH,CAED,GAAIpE,IAAI,GAAK,OAAb,CAAsB,CAClB,GAAM0C,CAAAA,WAAN,CAAsB,KAAK3E,KAA3B,CAAM2E,WAAN,CACAA,WAAW,CAACC,KAAZ,CAAoB4B,KAApB,CACA,KAAKpG,QAAL,CAAc,CACVuE,WAAW,CAAEA,WADH,CAAd,CAEG,UAAM,CACLmB,IAAI,CAACF,OAAL,GACH,CAJD,EAKH,CACJ,C,iCAED,2BAAkBU,KAAlB,CAAyB,CACrB,GAAIR,CAAAA,IAAI,CAAG,IAAX,CACA,GAAIQ,KAAK,CAACS,GAAN,GAAc,OAAlB,CAA2B,CACvB,GAAIxB,CAAAA,YAAY,CAAG,KAAKH,MAAL,CAAYG,YAA/B,CACA,GAAI,CAACpG,IAAI,CAACkD,OAAL,CAAakD,YAAb,CAAL,CAAiC,CAC7B,GAAMxE,CAAAA,CAAN,CAAY,KAAKpB,KAAjB,CAAMoB,CAAN,CACA,GAAI,CAAC5B,IAAI,CAAC0H,QAAL,CAActB,YAAd,CAAL,CAAkC,CAC9BO,IAAI,CAACgB,KAAL,CAAW/F,CAAC,CAAC,uBAAD,CAAZ,CAAuC,OAAvC,EACA,OACH,CACJ,CAED,GAAI5B,IAAI,CAACkD,OAAL,CAAakD,YAAb,GAA8B,CAACpG,IAAI,CAAC0H,QAAL,CAActB,YAAd,CAAnC,CAAgE,OAChE,GAAI1D,QAAQ,CAAC0D,YAAD,CAAR,CAAyB,KAAKH,MAAL,CAAYC,KAAzC,CAAgD,CAC5CE,YAAY,CAAGO,IAAI,CAACV,MAAL,CAAYC,KAA3B,CACH,CAED,GAAIE,YAAY,EAAI,CAApB,CAAuB,CACnBA,YAAY,CAAG,CAAf,CACH,CAEDO,IAAI,CAACV,MAAL,CAAYE,OAAZ,CAAsBC,YAAtB,CACAO,IAAI,CAACV,MAAL,CAAYG,YAAZ,CAA2BA,YAA3B,CACA,KAAKyB,YAAL,CAAkBzB,YAAlB,EACAO,IAAI,CAACO,WAAL,GACH,CACJ,C,gCAED,0BAAiBC,KAAjB,CAAwB,CACpB,GAAIR,CAAAA,IAAI,CAAG,IAAX,CACA,GAAIS,CAAAA,MAAM,CAAGD,KAAK,CAACC,MAAnB,CACA,GAAItE,CAAAA,IAAI,CAAGsE,MAAM,CAACtE,IAAlB,CACA,GAAIA,IAAI,GAAK,SAAb,CAAwB,CACpB,GAAIsD,CAAAA,YAAY,CAAG,KAAKH,MAAL,CAAYG,YAA/B,CACA,GAAI,CAACpG,IAAI,CAACkD,OAAL,CAAakD,YAAb,CAAL,CAAiC,CAC7B,GAAMxE,CAAAA,CAAN,CAAY,KAAKpB,KAAjB,CAAMoB,CAAN,CACA,GAAI,CAAC5B,IAAI,CAAC0H,QAAL,CAActB,YAAd,CAAL,CAAkC,CAC9BO,IAAI,CAACgB,KAAL,CAAW/F,CAAC,CAAC,uBAAD,CAAZ,CAAuC,OAAvC,EACA,OACH,CACJ,CAED,GAAI5B,IAAI,CAACkD,OAAL,CAAakD,YAAb,GAA8B,CAACpG,IAAI,CAAC0H,QAAL,CAActB,YAAd,CAAnC,CAAgE,OAChE,GAAI1D,QAAQ,CAAC0D,YAAD,CAAR,CAAyB,KAAKH,MAAL,CAAYC,KAAzC,CAAgD,CAC5CE,YAAY,CAAGO,IAAI,CAACV,MAAL,CAAYC,KAA3B,CACH,CAED,GAAIE,YAAY,EAAI,CAApB,CAAuB,CACnBA,YAAY,CAAG,CAAf,CACH,CAEDO,IAAI,CAACV,MAAL,CAAYE,OAAZ,CAAsBC,YAAtB,CACAO,IAAI,CAACV,MAAL,CAAYG,YAAZ,CAA2BA,YAA3B,CACA,KAAKyB,YAAL,CAAkBzB,YAAlB,EACAO,IAAI,CAACO,WAAL,GACH,CACJ,CAGD;AACJ;AACA;AACA;AACA,O,4BACI,sBAAavG,KAAb,CAAoB,CAChB,GAAIgG,CAAAA,IAAI,CAAG,IAAX,CACAA,IAAI,CAAC9F,KAAL,CAAW2E,WAAX,CAAuB7E,KAAvB,CAA+BA,KAA/B,CAEA,GAAIA,KAAK,CAAG,CAAZ,CAAe,CACXgG,IAAI,CAAC9F,KAAL,CAAW2E,WAAX,CAAuBI,MAAvB,CAAgC,CAACjF,KAAK,CAAG,CAAT,EAAcgG,IAAI,CAAC9F,KAAL,CAAW2E,WAAX,CAAuBC,KAArE,CACH,CAFD,IAEO,CACHkB,IAAI,CAAC9F,KAAL,CAAW2E,WAAX,CAAuBI,MAAvB,CAAgC,CAAhC,CACH,CACDe,IAAI,CAACF,OAAL,GACH,CAGD;AACJ;AACA;AACA;AACA,O,6BACI,wBAAgB,CACZ,GAAIE,CAAAA,IAAI,CAAG,IAAX,CACAA,IAAI,CAACF,OAAL,GACH,CAGD;AACJ;AACA;AACA;AACA,M,sBAEI,gBAAOU,KAAP,CAAcW,OAAd,CAAuB,CACnB,KAAKjH,KAAL,CAAW2E,WAAX,CAAuBuC,WAAvB,CAAqCD,OAArC,CACA,KAAKjH,KAAL,CAAW2E,WAAX,CAAuBwC,QAAvB,CAAmC,KAAKnH,KAAL,CAAW2E,WAAX,CAAuBwC,QAAvB,GAAoC,EAApC,EAA0C,KAAKnH,KAAL,CAAW2E,WAAX,CAAuBwC,QAAvB,GAAoC,KAA/E,CAAwF,MAAxF,CAAiG,KAAnI,CACA,KAAKvB,OAAL,GACH,CAED;AACJ;AACA;AACA,Q,wBACI,mBAAW,CACP,GAAIT,CAAAA,UAAU,CAAI,KAAKnF,KAAL,CAAWmF,UAAX,GAA0B,KAA3B,CAAoC,IAApC,CAA2C,KAA5D,CACA,KAAK/E,QAAL,CAAc,CACV+E,UAAU,CAAEA,UADF,CAAd,EAGH,C,6BAED,wBAAgB,CACZ,GAAIW,CAAAA,IAAI,CAAG,IAAX,CACA,GAAInB,CAAAA,WAAW,CAAG,KAAK3E,KAAL,CAAW2E,WAA7B,CACAA,WAAW,CAAC1C,IAAZ,CAAmB,IAAnB,CACA0C,WAAW,CAAC7C,EAAZ,CAAiB,IAAjB,CACA6C,WAAW,CAAC7E,KAAZ,CAAoB,CAApB,CACA6E,WAAW,CAACI,MAAZ,CAAqB,CAArB,CACAe,IAAI,CAACV,MAAL,CAAYE,OAAZ,CAAsB,CAAtB,CACAQ,IAAI,CAACV,MAAL,CAAYG,YAAZ,CAA2B,CAA3B,CACAO,IAAI,CAACV,MAAL,CAAYC,KAAZ,CAAoB,CAApB,CACAS,IAAI,CAAC1F,QAAL,CAAc,CACVuE,WAAW,CAAEA,WADH,CAAd,CAEG,UAAM,CACLmB,IAAI,CAACF,OAAL,GACH,CAJD,EAKH,CAED;AACJ;AACA;AACA;AACA,O,4BACI,uBAAe,CACX,KAAKA,OAAL,GACH,C,sBAED,iBAAS,CACL,MAAO,MAAKrB,WAAL,CAAiB6C,IAAjB,CAAsB,IAAtB,CAAP,CACH,C,oBAngBgBlI,a,EAsgBrB,GAAMmI,CAAAA,4BAA4B,CAAGjI,eAAe,CAAC,QAAD,CAAf,CAA0BM,MAA1B,CAArC,CACA,cAAe2H,CAAAA,4BAAf","sourcesContent":["import DeviceJsx from './Device.jsx';\nimport BaseComponent from '../../../../BaseComponent';\nimport Libs from '../../../../../utils/Libs';\nimport { withTranslation } from 'react-i18next';\nimport Constants from '../../../../../utils/Constants';\nimport MainDeviceService from '../../../../../services/MainDeviceService';\nimport * as FileSaver from 'file-saver';\nimport * as XLSX from 'xlsx';\nimport moment from 'moment';\n\nclass Device extends BaseComponent {\n\n    constructor(props, context) {\n        super(props, context);\n        this.jsxTemplate = DeviceJsx;\n        this.state = {\n            hash_id: !Libs.isObjectEmpty(this.params) ? this.params.id : null,\n            curItem: {},\n            dataList: [],\n            dataListInverter: [],\n            show_tab: 1,\n            tab_on_off: 1,\n            showOnOffPopup: false,\n            showControlCalendar: false,\n            searchParam: {\n                limit: Constants.COMMON.LIMIT,\n                offset: 0,\n                index: 1,\n                max_date: Libs.getCurrentDDMMYYYY(),\n                current_date: Libs.getCurrentDDMMYYYY()\n            },\n            viewDevice: false,\n            formSearch: false\n        };\n\n        this.paging = {\n            total: 0,\n            current: 1,\n            currentInput: 1\n        };\n        this.inputChangedHandler = this.inputChangedHandler.bind(this);\n        this.inputChangedEnter = this.inputChangedEnter.bind(this);\n        this.inputChangedBlue = this.inputChangedBlue.bind(this);\n\n    }\n\n    componentDidMount() {\n        var { tab_on_off } = this.state;\n        if (tab_on_off == 2) {\n            this.getListInverter();\n        } else {\n            this.getList();\n        }\n\n    }\n\n    componentWillReceiveProps(nextProps) {\n        let self = this;\n        var { tab_on_off } = this.state;\n        if (nextProps.match.params.id !== this.props.match.params.id) {\n            this.setState({\n                hash_id: nextProps.match.params.id\n            }, () => {\n                if (tab_on_off == 2) {\n                    this.getListInverter();\n                } else {\n                    this.getList();\n                }\n            });\n        }\n    }\n\n\n    onClickControlCalender = (index) => {\n        var { dataListInverter } = this.state;\n        if (!Libs.isArrayData(dataListInverter)) return;\n        var item = dataListInverter[index];\n        if (Libs.isObjectEmpty(item)) return;\n        this.setState({\n            showControlCalendar: true,\n            curItem: item\n        })\n\n    }\n\n    onCloseControlCalender = () => {\n        this.setState({\n            showControlCalendar: false\n        })\n\n    }\n\n\n    onClickOnOff = (index) => {\n        var { dataListInverter } = this.state;\n        if (!Libs.isArrayData(dataListInverter)) return;\n        var item = dataListInverter[index];\n        if (Libs.isObjectEmpty(item)) return;\n        this.setState({\n            showOnOffPopup: true,\n            curItem: item\n        })\n\n    }\n\n    onClickCloseOnOff = (status) => {\n        if (status) {\n            this.getListInverter();\n        }\n        this.setState({\n            showOnOffPopup: false\n        })\n\n    }\n\n    setTabOnOff(index) {\n        var self = this;\n        this.setState({\n            tab_on_off: index\n        }, () => {\n            if (index == 2) {\n                self.getListInverter();\n            } else {\n                self.getList();\n            }\n        })\n\n    }\n\n\n    /**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */\n    getListInverter() {\n        let self = this;\n        let params = this.state.searchParam;\n        params.id_language = this.employee.id_language;\n        params.id_employee = this.employee.id_employee;\n        params.hash_id = this.state.hash_id;\n        params.type = 'private';\n        MainDeviceService.instance.getListInverter(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataListInverter: data\n                });\n            } else {\n                self.setState({\n                    dataListInverter: []\n                });\n            }\n            self.forceUpdate();\n        });\n    }\n\n    /**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */\n    handleInputDateChange(event) {\n        let target = event.target;\n        let name = target.name;\n        var self = this;\n        let value = target.value;\n        if (target.type === 'checkbox') {\n            value = target.checked ? 1 : 0;\n        }\n\n        if (name) {\n            let { searchParam } = this.state;\n            searchParam[name] = value;\n            this.setState({ searchParam }, () => {\n                self.getPowerNowByDay();\n            });\n        }\n    }\n\n\n    async getPowerNowByDay() {\n        var { dataList, searchParam } = this.state, self = this;\n        if (!Libs.isArrayData(dataList)) return;\n        var searchParam = Object.assign({}, searchParam);\n        searchParam.current_date = Libs.dateFormat(searchParam.current_date, 'YYYY-MM-DD HH:mm:ss', 'DD/MM/YYYY HH:mm:ss');\n        searchParam.dataList = dataList;\n        await MainDeviceService.instance.getPowerNowByDay(searchParam, data => {\n            if (data) {\n                self.setState({\n                    dataList: data.dataList\n                })\n            }\n        }, false);\n    }\n\n    \n    downloadData = () => {\n        var { dataList } = this.state;\n        var { t } = this.props;\n        if (!Libs.isArrayData(dataList)) return;\n\n        var dataExport = [];\n        for (var i = 0, len = dataList.length; i < len; i++) {\n            var itemLevel = dataList[i].alerts;\n            var error = 0, warning = 0, info = 0, fatal = 0, debug = 0;\n            if (Libs.isArrayData(itemLevel)) {\n                for (var j = 0, leng = itemLevel.length; j < leng; j++) {\n                    switch (parseInt(itemLevel[j].id)) {\n                        case 1:\n                            error = itemLevel[j].total_alert;\n                            break;\n                        case 2:\n                            warning = itemLevel[j].total_alert;\n                            break;\n                        case 3:\n                            info = itemLevel[j].total_alert;\n                            break;\n                        case 4:\n                            fatal = itemLevel[j].total_alert;\n                            break;\n                        case 5:\n                            debug = itemLevel[j].total_alert;\n                            break;\n                    }\n                }\n            }\n            dataExport.push({\n                'ID': dataList[i].id,\n                'Device name': dataList[i].name,\n                'Model': dataList[i].model,\n                'Serial number': dataList[i].serial_number,\n                'Device type': dataList[i].device_type_name,\n                'Power now': !Libs.isBlank(dataList[i].power_now) ? Libs.formatNum(dataList[i].power_now, '#,###.##') + \" kW\" : \"N/A\",\n                'Energy today': !Libs.isBlank(dataList[i].energy_today) ? Libs.formatNum(dataList[i].energy_today, '#,###.##') + \" kWh\": \"N/A\",\n                'Lifetime': !Libs.isBlank(dataList[i].lifetime) ? Libs.formatElectricalUnit(dataList[i].lifetime, 'h') : \"N/A\",\n                'Error': error,\n                'Warning': warning,\n                'Info': info,\n                'Fatal': fatal,\n                'Debug': debug\n            });\n        }\n\n        const fileType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';\n        const fileExtension = '.xlsx';\n        const ws = XLSX.utils.json_to_sheet(dataExport, { skipHeader: false });\n        const wb = {\n            SheetNames: ['Alerts'],\n            Sheets: { 'Alerts': ws }\n        };\n        const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\n        const data = new Blob([excelBuffer], { type: fileType });\n        FileSaver.saveAs(data, \"Export-alerts-\" + moment().format('YYYY-MM-DD_hh:mm:ss') + fileExtension);\n    }\n    /**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */\n    getList() {\n        let self = this;\n        let params = this.state.searchParam;\n        params.id_language = this.employee.id_language;\n        params.id_employee = this.employee.id_employee;\n        params.hash_id = this.state.hash_id;\n        params.type = 'private';\n        MainDeviceService.instance.getListDeviceByHashId(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataList: data\n                });\n\n                var total = parseInt(total_row / self.state.searchParam.limit);\n                if (total_row % self.state.searchParam.limit > 0) {\n                    total = total + 1;\n                }\n                self.paging.total = total;\n                self.paging.current = self.state.searchParam.index;\n                self.paging.currentInput = self.state.searchParam.index;\n                self.state.total_row = total_row;\n\n            } else {\n                self.setState({\n                    dataList: [],\n                    total_row: 0\n                });\n                self.paging.total = 0;\n                self.paging.current = 1;\n                self.paging.currentInput = 1;\n            }\n            self.forceUpdate();\n        });\n    }\n\n\n    onClickViewDevice = (index) => {\n        let { dataList } = this.state;\n        if (!Libs.isArrayData(dataList)) return;\n        var item = dataList[index];\n        if (Libs.isObjectEmpty(item)) return;\n\n        item.screen_mode = Constants.SCREEN_MODE.ADD;\n        this.setState({\n            show_tab: 1,\n            curItem: item,\n            viewDevice: true\n        });\n    };\n\n\n    onClickChartDevice = (index) => {\n        let { dataList } = this.state;\n        if (!Libs.isArrayData(dataList)) return;\n        var item = dataList[index];\n        if (Libs.isObjectEmpty(item)) return;\n\n        item.screen_mode = Constants.SCREEN_MODE.ADD;\n        this.setState({\n            show_tab: 3,\n            curItem: item,\n            viewDevice: true\n        });\n\n        // let curItem = this.state.curItem;\n        // curItem.data_send_time = 1;\n        // curItem.type = 1;\n\n        // curItem.screen_mode = Constants.SCREEN_MODE.ADD;\n        // this.setState({\n        //     curItem: curItem,\n        //     show_tab: 3,\n        //     viewDevice: true\n        // });\n    };\n\n    viewAlertDevice = (index) => {\n        var { dataList, curItem } = this.state;\n        if (!Libs.isArrayData(dataList)) return;\n        var item = dataList[index];\n        if (Libs.isObjectEmpty(item)) return;\n        curItem.screen_mode = Constants.SCREEN_MODE.ADD;\n        this.setState({\n            curItem: Object.assign(curItem, item),\n            show_tab: 2,\n            viewDevice: true\n        })\n    }\n\n    onClickCloseViewDevice = (status) => {\n        if (status) {\n            // this.getList();\n        }\n        this.setState({\n            viewDevice: false\n        })\n    }\n\n\n\n\n    inputChangedHandler(event) {\n        let self = this;\n        let target = event.target;\n        let name = target.name;\n        let value = target.value;\n        if (name === 'current') {\n            if (!Libs.isBlank(value)) {\n                var { t } = this.props;\n                if (!Libs.isNumber(value)) {\n                    self.toast(t('common.page_is_number'), \"error\");\n                    return;\n                }\n            }\n\n            self.paging.currentInput = value;\n            self.forceUpdate();\n        }\n\n        if (name === 'limit') {\n            var { searchParam } = this.state;\n            searchParam.limit = value;\n            this.setState({\n                searchParam: searchParam\n            }, () => {\n                self.getList();\n            })\n        }\n    }\n\n    inputChangedEnter(event) {\n        let self = this;\n        if (event.key === 'Enter') {\n            var currentInput = this.paging.currentInput;\n            if (!Libs.isBlank(currentInput)) {\n                var { t } = this.props;\n                if (!Libs.isNumber(currentInput)) {\n                    self.toast(t('common.page_is_number'), \"error\");\n                    return;\n                }\n            }\n\n            if (Libs.isBlank(currentInput) && !Libs.isNumber(currentInput)) return;\n            if (parseInt(currentInput) > this.paging.total) {\n                currentInput = self.paging.total;\n            }\n\n            if (currentInput <= 0) {\n                currentInput = 1;\n            }\n\n            self.paging.current = currentInput;\n            self.paging.currentInput = currentInput;\n            this.onSelectPage(currentInput);\n            self.forceUpdate();\n        }\n    }\n\n    inputChangedBlue(event) {\n        let self = this;\n        let target = event.target;\n        let name = target.name;\n        if (name === 'current') {\n            var currentInput = this.paging.currentInput;\n            if (!Libs.isBlank(currentInput)) {\n                var { t } = this.props;\n                if (!Libs.isNumber(currentInput)) {\n                    self.toast(t('common.page_is_number'), \"error\");\n                    return;\n                }\n            }\n\n            if (Libs.isBlank(currentInput) && !Libs.isNumber(currentInput)) return;\n            if (parseInt(currentInput) > this.paging.total) {\n                currentInput = self.paging.total;\n            }\n\n            if (currentInput <= 0) {\n                currentInput = 1;\n            }\n\n            self.paging.current = currentInput;\n            self.paging.currentInput = currentInput;\n            this.onSelectPage(currentInput);\n            self.forceUpdate();\n        }\n    }\n\n\n    /**\n     * @description Select page in pagging\n     * @author long.pham 09/05/2021\n     * @param {int} index\n     */\n    onSelectPage(index) {\n        let self = this;\n        self.state.searchParam.index = index;\n\n        if (index > 0) {\n            self.state.searchParam.offset = (index - 1) * self.state.searchParam.limit;\n        } else {\n            self.state.searchParam.offset = 0;\n        }\n        self.getList();\n    }\n\n\n    /**\n     * @description reload data\n     * @author long.pham 09/05/2021\n     * @param {int} index\n     */\n    onClickReload() {\n        let self = this;\n        self.getList();\n    }\n\n\n    /**\n    * Func filter table\n    * @author Long.Pham 12-05-2021\n    * @param  {Object} e\n    */\n\n    onSort(event, sortKey) {\n        this.state.searchParam.sort_column = sortKey;\n        this.state.searchParam.order_by = (this.state.searchParam.order_by === '' || this.state.searchParam.order_by === 'asc') ? 'desc' : 'asc';\n        this.getList();\n    }\n\n    /**\n      * @description Call form search\n      * @author Long.Pham 12/05/2021\n      */\n    onSearch() {\n        let formSearch = (this.state.formSearch === false) ? true : false;\n        this.setState({\n            formSearch: formSearch\n        });\n    }\n\n    onResetSearch() {\n        let self = this;\n        let searchParam = this.state.searchParam;\n        searchParam.name = null;\n        searchParam.id = null;\n        searchParam.index = 1;\n        searchParam.offset = 0;\n        self.paging.current = 1;\n        self.paging.currentInput = 1;\n        self.paging.total = 1;\n        self.setState({\n            searchParam: searchParam\n        }, () => {\n            self.getList();\n        });\n    }\n\n    /**\n     * Func search\n     * @author Long.Pham 12/05/2021\n     * @param  {Object} e\n     */\n    handleSearch() {\n        this.getList();\n    }\n\n    render() {\n        return this.jsxTemplate.call(this)\n    }\n}\n\nconst HighOrderComponentTranslated = withTranslation('common')(Device)\nexport default HighOrderComponentTranslated;"]},"metadata":{},"sourceType":"module"}