{"ast":null,"code":"import _defineProperty from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import BaseComponent from'../../BaseComponent';import LoginJsx from'./Login.jsx';import{withTranslation}from'react-i18next';import LoginValidate from'./LoginValidate';import Libs from'../../../utils/Libs';import Constants from'../../../utils/Constants';import EmployeeService from'../../../services/EmployeeService';var Login=/*#__PURE__*/function(_BaseComponent){_inherits(Login,_BaseComponent);var _super=_createSuper(Login);function Login(props,context){var _this;_classCallCheck(this,Login);_this=_super.call(this,props,context);_this.jsxTemplate=LoginJsx;_this.state={curItem:{},lang:\"en\"};return _this;}_createClass(Login,[{key:\"componentWillMount\",value:function(){var _componentWillMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return localStorage.clear();case 2:case\"end\":return _context.stop();}}},_callee);}));function componentWillMount(){return _componentWillMount.apply(this,arguments);}return componentWillMount;}()},{key:\"onSaveAction\",value:function(){var _onSaveAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var curItem,self,user,v,errors,t;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:curItem=this.state.curItem,self=this;user={email:curItem.email,password:Libs.SHA3(curItem.password),lang:this.state.lang};v=new LoginValidate(this.props);_context2.next=5;return v.FLValidationAll(curItem);case 5:errors=_context2.sent;if(!errors){_context2.next=9;break;}this.setValidateMessage(errors);return _context2.abrupt(\"return\");case 9:t=this.props.t;EmployeeService.instance.getLogin(user,function(data){if(!Libs.isObjectEmpty(data)){self.setAccessParam(data);var permissions=data.permissions;var dashboard=permissions[\"/dashboard\"];var main=permissions[\"/main\"];if(!Libs.isObjectEmpty(main)&&main.auth>0){window.location.href=Constants.SITE_URL.DEFAULT_MAIN;}else if(!Libs.isObjectEmpty(dashboard)&&dashboard.auth>0){window.location.href=Constants.SITE_URL.DEFAULT_PAGE;}return;}else{self.toast(t('login.error'),\"error\");}},false);case 11:case\"end\":return _context2.stop();}}},_callee2,this);}));function onSaveAction(){return _onSaveAction.apply(this,arguments);}return onSaveAction;}()/**\r\n   * set user login parameters to localstore\r\n   * @param {object} param \r\n   * @param {string} lang \r\n   */},{key:\"setAccessParam\",value:function setAccessParam(param){var token=param.token;var permissions=param.permissions;var type='dashboard';var dashboard=permissions[\"/dashboard\"];var main=permissions[\"/main\"];if(!Libs.isObjectEmpty(main)&&main.auth>0){type='main';}else if(!Libs.isObjectEmpty(dashboard)&&dashboard.auth>0){type='dashboard';}localStorage.setItem(Constants.COMMON.TOKEN,token);var jsonPermissions=JSON.stringify(permissions);localStorage.setItem(Constants.COMMON.ACCESS_PARAM,Libs.base64Encrypt(jsonPermissions));var lang='en';var id_language='';if(Libs.isArrayData(param.languages)){var findItemLang=Libs.find(param.languages,'is_default',1);if(!Libs.isObjectEmpty(findItemLang)){lang=findItemLang.iso_code;id_language=findItemLang.id;}}var info={lang:lang,id_language:id_language,email:param.email,first_name:param.first_name,last_name:param.last_name,full_name:param.full_name,avatar:param.avatar,id_employee:param.id_employee,timeout:param.timeout,roles:param.roles,languages:param.languages,menu_collapse:true,type:type};var jsonUser=JSON.stringify(info);localStorage.setItem(Constants.COMMON.EMPLOYEE_INFO,Libs.base64Encrypt(jsonUser));}/**\r\n     * @description validate a field input\r\n     * @author Long.Pham 13/06/2021\r\n     * @param {*} event \r\n     */},{key:\"validateOne\",value:function(){var _validateOne=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var target,name,value,param,v,error;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:target=event.target;name=target.name;value=target.value;if(!name){_context3.next=10;break;}param=_defineProperty({},name,value);v=new LoginValidate(this.props);_context3.next=8;return v.validateOne(param,name);case 8:error=_context3.sent;if(error!=null){this.setValidateMessage(error,true);}case 10:case\"end\":return _context3.stop();}}},_callee3,this);}));function validateOne(_x){return _validateOne.apply(this,arguments);}return validateOne;}()},{key:\"render\",value:function render(){if(!localStorage.getItem(Constants.COMMON.TOKEN)){return this.jsxTemplate.call(this);}return null;}}]);return Login;}(BaseComponent);var HighOrderComponentTranslated=withTranslation('common')(Login);export default HighOrderComponentTranslated;","map":{"version":3,"sources":["/Volumes/Data/sources/solarmon_production/solarmon_frontend/src/containers/views/Login/Login.js"],"names":["BaseComponent","LoginJsx","withTranslation","LoginValidate","Libs","Constants","EmployeeService","Login","props","context","jsxTemplate","state","curItem","lang","localStorage","clear","self","user","email","password","SHA3","v","FLValidationAll","errors","setValidateMessage","t","instance","getLogin","data","isObjectEmpty","setAccessParam","permissions","dashboard","main","auth","window","location","href","SITE_URL","DEFAULT_MAIN","DEFAULT_PAGE","toast","param","token","type","setItem","COMMON","TOKEN","jsonPermissions","JSON","stringify","ACCESS_PARAM","base64Encrypt","id_language","isArrayData","languages","findItemLang","find","iso_code","id","info","first_name","last_name","full_name","avatar","id_employee","timeout","roles","menu_collapse","jsonUser","EMPLOYEE_INFO","event","target","name","value","validateOne","error","getItem","call","HighOrderComponentTranslated"],"mappings":"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","sourcesContent":["import BaseComponent from '../../BaseComponent';\r\nimport LoginJsx from './Login.jsx';\r\nimport { withTranslation } from 'react-i18next';\r\nimport LoginValidate from './LoginValidate';\r\nimport Libs from '../../../utils/Libs';\r\nimport Constants from '../../../utils/Constants';\r\nimport EmployeeService from '../../../services/EmployeeService';\r\n\r\nclass Login extends BaseComponent {\r\n\r\n    constructor(props, context) {\r\n        super(props, context);\r\n        this.jsxTemplate = LoginJsx;\r\n        this.state = {\r\n            curItem: {},\r\n            lang: \"en\"\r\n        };\r\n    }\r\n\r\n    async componentWillMount() {\r\n        await localStorage.clear();\r\n        // if (!Libs.isBlank(localStorage.getItem(Constants.COMMON.TOKEN))) {\r\n        //     window.location.href = Constants.SITE_URL.DEFAULT_PAGE;\r\n        //     return;\r\n        // }\r\n        // else await localStorage.clear()\r\n    }\r\n\r\n\r\n    async onSaveAction() {\r\n        let curItem = this.state.curItem, self = this;\r\n        let user = {\r\n            email: curItem.email,\r\n            password: Libs.SHA3(curItem.password),\r\n            lang: this.state.lang\r\n        };\r\n\r\n        let v = new LoginValidate(this.props);\r\n        let errors = await v.FLValidationAll(curItem);\r\n        if (errors) {\r\n            this.setValidateMessage(errors);\r\n            return;\r\n        }\r\n        var { t } = this.props;\r\n        EmployeeService.instance.getLogin(user, function (data) {\r\n            if (!Libs.isObjectEmpty(data)) {\r\n                self.setAccessParam(data);\r\n                var permissions = data.permissions;\r\n                var dashboard = permissions[\"/dashboard\"];\r\n                var main = permissions[\"/main\"];\r\n                if(!Libs.isObjectEmpty(main) && main.auth > 0){\r\n                    window.location.href = Constants.SITE_URL.DEFAULT_MAIN;\r\n                } else if (!Libs.isObjectEmpty(dashboard) && dashboard.auth > 0){\r\n                    window.location.href = Constants.SITE_URL.DEFAULT_PAGE;\r\n                }\r\n\r\n                return;\r\n            }\r\n            else {\r\n                self.toast(t('login.error'), \"error\");\r\n            }\r\n        }, false);\r\n    }\r\n\r\n\r\n    /**\r\n   * set user login parameters to localstore\r\n   * @param {object} param \r\n   * @param {string} lang \r\n   */\r\n    setAccessParam(param) {\r\n        let token = param.token;\r\n        let permissions = param.permissions;\r\n        var type = 'dashboard';\r\n        var dashboard = permissions[\"/dashboard\"];\r\n        var main = permissions[\"/main\"];\r\n        if(!Libs.isObjectEmpty(main) && main.auth > 0){\r\n            type = 'main';\r\n        } else if (!Libs.isObjectEmpty(dashboard) && dashboard.auth > 0){\r\n            type = 'dashboard';\r\n        }\r\n\r\n        localStorage.setItem(Constants.COMMON.TOKEN, token);\r\n        let jsonPermissions = JSON.stringify(permissions);\r\n        localStorage.setItem(Constants.COMMON.ACCESS_PARAM, Libs.base64Encrypt(jsonPermissions));\r\n        var lang = 'en';\r\n        var id_language = '';\r\n        if (Libs.isArrayData(param.languages)) {\r\n            var findItemLang = Libs.find(param.languages, 'is_default', 1);\r\n            if (!Libs.isObjectEmpty(findItemLang)) {\r\n                lang = findItemLang.iso_code;\r\n                id_language = findItemLang.id;\r\n            }\r\n        }\r\n\r\n        let info = {\r\n            lang: lang,\r\n            id_language: id_language,\r\n            email: param.email,\r\n            first_name: param.first_name,\r\n            last_name: param.last_name,\r\n            full_name: param.full_name,\r\n            avatar: param.avatar,\r\n            id_employee: param.id_employee,\r\n            timeout: param.timeout,\r\n            roles: param.roles,\r\n            languages: param.languages,\r\n            menu_collapse: true,\r\n            type: type\r\n        }\r\n        let jsonUser = JSON.stringify(info);\r\n        localStorage.setItem(Constants.COMMON.EMPLOYEE_INFO, Libs.base64Encrypt(jsonUser));\r\n    }\r\n\r\n\r\n    /**\r\n     * @description validate a field input\r\n     * @author Long.Pham 13/06/2021\r\n     * @param {*} event \r\n     */\r\n    async validateOne(event) {\r\n        let target = event.target;\r\n        let name = target.name;\r\n        let value = target.value\r\n        if (name) {\r\n            let param = {\r\n                [name]: value\r\n            }\r\n            let v = new LoginValidate(this.props);\r\n            let error = await v.validateOne(param, name);\r\n            if (error != null) {\r\n                this.setValidateMessage(error, true);\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if (!localStorage.getItem(Constants.COMMON.TOKEN)) {\r\n            return this.jsxTemplate.call(this);\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n\r\nconst HighOrderComponentTranslated = withTranslation('common')(Login)\r\nexport default HighOrderComponentTranslated;"]},"metadata":{},"sourceType":"module"}