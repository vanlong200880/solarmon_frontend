{"ast":null,"code":"import BaseComponent from '../../../../BaseComponent';\nimport Libs from '../../../../../utils/Libs';\nimport MoveDevicePopupJsx from './MoveDevicePopup.jsx';\nimport ProjectService from '../../../../../services/ProjectService';\nimport DeviceService from '../../../../../services/DeviceService';\nimport Constants from '../../../../../utils/Constants'; // import MoveDevicePopupValidate from './MoveDevicePopupValidate';\n\nimport EstimationSensorValidate from './EstimationSensorValidate';\n\nclass MoveDevicePopup extends BaseComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleDropdownChange = (item, name) => {\n      var self = this;\n      let curItem = self.state.curItem;\n      var {\n        t\n      } = this.props;\n\n      if (name === 'id_project') {\n        if (Libs.isObjectEmpty(item)) {\n          curItem.id_device_type = '';\n        } else {\n          var value = item.value;\n          curItem[name] = value;\n          self.setValidateMessage({\n            id_device_type: ''\n          }, true);\n        }\n      }\n\n      if (name === 'id_device_group') {\n        if (Libs.isObjectEmpty(item)) {\n          curItem.id_device_group = '';\n        } else {\n          var value = item.value;\n          curItem[name] = value;\n          self.setValidateMessage({\n            id_device_group: ''\n          }, true);\n        }\n      }\n\n      self.setState({\n        curItem: curItem\n      });\n    };\n\n    this.loadConfig = () => {\n      var item = this.props.curItem,\n          self = this;\n      if (Libs.isObjectEmpty(item)) return;\n      ProjectService.instance.getDetailConfig(item, data => {\n        if (data) {\n          self.setState({\n            curItem: data,\n            dataConfigRevenue: Libs.isArrayData(data.dataConfigRevenue) ? data.dataConfigRevenue : []\n          });\n        }\n      }, false);\n    };\n\n    this.onItemClickDelete = index => {\n      var {\n        dataConfigRevenue\n      } = this.state;\n      if (!Libs.isArrayData(dataConfigRevenue)) return;\n      var item = dataConfigRevenue[index];\n      if (Libs.isObjectEmpty(item)) return;\n      dataConfigRevenue.splice(index, 1);\n      this.setState({\n        dataConfigRevenue: dataConfigRevenue\n      });\n    };\n\n    this.addRowConfigRevenue = () => {\n      var {\n        dataConfigRevenue\n      } = this.state;\n      dataConfigRevenue.push({\n        id: '',\n        id_project: '',\n        config_revenue: '',\n        start_date: '',\n        end_date: '',\n        status: 1\n      });\n      this.setState({\n        dataConfigRevenue: dataConfigRevenue\n      });\n    };\n\n    this.state = {\n      curItemProject: this.props.curItem,\n      curItem: {},\n      dataYear: this.getListYear(),\n      dataConfigRevenue: [],\n      dataList: [],\n      dataListProject: [],\n      searchParam: {}\n    };\n    this.jsxTemplate = MoveDevicePopupJsx;\n    this.handleInputChangeItem = this.handleInputChangeItem.bind(this);\n    this.handleDropdownChange = this.handleDropdownChange.bind(this);\n  }\n\n  componentDidMount() {\n    // this.loadConfig();\n    this.getListDeviceByProject();\n    this.getDataListProject();\n  }\n\n  /**\n   * ge list project\n   * @author Long.Pham 2019-06-03\n   */\n  getDataListProject() {\n    let self = this;\n    var {\n      curItemProject\n    } = this.state;\n    var params = {\n      id_language: this.employee.id_language,\n      id_project: null\n    };\n    ProjectService.instance.getDropdownList(params, (data, total_row) => {\n      if (Libs.isArrayData(data)) {\n        self.setState({\n          dataListProject: data\n        });\n      } else {\n        self.setState({\n          dataListProject: []\n        });\n      }\n    });\n  }\n  /**\n   * get list\n   * @author Long.Pham 2019-06-03\n   */\n\n\n  getListDeviceByProject() {\n    let self = this;\n    var {\n      curItemProject,\n      searchParam\n    } = this.state;\n    searchParam.id_project = curItemProject.id;\n    searchParam.id_language = this.employee.id_language;\n    DeviceService.instance.getListDeviceByProject(searchParam, (data, total_row) => {\n      console.log(\"data: \", data);\n\n      if (Libs.isArrayData(data)) {\n        self.setState({\n          dataList: data\n        });\n      } else {\n        self.setState({\n          dataList: []\n        });\n      }\n\n      self.forceUpdate();\n    });\n  }\n  /**\n   * @description Item click event\n   * @author Long.Pham 12-05-2021\n   * @param index element in the list\n   */\n\n\n  // handleDropdownChange = (item, name) => {\n  //     var self = this;\n  //     let curItem = self.state.curItem;\n  //     if (Libs.isObjectEmpty(item)) {\n  //         curItem.year = '';\n  //     } else {\n  //         var value = item.value;\n  //         curItem[name] = value;\n  //         self.setValidateMessage({ year: '' }, true);\n  //     }\n  //     self.setState({\n  //         curItem: curItem\n  //     });\n  // }\n\n  /**\n   * setValue method to Input\n   * @author Long.Pham 20/05/2021\n   */\n  handleInputChangeItem(event, index) {\n    let target = event.target;\n    let name = target.name;\n    let value = target.value;\n\n    if (target.type === 'checkbox') {\n      value = target.checked ? 1 : 0;\n    }\n\n    if (name) {\n      var {\n        dataConfigRevenue\n      } = this.state;\n      var item = dataConfigRevenue[index];\n\n      if (name == 'config_revenue') {\n        var numericExpression = /^[0-9\\b]+$/;\n\n        if (value == \"\" || numericExpression.test(value)) {\n          item[name] = value;\n          dataConfigRevenue[index] = item;\n          this.setState({\n            dataConfigRevenue: dataConfigRevenue\n          });\n        }\n      } else {\n        item[name] = value;\n        dataConfigRevenue[index] = item;\n        this.setState({\n          dataConfigRevenue: dataConfigRevenue\n        });\n      }\n    }\n  }\n\n  getListYear() {\n    var dataYear = [];\n    let date = new Date();\n    let year = date.getFullYear();\n\n    if (year > 0) {\n      for (var i = year; i >= year - 20; i--) {\n        dataYear.push({\n          id: i,\n          value: i,\n          label: i\n        });\n      }\n    }\n\n    return dataYear;\n  }\n\n  /**\n   * @description save data\n   * @author long.pham 12/05/2021\n   */\n  async onSave() {\n    var {\n      curItem,\n      dataConfigRevenue,\n      curItemProject\n    } = this.state,\n        self = this;\n    var params = Object.assign({}, curItem);\n    params.screen_mode = Constants.SCREEN_MODE.EDIT;\n    params.id_language = this.employee.id_language;\n    params.id_project = curItemProject.id;\n    params.dataConfigRevenue = dataConfigRevenue; // let v = new MoveDevicePopupValidate(this.props);\n    // let errors = await v.FLValidationAll(curItem);\n    // if (errors) {\n    //     this.setValidateMessage(errors);\n    //     return;\n    // }\n    //remove message validation\n\n    this.removeAllValidateMessage();\n    ProjectService.instance.saveConfig(params, function (status, data, msg) {\n      if (status) {\n        self.toast(msg, \"info\");\n        self.props.onItemClickCloseMoveDevice(false);\n      } else if (data) {\n        self.setValidateMessage(data);\n      } else if (!Libs.isBlank(msg)) {\n        self.toast(msg, \"error\");\n      }\n    }, true);\n  }\n  /**\n   * @description save data\n   * @author long.pham 12/05/2021\n   */\n\n\n  async onSaveEstimationSenSor() {\n    var {\n      curItem,\n      curItemProject\n    } = this.state,\n        self = this;\n    var params = Object.assign({}, curItem);\n    params.screen_mode = Constants.SCREEN_MODE.EDIT;\n    params.id_language = this.employee.id_language;\n    params.id_project = curItemProject.id;\n    let v = new EstimationSensorValidate(this.props);\n    let errors = await v.FLValidationAll(curItem);\n\n    if (errors) {\n      this.setValidateMessage(errors);\n      return;\n    } //remove message validation\n\n\n    this.removeAllValidateMessage();\n    ProjectService.instance.saveConfigEstimationSenSor(params, function (status, data, msg) {\n      if (status) {\n        self.toast(msg, \"info\");\n      } else if (data) {\n        self.setValidateMessage(data);\n      } else if (!Libs.isBlank(msg)) {\n        self.toast(msg, \"error\");\n      }\n    }, true);\n  }\n  /**\n  * @description validate a field input\n  * @author Long.Pham 12/05/2021\n  * @param {*} event \n  */\n  //   async validateOne(event) {\n  //     let target = event.target;\n  //     let name = target.name;\n  //     let value = target.value\n  //     if (name) {\n  //         let param = {\n  //             [name]: value\n  //         }\n  //         let v = new MoveDevicePopupValidate(this.props);\n  //         let error = await v.validateOne(param, name);\n  //         if (error != null) {\n  //             this.setValidateMessage(error, true);\n  //         }\n  //     }\n  // }\n\n  /**\n   * @description validate a field input\n   * @author Long.Pham 12/05/2021\n   * @param {*} event \n   */\n\n\n  async validateOneEst(event) {\n    let target = event.target;\n    let name = target.name;\n    let value = target.value;\n\n    if (name) {\n      let param = {\n        [name]: value\n      };\n      let v = new EstimationSensorValidate(this.props);\n      let error = await v.validateOne(param, name);\n\n      if (error != null) {\n        this.setValidateMessage(error, true);\n      }\n    }\n  }\n\n}\n\nexport default MoveDevicePopup;","map":{"version":3,"sources":["/Volumes/Data/sources/solars/frontend/src/containers/views/desktop/ModuleSystem/Project/MoveDevicePopup.js"],"names":["BaseComponent","Libs","MoveDevicePopupJsx","ProjectService","DeviceService","Constants","EstimationSensorValidate","MoveDevicePopup","constructor","props","handleDropdownChange","item","name","self","curItem","state","t","isObjectEmpty","id_device_type","value","setValidateMessage","id_device_group","setState","loadConfig","instance","getDetailConfig","data","dataConfigRevenue","isArrayData","onItemClickDelete","index","splice","addRowConfigRevenue","push","id","id_project","config_revenue","start_date","end_date","status","curItemProject","dataYear","getListYear","dataList","dataListProject","searchParam","jsxTemplate","handleInputChangeItem","bind","componentDidMount","getListDeviceByProject","getDataListProject","params","id_language","employee","getDropdownList","total_row","console","log","forceUpdate","event","target","type","checked","numericExpression","test","date","Date","year","getFullYear","i","label","onSave","Object","assign","screen_mode","SCREEN_MODE","EDIT","removeAllValidateMessage","saveConfig","msg","toast","onItemClickCloseMoveDevice","isBlank","onSaveEstimationSenSor","v","errors","FLValidationAll","saveConfigEstimationSenSor","validateOneEst","param","error","validateOne"],"mappings":"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","sourcesContent":["\nimport BaseComponent from '../../../../BaseComponent';\nimport Libs from '../../../../../utils/Libs';\nimport MoveDevicePopupJsx from './MoveDevicePopup.jsx';\nimport ProjectService from '../../../../../services/ProjectService';\nimport DeviceService from '../../../../../services/DeviceService';\nimport Constants from '../../../../../utils/Constants';\n// import MoveDevicePopupValidate from './MoveDevicePopupValidate';\nimport EstimationSensorValidate from './EstimationSensorValidate';\n\nclass MoveDevicePopup extends BaseComponent {\n    constructor(props) {\n        super(props);\n        this.state = {\n            curItemProject: this.props.curItem,\n            curItem: {},\n            dataYear: this.getListYear(),\n            dataConfigRevenue: [],\n            dataList: [],\n            dataListProject: [],\n            searchParam: {}\n        }\n\n        this.jsxTemplate = MoveDevicePopupJsx;\n        this.handleInputChangeItem = this.handleInputChangeItem.bind(this);\n        this.handleDropdownChange = this.handleDropdownChange.bind(this);\n    }\n\n    componentDidMount(){\n        // this.loadConfig();\n        this.getListDeviceByProject();\n        this.getDataListProject();\n    }\n\n\n\n    handleDropdownChange = (item, name) => {\n        var self = this;\n        let curItem = self.state.curItem;\n        var { t } = this.props;\n\n        if (name === 'id_project') {\n            if (Libs.isObjectEmpty(item)) {\n                curItem.id_device_type = '';\n            } else {\n                var value = item.value;\n                curItem[name] = value;\n                self.setValidateMessage({ id_device_type: '' }, true);\n            }\n        }\n\n        if (name === 'id_device_group') {\n            if (Libs.isObjectEmpty(item)) {\n                curItem.id_device_group = '';\n            } else {\n                var value = item.value;\n                curItem[name] = value;\n                self.setValidateMessage({ id_device_group: '' }, true);\n            }\n        }\n\n        self.setState({\n            curItem: curItem\n        });\n    }\n\n\n    /**\n     * ge list project\n     * @author Long.Pham 2019-06-03\n     */\n     getDataListProject() {\n        let self = this;\n        var {curItemProject} = this.state;\n        var params = {\n            id_language: this.employee.id_language,\n            id_project:  null\n        };\n\n        ProjectService.instance.getDropdownList(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataListProject: data\n                });\n            } else {\n                self.setState({\n                    dataListProject: []\n                });\n            }\n        })\n    }\n\n\n    /**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */\n     getListDeviceByProject() {\n        let self = this;\n        var { curItemProject, searchParam } = this.state;\n        searchParam.id_project = curItemProject.id;\n        searchParam.id_language = this.employee.id_language;\n        DeviceService.instance.getListDeviceByProject(searchParam, (data, total_row) => {\n            console.log(\"data: \", data);\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataList: data\n                });\n\n            } else {\n                self.setState({\n                    dataList: []\n                });\n            }\n            self.forceUpdate();\n        });\n    }\n\n\n    /**\n     * @description Item click event\n     * @author Long.Pham 12-05-2021\n     * @param index element in the list\n     */\n     loadConfig = () => {\n        var item = this.props.curItem, self = this;\n        if(Libs.isObjectEmpty(item)) return;\n\n        ProjectService.instance.getDetailConfig(item, data => {\n            if (data) {\n                self.setState({\n                    curItem: data,\n                    dataConfigRevenue: Libs.isArrayData(data.dataConfigRevenue) ? data.dataConfigRevenue: []\n                });\n            }\n        }, false);\n    }\n\n    // handleDropdownChange = (item, name) => {\n    //     var self = this;\n    //     let curItem = self.state.curItem;\n\n    //     if (Libs.isObjectEmpty(item)) {\n    //         curItem.year = '';\n    //     } else {\n    //         var value = item.value;\n    //         curItem[name] = value;\n    //         self.setValidateMessage({ year: '' }, true);\n    //     }\n\n    //     self.setState({\n    //         curItem: curItem\n    //     });\n    // }\n\n    /**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */\n    handleInputChangeItem(event, index) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value;\n        if (target.type === 'checkbox') {\n            value = target.checked ? 1 : 0;\n        }\n\n        if (name) {\n            var { dataConfigRevenue } = this.state;\n            var item = dataConfigRevenue[index];\n\n            if (name == 'config_revenue') {\n                var numericExpression = /^[0-9\\b]+$/;\n                if (value == \"\" || numericExpression.test(value)) {\n                    item[name] = value;\n                    dataConfigRevenue[index] = item;\n                    this.setState({ dataConfigRevenue: dataConfigRevenue });\n                }\n            } else {\n                item[name] = value;\n                dataConfigRevenue[index] = item;\n                this.setState({ dataConfigRevenue: dataConfigRevenue });\n            }\n        }\n    }\n\n\n    getListYear() {\n        var dataYear = [];\n        let date = new Date();\n        let year = date.getFullYear();\n        if (year > 0) {\n            for (var i = year; i >= year - 20; i--) {\n                dataYear.push({\n                    id: i,\n                    value: i,\n                    label: i\n                })\n            }\n        }\n        return dataYear;\n    }\n\n    onItemClickDelete = (index) => {\n        var { dataConfigRevenue } = this.state;\n        if (!Libs.isArrayData(dataConfigRevenue)) return;\n        var item = dataConfigRevenue[index];\n        if (Libs.isObjectEmpty(item)) return;\n        dataConfigRevenue.splice(index, 1);\n        this.setState({\n            dataConfigRevenue: dataConfigRevenue\n        })\n    }\n\n    addRowConfigRevenue = () => {\n        var { dataConfigRevenue } = this.state;\n        dataConfigRevenue.push({\n            id: '',\n            id_project: '',\n            config_revenue: '',\n            start_date: '',\n            end_date: '',\n            status: 1\n        });\n        this.setState({\n            dataConfigRevenue: dataConfigRevenue\n        })\n    }\n\n\n    /**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */\n    async onSave() {\n        var { curItem, dataConfigRevenue, curItemProject } = this.state, self = this;\n        var params = Object.assign({}, curItem);\n        params.screen_mode = Constants.SCREEN_MODE.EDIT;\n        params.id_language = this.employee.id_language;\n        params.id_project = curItemProject.id;\n        params.dataConfigRevenue = dataConfigRevenue;\n\n        // let v = new MoveDevicePopupValidate(this.props);\n        // let errors = await v.FLValidationAll(curItem);\n        // if (errors) {\n        //     this.setValidateMessage(errors);\n        //     return;\n        // }\n        //remove message validation\n        this.removeAllValidateMessage();\n\n\n\n        ProjectService.instance.saveConfig(params, function (status, data, msg) {\n            if (status) {\n                self.toast(msg, \"info\");\n                self.props.onItemClickCloseMoveDevice(false);\n            }\n            else if (data) {\n                self.setValidateMessage(data);\n            }\n\n            else if (!Libs.isBlank(msg)) {\n                self.toast(msg, \"error\");\n            }\n        }, true);\n    }\n\n\n    \n    /**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */\n     async onSaveEstimationSenSor() {\n        var { curItem, curItemProject } = this.state, self = this;\n        var params = Object.assign({}, curItem);\n        params.screen_mode = Constants.SCREEN_MODE.EDIT;\n        params.id_language = this.employee.id_language;\n        params.id_project = curItemProject.id;\n\n        let v = new EstimationSensorValidate(this.props);\n        let errors = await v.FLValidationAll(curItem);\n        if (errors) {\n            this.setValidateMessage(errors);\n            return;\n        }\n        //remove message validation\n        this.removeAllValidateMessage();\n\n\n        ProjectService.instance.saveConfigEstimationSenSor(params, function (status, data, msg) {\n            if (status) {\n                self.toast(msg, \"info\");\n            }\n            else if (data) {\n                self.setValidateMessage(data);\n            }\n\n            else if (!Libs.isBlank(msg)) {\n                self.toast(msg, \"error\");\n            }\n        }, true);\n    }\n\n\n     /**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */\n    //   async validateOne(event) {\n    //     let target = event.target;\n    //     let name = target.name;\n    //     let value = target.value\n    //     if (name) {\n    //         let param = {\n    //             [name]: value\n    //         }\n    //         let v = new MoveDevicePopupValidate(this.props);\n    //         let error = await v.validateOne(param, name);\n    //         if (error != null) {\n    //             this.setValidateMessage(error, true);\n    //         }\n    //     }\n    // }\n\n    /**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */\n     async validateOneEst(event) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value\n        if (name) {\n            let param = {\n                [name]: value\n            }\n            let v = new EstimationSensorValidate(this.props);\n            let error = await v.validateOne(param, name);\n            if (error != null) {\n                this.setValidateMessage(error, true);\n            }\n        }\n    }\n\n}\nexport default MoveDevicePopup;"]},"metadata":{},"sourceType":"module"}