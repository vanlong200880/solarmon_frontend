{"ast":null,"code":"import _classCallCheck from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import ChartAlarmJsx from'./ChartAlarm.jsx';import BaseComponent from'../../../../../BaseComponent';import Libs from'../../../../../../utils/Libs';import{withTranslation}from'react-i18next';import Constants from'../../../../../../utils/Constants';import MainAnalyticsService from'../../../../../../services/MainAnalyticsService';import*as FileSaver from'file-saver';import*as XLSX from'xlsx';import moment from'moment';var ChartAlarm=/*#__PURE__*/function(_BaseComponent){_inherits(ChartAlarm,_BaseComponent);var _super=_createSuper(ChartAlarm);function ChartAlarm(props,context){var _this;_classCallCheck(this,ChartAlarm);_this=_super.call(this,props,context);_this.downloadData=function(){var curItem=_this.state.curItem;if(!Libs.isArrayData(curItem.alarmLast12Month))return;var alarmLast12Month=curItem.alarmLast12Month;var dataExport=[];for(var i=0,len=alarmLast12Month.length;i<len;i++){dataExport.push({'Time':alarmLast12Month[i].time_full,'Project name':curItem.name,'Total':alarmLast12Month[i].total_alarm});}var fileType='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';var fileExtension='.xlsx';var ws=XLSX.utils.json_to_sheet(dataExport,{skipHeader:false});var wb={SheetNames:['Alarms - Last 12 months'],Sheets:{'Alarms - Last 12 months':ws}};var excelBuffer=XLSX.write(wb,{bookType:'xlsx',type:'array'});var data=new Blob([excelBuffer],{type:fileType});FileSaver.saveAs(data,\"Export-alarm-12-month-\"+moment().format('YYYY-MM-DD_hh:mm:ss')+fileExtension);};_this.state={hash_id:_this.props.hash_id,curItem:{},dataTotalFleet:[],dataList:[],categories:[],series:[],chartOption:{},searchParam:{limit:Constants.COMMON.LIMIT,offset:0,index:1},allLanguage:Libs.isBlank(_this.employee)?[]:_this.employee.languages,chartParams:{id_site:null,id_filter:'today',text_filter:'Today',show_filter:false,showNextBtn:false,current_time:Libs.getCurrentMMDDYYYYHI(),end_date:Libs.getCurrentMMDDYYYYHI(),start_date:Libs.getCurrentMMDDYYYYHI(),data_send_time:2}};_this.paging={total:0,current:1,currentInput:1};_this.jsxTemplate=ChartAlarmJsx;return _this;}_createClass(ChartAlarm,[{key:\"componentDidMount\",value:function componentDidMount(){this.getDataChartProfile();}},{key:\"getDataChartProfile\",value:function getDataChartProfile(){var _this2=this;var _this$state=this.state,hash_id=_this$state.hash_id,curItem=_this$state.curItem,categories=_this$state.categories,series=_this$state.series,self=this;if(Libs.isBlank(hash_id))return;var params={hash_id:hash_id,id_language:this.employee.id_language,id_employee:this.employee.id_employee,type:'private'};MainAnalyticsService.instance.getChartAlarm(params,function(data){if(data){var alarmLast12Month=data.alarmLast12Month;if(Libs.isArrayData(alarmLast12Month)){var dataItem=[];for(var i=0,len=alarmLast12Month.length;i<len;i++){categories.push(alarmLast12Month[i].time_full);dataItem.push([alarmLast12Month[i].time_full,alarmLast12Month[i].total_alarm]);}series.push({name:'Alarms - Last 12 months',type:'spline',data:dataItem,tooltip:{valueSuffix:''}});}self.setState({curItem:data,series:series,categories:categories},function(){self.loadChartOption();});}else{_this2.setState({curItem:curItem});}},false);}},{key:\"loadChartOption\",value:function loadChartOption(){var _this$state2=this.state,categories=_this$state2.categories,series=_this$state2.series;var chartOption={credits:{enabled:false},exporting:{enabled:false},chart:{zoomType:'xy',height:380},title:{text:null},colors:['#f5893b','#66bc51','#004ec3'],xAxis:{categories:categories,crosshair:true},yAxis:[{min:0,lineWidth:1,gridLineWidth:1,labels:{format:'{value}',enabled:true},title:{text:'kWh',enabled:false}}],tooltip:{shared:true},legend:{layout:'horizontal',align:'center',verticalAlign:'bottom',borderWidth:0,showInLegend:false},series:series};this.setState({chartOption:chartOption});}},{key:\"render\",value:function render(){return this.jsxTemplate.call(this);}}]);return ChartAlarm;}(BaseComponent);var HighOrderComponentTranslated=withTranslation('common')(ChartAlarm);export default HighOrderComponentTranslated;","map":{"version":3,"sources":["/Volumes/Data/sources/solars/frontend/src/containers/views/desktop/ModulePrivate/Analytics/ChartAlarm/ChartAlarm.js"],"names":["React","ChartAlarmJsx","BaseComponent","Libs","withTranslation","Constants","MainAnalyticsService","FileSaver","XLSX","moment","ChartAlarm","props","context","downloadData","curItem","state","isArrayData","alarmLast12Month","dataExport","i","len","length","push","time_full","name","total_alarm","fileType","fileExtension","ws","utils","json_to_sheet","skipHeader","wb","SheetNames","Sheets","excelBuffer","write","bookType","type","data","Blob","saveAs","format","hash_id","dataTotalFleet","dataList","categories","series","chartOption","searchParam","limit","COMMON","LIMIT","offset","index","allLanguage","isBlank","employee","languages","chartParams","id_site","id_filter","text_filter","show_filter","showNextBtn","current_time","getCurrentMMDDYYYYHI","end_date","start_date","data_send_time","paging","total","current","currentInput","jsxTemplate","getDataChartProfile","self","params","id_language","id_employee","instance","getChartAlarm","dataItem","tooltip","valueSuffix","setState","loadChartOption","credits","enabled","exporting","chart","zoomType","height","title","text","colors","xAxis","crosshair","yAxis","min","lineWidth","gridLineWidth","labels","shared","legend","layout","align","verticalAlign","borderWidth","showInLegend","call","HighOrderComponentTranslated"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ChartAlarmJsx from './ChartAlarm.jsx';\nimport BaseComponent from '../../../../../BaseComponent';\nimport Libs from '../../../../../../utils/Libs';\nimport { withTranslation } from 'react-i18next';\nimport Constants from '../../../../../../utils/Constants';\nimport MainAnalyticsService from '../../../../../../services/MainAnalyticsService';\nimport * as FileSaver from 'file-saver';\nimport * as XLSX from 'xlsx';\nimport moment from 'moment';\n\nclass ChartAlarm extends BaseComponent {\n\n    constructor(props, context) {\n        super(props, context);\n\n        this.state = {\n            hash_id: this.props.hash_id,\n            curItem: {},\n            dataTotalFleet: [],\n            dataList: [],\n            categories: [],\n            series: [],\n            chartOption: {},\n            searchParam: {\n                limit: Constants.COMMON.LIMIT,\n                offset: 0,\n                index: 1,\n            },\n            allLanguage: Libs.isBlank(this.employee) ? [] : this.employee.languages,\n            chartParams: {\n                id_site: null,\n                id_filter: 'today',\n                text_filter: 'Today',\n                show_filter: false,\n                showNextBtn: false,\n                current_time: Libs.getCurrentMMDDYYYYHI(),\n                end_date: Libs.getCurrentMMDDYYYYHI(),\n                start_date: Libs.getCurrentMMDDYYYYHI(),\n                data_send_time: 2\n            },\n        };\n\n        this.paging = {\n            total: 0,\n            current: 1,\n            currentInput: 1\n        };\n\n        this.jsxTemplate = ChartAlarmJsx;\n    }\n\n    componentDidMount() {\n        this.getDataChartProfile();\n    }\n\n    getDataChartProfile() {\n        var { hash_id, curItem, categories, series } = this.state, self = this;\n        if (Libs.isBlank(hash_id)) return;\n        var params = {\n            hash_id: hash_id,\n            id_language: this.employee.id_language,\n            id_employee: this.employee.id_employee,\n            type: 'private'\n        };\n\n        MainAnalyticsService.instance.getChartAlarm(params, data => {\n            if (data) {\n                var alarmLast12Month = data.alarmLast12Month;\n                if (Libs.isArrayData(alarmLast12Month)) {\n                    var dataItem = [];\n                    for (var i = 0, len = alarmLast12Month.length; i < len; i++) {\n                        categories.push(alarmLast12Month[i].time_full);\n                        dataItem.push([alarmLast12Month[i].time_full, alarmLast12Month[i].total_alarm]);\n                    }\n\n                    series.push({\n                        name: 'Alarms - Last 12 months',\n                        type: 'spline',\n                        data: dataItem,\n                        tooltip: {\n                            valueSuffix: ''\n                        }\n                    })\n                }\n                self.setState({\n                    curItem: data,\n                    series: series,\n                    categories: categories\n\n                }, () => {\n                    self.loadChartOption();\n                });\n            } else {\n                this.setState({\n                    curItem: curItem\n                })\n            }\n        }, false);\n    }\n\n    loadChartOption() {\n        var { categories, series } = this.state;\n        var chartOption = {\n            credits: { enabled: false },\n            exporting: { enabled: false },\n            chart: {\n                zoomType: 'xy',\n                height: 380\n            },\n            title: {\n                text: null,\n\n            },\n            colors: ['#f5893b', '#66bc51', '#004ec3'],\n            xAxis: {\n                categories: categories,\n                crosshair: true\n            },\n            yAxis: [{\n                min: 0,\n                lineWidth: 1,\n                gridLineWidth: 1,\n                labels: {\n                    format: '{value}',\n                    enabled: true\n                },\n                title: {\n                    text: 'kWh',\n                    enabled: false\n                }\n            }],\n            tooltip: {\n                shared: true\n            },\n            legend: {\n\n                layout: 'horizontal',\n                align: 'center',\n                verticalAlign: 'bottom',\n                borderWidth: 0,\n                showInLegend: false\n\n            },\n\n            series: series\n        };\n\n        this.setState({\n            chartOption: chartOption\n        })\n\n    }\n\n    downloadData = () => {\n        var { curItem } = this.state;\n        if (!Libs.isArrayData(curItem.alarmLast12Month)) return;\n        var alarmLast12Month = curItem.alarmLast12Month;\n\n        var dataExport = [];\n        for (var i = 0, len = alarmLast12Month.length; i < len; i++) {\n            dataExport.push({\n                'Time': alarmLast12Month[i].time_full,\n                'Project name': curItem.name,\n                'Total': alarmLast12Month[i].total_alarm\n            });\n        }\n\n        const fileType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';\n        const fileExtension = '.xlsx';\n        const ws = XLSX.utils.json_to_sheet(dataExport, { skipHeader: false });\n        const wb = {\n            SheetNames: ['Alarms - Last 12 months'],\n            Sheets: { 'Alarms - Last 12 months': ws }\n        };\n        const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\n        const data = new Blob([excelBuffer], { type: fileType });\n        FileSaver.saveAs(data, \"Export-alarm-12-month-\" + moment().format('YYYY-MM-DD_hh:mm:ss') + fileExtension);\n    }\n\n\n    render() {\n        return this.jsxTemplate.call(this)\n    }\n}\n\nconst HighOrderComponentTranslated = withTranslation('common')(ChartAlarm)\nexport default HighOrderComponentTranslated;"]},"metadata":{},"sourceType":"module"}