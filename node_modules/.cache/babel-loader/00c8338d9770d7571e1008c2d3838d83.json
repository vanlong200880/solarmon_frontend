{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import AutoJsx from'./Auto.jsx';import BaseComponent from'../../../../../BaseComponent';import Libs from'../../../../../../utils/Libs';import{withTranslation}from'react-i18next';import Constants from'../../../../../../utils/Constants';import MainDeviceService from'../../../../../../services/MainDeviceService';import ControlCalendarValidate from'./ControlCalendarValidate';import moment from'moment';var Auto=/*#__PURE__*/function(_BaseComponent){_inherits(Auto,_BaseComponent);var _super=_createSuper(Auto);function Auto(props,context){var _this;_classCallCheck(this,Auto);_this=_super.call(this,props,context);_this.onClickCloseChangeMode=function(){_this.setState({changeMode:false});};_this.calbackChangeMode=function(searchParam){var self=_assertThisInitialized(_this);var params={schedule_control_mode:searchParam.scheduled_mode,hash_id:_this.state.hash_id,type:'schedule_control'};MainDeviceService.instance.updateControlMode(params,function(status,msg){if(status){self.setState({searchParam:searchParam,changeMode:false});}else if(!Libs.isBlank(msg)){self.toast(msg,\"error\");}},true);};_this.closeDeleteCalendar=function(status){if(status){_this.getListControlCalendar();}_this.setState({deleteItemCalendar:false});};_this.onClickCloseOnOff=function(status){if(status){_this.getListInverter();}_this.setState({showOnOffPopup:false});};_this.onClickOnOff=function(index){var dataListInverter=_this.state.dataListInverter;if(!Libs.isArrayData(dataListInverter))return;var item=dataListInverter[index];if(Libs.isObjectEmpty(item))return;_this.setState({showOnOffPopup:true,curItem:item});};_this.jsxTemplate=AutoJsx;_this.state={hash_id:_this.props.hash_id,curItem:{},dataListInverter:[],showOnOffPopup:false,deleteItemCalendar:false,changeMode:false,itemCalendar:{},searchParam:{limit:Constants.COMMON.LIMIT,offset:0,index:1,max_date:Libs.getCurrentDDMMYYYY(),current_date:Libs.getCurrentDDMMYYYY(),scheduled_mode:1,date_from:moment().format(\"DD/MM/YYYY HH:mm\"),min_date:moment().format(\"DD/MM/YYYY HH:mm\")},eventsList:[]};_this.handleInputChange=_this.handleInputChange.bind(_assertThisInitialized(_this));_this.handleInputDateChange=_this.handleInputDateChange.bind(_assertThisInitialized(_this));return _this;}_createClass(Auto,[{key:\"componentDidMount\",value:function componentDidMount(){this.getListInverter();this.getListControlCalendar();this.getProjectDetail();}},{key:\"getProjectDetail\",value:/**\n     * @description Item click event\n     * @author Long.Pham 12-05-2021\n     * @param index element in the list\n     */function getProjectDetail(){var self=this;var searchParam=this.state.searchParam;var params={hash_id:this.state.hash_id};MainDeviceService.instance.getProjectDetail(params,function(data){if(data){searchParam.scheduled_mode=data.schedule_control_mode;self.setState({curProject:data,searchParam:searchParam});}},false);}/**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */},{key:\"handleInputDateChange\",value:function handleInputDateChange(event){var target=event.target;var name=target.name;var value=target.value;if(target.type==='checkbox'){value=target.checked?1:0;}if(name){var searchParam=this.state.searchParam;searchParam[name]=value;if(name=='date_from'){searchParam.date_to=moment(Libs.dateFormat(value,'YYYY-MM-DD HH:mm:ss','DD/MM/YYYY HH:mm')).add(2,'hours').format('DD/MM/YYYY HH:mm');}this.setState({searchParam:searchParam});}}/**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */},{key:\"validateOne\",value:function(){var _validateOne=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var target,name,value,param,v,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:target=event.target;name=target.name;value=target.value;if(!name){_context.next=10;break;}param=_defineProperty({},name,value);v=new ControlCalendarValidate(this.props);_context.next=8;return v.validateOne(param,name);case 8:error=_context.sent;if(error!=null){this.setValidateMessage(error,true);}case 10:case\"end\":return _context.stop();}}},_callee,this);}));function validateOne(_x){return _validateOne.apply(this,arguments);}return validateOne;}()},{key:\"handleCheckedChange\",value:function handleCheckedChange(index){var dataListInverter=this.state.dataListInverter;if(!Libs.isArrayData(dataListInverter))return;var item=dataListInverter[index];if(Libs.isObjectEmpty(item))return;dataListInverter[index].checked=dataListInverter[index].checked==1?0:1;this.setState({dataListInverter:dataListInverter});}},{key:\"handleInputChange\",value:/**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */function handleInputChange(event){var target=event.target,self=this;var name=target.name;var value=target.value;if(target.type==='checkbox'){value=target.checked?1:0;}if(name){var searchParam=this.state.searchParam;if(name=='scheduled_mode_auto'){if(searchParam.scheduled_mode==2){return;}self.setState({changeMode:true});}if(name=='scheduled_mode_manual'){if(searchParam.scheduled_mode==1){return;}self.setState({changeMode:true});}}}},{key:\"onClickAddControlCalendarAction\",value:function(){var _onClickAddControlCalendarAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this$state,curItem,searchParam,dataListInverter,self,params,v,errors,dataDevices;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$state=this.state,curItem=_this$state.curItem,searchParam=_this$state.searchParam,dataListInverter=_this$state.dataListInverter,self=this;params=Object.assign({},searchParam);v=new ControlCalendarValidate(this.props);_context2.next=5;return v.FLValidationAll(params);case 5:errors=_context2.sent;if(!errors){_context2.next=9;break;}this.setValidateMessage(errors);return _context2.abrupt(\"return\");case 9://remove message validation\nthis.removeAllValidateMessage();params.screen_mode=Constants.SCREEN_MODE.ADD;if(Libs.isArrayData(dataListInverter)){_context2.next=13;break;}return _context2.abrupt(\"return\");case 13:dataDevices=dataListInverter.filter(function(item){return item.checked==1;});if(!Libs.isArrayData(dataDevices)){self.toast(\"You haven't selected a device\",\"error\");}params.dataDevices=dataDevices;params.date_from=Libs.dateFormat(searchParam.date_from,\"YYYY-MM-DD HH:mm:ss\",\"DD/MM/YYYY HH:mm:ss\");params.date_to=Libs.dateFormat(searchParam.date_to,\"YYYY-MM-DD HH:mm:ss\",\"DD/MM/YYYY HH:mm:ss\");MainDeviceService.instance.saveArrControlCalendar(params,function(status,data,msg){if(status){self.toast(msg,\"info\");searchParam.date_from=null;searchParam.date_to=null;self.setState({searchParam:searchParam},function(){self.getListControlCalendar();});}else if(data){self.setValidateMessage(data);}else if(!Libs.isBlank(msg)){self.toast(msg,\"error\");}},true);case 19:case\"end\":return _context2.stop();}}},_callee2,this);}));function onClickAddControlCalendarAction(){return _onClickAddControlCalendarAction.apply(this,arguments);}return onClickAddControlCalendarAction;}()/**\n        * get list\n        * @author Long.Pham 2019-06-03\n        */},{key:\"getListControlCalendar\",value:function getListControlCalendar(){var self=this;var _this$state2=this.state,curItem=_this$state2.curItem,hash_id=_this$state2.hash_id;var params=Object.assign({},curItem);params.hash_id=hash_id;var eventsList=[];MainDeviceService.instance.getListBySiteControlCalendar(params,function(data,total_row){if(Libs.isArrayData(data)){data.map(function(item,index){eventsList.push({'title':item.title,'start':new Date(item.start),'end':new Date(item.end),'index':index,'id':item.id,'id_device':item.id_device,'id_site':item.id_site,'hash_id':item.hash_id,'date_from':item.date_from,'date_to':item.date_to});});self.setState({eventsList:eventsList});}else{self.setState({eventsList:[]});}});}},{key:\"onSelectEvent\",value:function onSelectEvent(event){if(Libs.isObjectEmpty(event))return;this.setState({itemCalendar:event,deleteItemCalendar:true});}},{key:\"getListInverter\",value:/**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */function getListInverter(){var self=this;var params=this.state.searchParam;params.id_language=this.employee.id_language;params.id_employee=this.employee.id_employee;params.hash_id=this.state.hash_id;params.type='private';MainDeviceService.instance.getListInverter(params,function(data,total_row){if(Libs.isArrayData(data)){self.setState({dataListInverter:data});}else{self.setState({dataListInverter:[]});}self.forceUpdate();});}},{key:\"render\",value:function render(){return this.jsxTemplate.call(this);}}]);return Auto;}(BaseComponent);var HighOrderComponentTranslated=withTranslation('common')(Auto);export default HighOrderComponentTranslated;","map":{"version":3,"sources":["/Volumes/Data/sources/solars/frontend/src/containers/views/desktop/ModulePrivate/Control/Auto/Auto.js"],"names":["AutoJsx","BaseComponent","Libs","withTranslation","Constants","MainDeviceService","ControlCalendarValidate","moment","Auto","props","context","onClickCloseChangeMode","setState","changeMode","calbackChangeMode","searchParam","self","params","schedule_control_mode","scheduled_mode","hash_id","state","type","instance","updateControlMode","status","msg","isBlank","toast","closeDeleteCalendar","getListControlCalendar","deleteItemCalendar","onClickCloseOnOff","getListInverter","showOnOffPopup","onClickOnOff","index","dataListInverter","isArrayData","item","isObjectEmpty","curItem","jsxTemplate","itemCalendar","limit","COMMON","LIMIT","offset","max_date","getCurrentDDMMYYYY","current_date","date_from","format","min_date","eventsList","handleInputChange","bind","handleInputDateChange","getProjectDetail","data","curProject","event","target","name","value","checked","date_to","dateFormat","add","param","v","validateOne","error","setValidateMessage","Object","assign","FLValidationAll","errors","removeAllValidateMessage","screen_mode","SCREEN_MODE","ADD","dataDevices","filter","saveArrControlCalendar","getListBySiteControlCalendar","total_row","map","push","title","Date","start","end","id","id_device","id_site","id_language","employee","id_employee","forceUpdate","call","HighOrderComponentTranslated"],"mappings":"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","sourcesContent":["import AutoJsx from './Auto.jsx';\nimport BaseComponent from '../../../../../BaseComponent';\nimport Libs from '../../../../../../utils/Libs';\nimport { withTranslation } from 'react-i18next';\nimport Constants from '../../../../../../utils/Constants';\nimport MainDeviceService from '../../../../../../services/MainDeviceService';\nimport ControlCalendarValidate from './ControlCalendarValidate';\nimport moment from 'moment';\n\n\nclass Auto extends BaseComponent {\n\n    constructor(props, context) {\n        super(props, context);\n        this.jsxTemplate = AutoJsx;\n        this.state = {\n            hash_id: this.props.hash_id,\n            curItem: {},\n            dataListInverter: [],\n            showOnOffPopup: false,\n            deleteItemCalendar: false,\n            changeMode: false,\n            itemCalendar: {},\n            searchParam: {\n                limit: Constants.COMMON.LIMIT,\n                offset: 0,\n                index: 1,\n                max_date: Libs.getCurrentDDMMYYYY(),\n                current_date: Libs.getCurrentDDMMYYYY(),\n                scheduled_mode: 1,\n                date_from: moment().format(\"DD/MM/YYYY HH:mm\"),\n                min_date: moment().format(\"DD/MM/YYYY HH:mm\"),\n            },\n            eventsList: []\n        };\n\n        this.handleInputChange = this.handleInputChange.bind(this);\n        this.handleInputDateChange = this.handleInputDateChange.bind(this);\n\n    }\n\n    componentDidMount() {\n        this.getListInverter();\n        this.getListControlCalendar();\n        this.getProjectDetail();\n    }\n\n\n    onClickCloseChangeMode = () => {\n        this.setState({\n            changeMode: false\n        });\n    }\n    /**\n     * @description Item click event\n     * @author Long.Pham 12-05-2021\n     * @param index element in the list\n     */\n    getProjectDetail() {\n        var self = this;\n        var { searchParam } = this.state;\n        var params = {\n            hash_id: this.state.hash_id\n        };\n        MainDeviceService.instance.getProjectDetail(params, data => {\n            if (data) {\n                searchParam.scheduled_mode = data.schedule_control_mode;\n                self.setState({\n                    curProject: data,\n                    searchParam: searchParam\n                });\n            }\n        }, false);\n    }\n\n    /**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */\n    handleInputDateChange(event) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value;\n        if (target.type === 'checkbox') {\n            value = target.checked ? 1 : 0;\n        }\n\n        if (name) {\n            let { searchParam } = this.state;\n            searchParam[name] = value;\n\n            if (name == 'date_from') {\n                searchParam.date_to = moment(Libs.dateFormat(value, 'YYYY-MM-DD HH:mm:ss', 'DD/MM/YYYY HH:mm')).add(2, 'hours').format('DD/MM/YYYY HH:mm')\n            }\n            this.setState({ searchParam });\n        }\n    }\n\n\n    /**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */\n    async validateOne(event) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value;\n        if (name) {\n            let param = {\n                [name]: value\n            }\n            let v = new ControlCalendarValidate(this.props);\n            let error = await v.validateOne(param, name);\n            if (error != null) {\n                this.setValidateMessage(error, true);\n            }\n        }\n    }\n\n\n    handleCheckedChange(index) {\n        var { dataListInverter } = this.state;\n        if (!Libs.isArrayData(dataListInverter)) return;\n        var item = dataListInverter[index];\n        if (Libs.isObjectEmpty(item)) return;\n\n        dataListInverter[index].checked = dataListInverter[index].checked == 1 ? 0 : 1;\n        this.setState({\n            dataListInverter: dataListInverter\n        })\n    }\n\n    calbackChangeMode = (searchParam) => {\n        var self = this;\n        var params = {\n            schedule_control_mode: searchParam.scheduled_mode,\n            hash_id: this.state.hash_id,\n            type: 'schedule_control'\n        };\n        MainDeviceService.instance.updateControlMode(params, function (status, msg) {\n            if (status) {\n                self.setState({ searchParam: searchParam, changeMode: false });\n            }\n            else if (!Libs.isBlank(msg)) {\n                self.toast(msg, \"error\");\n            }\n        }, true);\n    }\n    /**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */\n    handleInputChange(event) {\n        let target = event.target, self = this;\n        let name = target.name;\n        let value = target.value;\n        if (target.type === 'checkbox') {\n            value = target.checked ? 1 : 0;\n        }\n\n        if (name) {\n            var { searchParam } = this.state;\n            if (name == 'scheduled_mode_auto') {\n                if (searchParam.scheduled_mode == 2) { return; }\n                self.setState({ changeMode: true });\n            }\n            if (name == 'scheduled_mode_manual') {\n                if (searchParam.scheduled_mode == 1) { return; }\n                self.setState({ changeMode: true });\n            }\n        }\n    }\n\n    async onClickAddControlCalendarAction() {\n        var { curItem, searchParam, dataListInverter } = this.state, self = this;\n        var params = Object.assign({}, searchParam);\n        let v = new ControlCalendarValidate(this.props);\n        let errors = await v.FLValidationAll(params);\n        if (errors) {\n            this.setValidateMessage(errors);\n            return;\n        }\n\n        //remove message validation\n        this.removeAllValidateMessage();\n        params.screen_mode = Constants.SCREEN_MODE.ADD;\n\n        if (!Libs.isArrayData(dataListInverter)) return;\n        var dataDevices = dataListInverter.filter((item) => item.checked == 1);\n        if (!Libs.isArrayData(dataDevices)) { self.toast(\"You haven't selected a device\", \"error\"); }\n        params.dataDevices = dataDevices;\n        params.date_from = Libs.dateFormat(searchParam.date_from, \"YYYY-MM-DD HH:mm:ss\", \"DD/MM/YYYY HH:mm:ss\");\n        params.date_to = Libs.dateFormat(searchParam.date_to, \"YYYY-MM-DD HH:mm:ss\", \"DD/MM/YYYY HH:mm:ss\");\n\n        MainDeviceService.instance.saveArrControlCalendar(params, function (status, data, msg) {\n            if (status) {\n                self.toast(msg, \"info\");\n                searchParam.date_from = null;\n                searchParam.date_to = null;\n                self.setState({\n                    searchParam: searchParam\n                }, () => {\n                    self.getListControlCalendar();\n                })\n            }\n            else if (data) {\n                self.setValidateMessage(data);\n            }\n\n            else if (!Libs.isBlank(msg)) {\n                self.toast(msg, \"error\");\n            }\n        }, true);\n    }\n\n\n\n    /**\n        * get list\n        * @author Long.Pham 2019-06-03\n        */\n    getListControlCalendar() {\n        let self = this;\n        var { curItem, hash_id } = this.state;\n        let params = Object.assign({}, curItem);\n        params.hash_id = hash_id;\n\n        var eventsList = [];\n        MainDeviceService.instance.getListBySiteControlCalendar(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                data.map((item, index) => {\n                    eventsList.push({\n                        'title': item.title,\n                        'start': new Date(item.start),\n                        'end': new Date(item.end),\n                        'index': index,\n                        'id': item.id,\n                        'id_device': item.id_device,\n                        'id_site': item.id_site,\n                        'hash_id': item.hash_id,\n                        'date_from': item.date_from,\n                        'date_to': item.date_to\n                    }\n                    );\n                })\n                self.setState({\n                    eventsList: eventsList\n                });\n\n            } else {\n                self.setState({\n                    eventsList: []\n                });\n            }\n        });\n    }\n\n    onSelectEvent(event) {\n        if (Libs.isObjectEmpty(event)) return;\n        this.setState({\n            itemCalendar: event,\n            deleteItemCalendar: true\n        })\n    }\n\n    closeDeleteCalendar = (status) => {\n        if (status) {\n            this.getListControlCalendar();\n        }\n        this.setState({\n            deleteItemCalendar: false\n        })\n    }\n\n\n    onClickCloseOnOff = (status) => {\n        if (status) {\n            this.getListInverter();\n        }\n        this.setState({\n            showOnOffPopup: false\n        })\n    }\n\n\n    onClickOnOff = (index) => {\n        var { dataListInverter } = this.state;\n        if (!Libs.isArrayData(dataListInverter)) return;\n        var item = dataListInverter[index];\n        if (Libs.isObjectEmpty(item)) return;\n        this.setState({\n            showOnOffPopup: true,\n            curItem: item\n        })\n\n    }\n\n    /**\n     * get list\n     * @author Long.Pham 2019-06-03\n     */\n    getListInverter() {\n        let self = this;\n        let params = this.state.searchParam;\n        params.id_language = this.employee.id_language;\n        params.id_employee = this.employee.id_employee;\n        params.hash_id = this.state.hash_id;\n        params.type = 'private';\n        MainDeviceService.instance.getListInverter(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataListInverter: data\n                });\n            } else {\n                self.setState({\n                    dataListInverter: []\n                });\n            }\n            self.forceUpdate();\n        });\n    }\n\n\n    render() {\n        return this.jsxTemplate.call(this)\n    }\n}\n\nconst HighOrderComponentTranslated = withTranslation('common')(Auto)\nexport default HighOrderComponentTranslated;"]},"metadata":{},"sourceType":"module"}