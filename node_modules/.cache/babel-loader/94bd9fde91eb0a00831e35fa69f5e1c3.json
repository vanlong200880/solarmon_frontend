{"ast":null,"code":"import _defineProperty from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solars/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import BaseComponent from'../../../../BaseComponent';import Libs from'../../../../../utils/Libs';import SetupPopupJsx from'./SetupPopup.jsx';import ProjectService from'../../../../../services/ProjectService';import Constants from'../../../../../utils/Constants';import SetupPopupValidate from'./SetupPopupValidate';import EstimationSensorValidate from'./EstimationSensorValidate';var SetupPopup=/*#__PURE__*/function(_BaseComponent){_inherits(SetupPopup,_BaseComponent);var _super=_createSuper(SetupPopup);function SetupPopup(props){var _this;_classCallCheck(this,SetupPopup);_this=_super.call(this,props);_this.loadConfig=function(){var item=_this.props.curItem,self=_assertThisInitialized(_this);if(Libs.isObjectEmpty(item))return;ProjectService.instance.getDetailConfig(item,function(data){if(data){self.setState({curItem:data,dataConfigRevenue:Libs.isArrayData(data.dataConfigRevenue)?data.dataConfigRevenue:[]});}},false);};_this.handleDropdownChange=function(item,name){var self=_assertThisInitialized(_this);var curItem=self.state.curItem;if(Libs.isObjectEmpty(item)){curItem.year='';}else{var value=item.value;curItem[name]=value;self.setValidateMessage({year:''},true);}self.setState({curItem:curItem});};_this.onItemClickDelete=function(index){var dataConfigRevenue=_this.state.dataConfigRevenue;if(!Libs.isArrayData(dataConfigRevenue))return;var item=dataConfigRevenue[index];if(Libs.isObjectEmpty(item))return;dataConfigRevenue.splice(index,1);_this.setState({dataConfigRevenue:dataConfigRevenue});};_this.addRowConfigRevenue=function(){var dataConfigRevenue=_this.state.dataConfigRevenue;dataConfigRevenue.push({id:'',id_project:'',config_revenue:'',start_date:'',end_date:'',status:1});_this.setState({dataConfigRevenue:dataConfigRevenue});};_this.state={curItemProject:_this.props.curItem,curItem:{},dataYear:_this.getListYear(),dataConfigRevenue:[]};_this.jsxTemplate=SetupPopupJsx;_this.handleInputChangeItem=_this.handleInputChangeItem.bind(_assertThisInitialized(_this));_this.handleDropdownChange=_this.handleDropdownChange.bind(_assertThisInitialized(_this));return _this;}_createClass(SetupPopup,[{key:\"componentDidMount\",value:function componentDidMount(){this.loadConfig();}/**\n     * @description Item click event\n     * @author Long.Pham 12-05-2021\n     * @param index element in the list\n     */},{key:\"handleInputChangeItem\",value:/**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */function handleInputChangeItem(event,index){var target=event.target;var name=target.name;var value=target.value;if(target.type==='checkbox'){value=target.checked?1:0;}if(name){var dataConfigRevenue=this.state.dataConfigRevenue;var item=dataConfigRevenue[index];if(name=='config_revenue'){var numericExpression=/^[0-9\\b]+$/;if(value==\"\"||numericExpression.test(value)){item[name]=value;dataConfigRevenue[index]=item;this.setState({dataConfigRevenue:dataConfigRevenue});}}else{item[name]=value;dataConfigRevenue[index]=item;this.setState({dataConfigRevenue:dataConfigRevenue});}}}},{key:\"getListYear\",value:function getListYear(){var dataYear=[];var date=new Date();var year=date.getFullYear();if(year>0){for(var i=year;i>=year-20;i--){dataYear.push({id:i,value:i,label:i});}}return dataYear;}},{key:\"onSave\",value:/**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */function(){var _onSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$state,curItem,dataConfigRevenue,curItemProject,self,params,v,errors;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$state=this.state,curItem=_this$state.curItem,dataConfigRevenue=_this$state.dataConfigRevenue,curItemProject=_this$state.curItemProject,self=this;params=Object.assign({},curItem);params.screen_mode=Constants.SCREEN_MODE.EDIT;params.id_language=this.employee.id_language;params.id_project=curItemProject.id;params.dataConfigRevenue=dataConfigRevenue;v=new SetupPopupValidate(this.props);_context.next=9;return v.FLValidationAll(curItem);case 9:errors=_context.sent;if(!errors){_context.next=13;break;}this.setValidateMessage(errors);return _context.abrupt(\"return\");case 13://remove message validation\nthis.removeAllValidateMessage();ProjectService.instance.saveConfig(params,function(status,data,msg){if(status){self.toast(msg,\"info\");self.props.onItemClickCloseSetup(false);}else if(data){self.setValidateMessage(data);}else if(!Libs.isBlank(msg)){self.toast(msg,\"error\");}},true);case 15:case\"end\":return _context.stop();}}},_callee,this);}));function onSave(){return _onSave.apply(this,arguments);}return onSave;}()/**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */},{key:\"onSaveEstimationSenSor\",value:function(){var _onSaveEstimationSenSor=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this$state2,curItem,curItemProject,self,params,v,errors;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$state2=this.state,curItem=_this$state2.curItem,curItemProject=_this$state2.curItemProject,self=this;params=Object.assign({},curItem);params.screen_mode=Constants.SCREEN_MODE.EDIT;params.id_language=this.employee.id_language;params.id_project=curItemProject.id;v=new EstimationSensorValidate(this.props);_context2.next=8;return v.FLValidationAll(curItem);case 8:errors=_context2.sent;if(!errors){_context2.next=12;break;}this.setValidateMessage(errors);return _context2.abrupt(\"return\");case 12://remove message validation\nthis.removeAllValidateMessage();ProjectService.instance.saveConfigEstimationSenSor(params,function(status,data,msg){if(status){self.toast(msg,\"info\");}else if(data){self.setValidateMessage(data);}else if(!Libs.isBlank(msg)){self.toast(msg,\"error\");}},true);case 14:case\"end\":return _context2.stop();}}},_callee2,this);}));function onSaveEstimationSenSor(){return _onSaveEstimationSenSor.apply(this,arguments);}return onSaveEstimationSenSor;}()/**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */},{key:\"validateOne\",value:function(){var _validateOne=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var target,name,value,param,v,error;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:target=event.target;name=target.name;value=target.value;if(!name){_context3.next=10;break;}param=_defineProperty({},name,value);v=new SetupPopupValidate(this.props);_context3.next=8;return v.validateOne(param,name);case 8:error=_context3.sent;if(error!=null){this.setValidateMessage(error,true);}case 10:case\"end\":return _context3.stop();}}},_callee3,this);}));function validateOne(_x){return _validateOne.apply(this,arguments);}return validateOne;}()/**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */},{key:\"validateOneEst\",value:function(){var _validateOneEst=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event){var target,name,value,param,v,error;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:target=event.target;name=target.name;value=target.value;if(!name){_context4.next=10;break;}param=_defineProperty({},name,value);v=new EstimationSensorValidate(this.props);_context4.next=8;return v.validateOne(param,name);case 8:error=_context4.sent;if(error!=null){this.setValidateMessage(error,true);}case 10:case\"end\":return _context4.stop();}}},_callee4,this);}));function validateOneEst(_x2){return _validateOneEst.apply(this,arguments);}return validateOneEst;}()}]);return SetupPopup;}(BaseComponent);export default SetupPopup;","map":{"version":3,"sources":["/Volumes/Data/sources/solars/frontend/src/containers/views/desktop/ModuleSystem/Project/SetupPopup.js"],"names":["BaseComponent","Libs","SetupPopupJsx","ProjectService","Constants","SetupPopupValidate","EstimationSensorValidate","SetupPopup","props","loadConfig","item","curItem","self","isObjectEmpty","instance","getDetailConfig","data","setState","dataConfigRevenue","isArrayData","handleDropdownChange","name","state","year","value","setValidateMessage","onItemClickDelete","index","splice","addRowConfigRevenue","push","id","id_project","config_revenue","start_date","end_date","status","curItemProject","dataYear","getListYear","jsxTemplate","handleInputChangeItem","bind","event","target","type","checked","numericExpression","test","date","Date","getFullYear","i","label","params","Object","assign","screen_mode","SCREEN_MODE","EDIT","id_language","employee","v","FLValidationAll","errors","removeAllValidateMessage","saveConfig","msg","toast","onItemClickCloseSetup","isBlank","saveConfigEstimationSenSor","param","validateOne","error"],"mappings":"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","sourcesContent":["\nimport BaseComponent from '../../../../BaseComponent';\nimport Libs from '../../../../../utils/Libs';\nimport SetupPopupJsx from './SetupPopup.jsx';\nimport ProjectService from '../../../../../services/ProjectService';\nimport Constants from '../../../../../utils/Constants';\nimport SetupPopupValidate from './SetupPopupValidate';\nimport EstimationSensorValidate from './EstimationSensorValidate';\n\nclass SetupPopup extends BaseComponent {\n    constructor(props) {\n        super(props);\n        this.state = {\n            curItemProject: this.props.curItem,\n            curItem: {},\n            dataYear: this.getListYear(),\n            dataConfigRevenue: []\n        }\n\n        this.jsxTemplate = SetupPopupJsx;\n        this.handleInputChangeItem = this.handleInputChangeItem.bind(this);\n        this.handleDropdownChange = this.handleDropdownChange.bind(this);\n    }\n\n    componentDidMount(){\n        this.loadConfig();\n    }\n    /**\n     * @description Item click event\n     * @author Long.Pham 12-05-2021\n     * @param index element in the list\n     */\n     loadConfig = () => {\n        var item = this.props.curItem, self = this;\n        if(Libs.isObjectEmpty(item)) return;\n\n        ProjectService.instance.getDetailConfig(item, data => {\n            if (data) {\n                self.setState({\n                    curItem: data,\n                    dataConfigRevenue: Libs.isArrayData(data.dataConfigRevenue) ? data.dataConfigRevenue: []\n                });\n            }\n        }, false);\n    }\n\n    handleDropdownChange = (item, name) => {\n        var self = this;\n        let curItem = self.state.curItem;\n\n        if (Libs.isObjectEmpty(item)) {\n            curItem.year = '';\n        } else {\n            var value = item.value;\n            curItem[name] = value;\n            self.setValidateMessage({ year: '' }, true);\n        }\n\n        self.setState({\n            curItem: curItem\n        });\n    }\n\n    /**\n     * setValue method to Input\n     * @author Long.Pham 20/05/2021\n     */\n    handleInputChangeItem(event, index) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value;\n        if (target.type === 'checkbox') {\n            value = target.checked ? 1 : 0;\n        }\n\n        if (name) {\n            var { dataConfigRevenue } = this.state;\n            var item = dataConfigRevenue[index];\n\n            if (name == 'config_revenue') {\n                var numericExpression = /^[0-9\\b]+$/;\n                if (value == \"\" || numericExpression.test(value)) {\n                    item[name] = value;\n                    dataConfigRevenue[index] = item;\n                    this.setState({ dataConfigRevenue: dataConfigRevenue });\n                }\n            } else {\n                item[name] = value;\n                dataConfigRevenue[index] = item;\n                this.setState({ dataConfigRevenue: dataConfigRevenue });\n            }\n        }\n    }\n\n\n    getListYear() {\n        var dataYear = [];\n        let date = new Date();\n        let year = date.getFullYear();\n        if (year > 0) {\n            for (var i = year; i >= year - 20; i--) {\n                dataYear.push({\n                    id: i,\n                    value: i,\n                    label: i\n                })\n            }\n        }\n        return dataYear;\n    }\n\n    onItemClickDelete = (index) => {\n        var { dataConfigRevenue } = this.state;\n        if (!Libs.isArrayData(dataConfigRevenue)) return;\n        var item = dataConfigRevenue[index];\n        if (Libs.isObjectEmpty(item)) return;\n        dataConfigRevenue.splice(index, 1);\n        this.setState({\n            dataConfigRevenue: dataConfigRevenue\n        })\n    }\n\n    addRowConfigRevenue = () => {\n        var { dataConfigRevenue } = this.state;\n        dataConfigRevenue.push({\n            id: '',\n            id_project: '',\n            config_revenue: '',\n            start_date: '',\n            end_date: '',\n            status: 1\n        });\n        this.setState({\n            dataConfigRevenue: dataConfigRevenue\n        })\n    }\n\n\n    /**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */\n    async onSave() {\n        var { curItem, dataConfigRevenue, curItemProject } = this.state, self = this;\n        var params = Object.assign({}, curItem);\n        params.screen_mode = Constants.SCREEN_MODE.EDIT;\n        params.id_language = this.employee.id_language;\n        params.id_project = curItemProject.id;\n        params.dataConfigRevenue = dataConfigRevenue;\n\n        let v = new SetupPopupValidate(this.props);\n        let errors = await v.FLValidationAll(curItem);\n        if (errors) {\n            this.setValidateMessage(errors);\n            return;\n        }\n        //remove message validation\n        this.removeAllValidateMessage();\n\n\n\n        ProjectService.instance.saveConfig(params, function (status, data, msg) {\n            if (status) {\n                self.toast(msg, \"info\");\n                self.props.onItemClickCloseSetup(false);\n            }\n            else if (data) {\n                self.setValidateMessage(data);\n            }\n\n            else if (!Libs.isBlank(msg)) {\n                self.toast(msg, \"error\");\n            }\n        }, true);\n    }\n\n\n    \n    /**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */\n     async onSaveEstimationSenSor() {\n        var { curItem, curItemProject } = this.state, self = this;\n        var params = Object.assign({}, curItem);\n        params.screen_mode = Constants.SCREEN_MODE.EDIT;\n        params.id_language = this.employee.id_language;\n        params.id_project = curItemProject.id;\n\n        let v = new EstimationSensorValidate(this.props);\n        let errors = await v.FLValidationAll(curItem);\n        if (errors) {\n            this.setValidateMessage(errors);\n            return;\n        }\n        //remove message validation\n        this.removeAllValidateMessage();\n\n\n        ProjectService.instance.saveConfigEstimationSenSor(params, function (status, data, msg) {\n            if (status) {\n                self.toast(msg, \"info\");\n            }\n            else if (data) {\n                self.setValidateMessage(data);\n            }\n\n            else if (!Libs.isBlank(msg)) {\n                self.toast(msg, \"error\");\n            }\n        }, true);\n    }\n\n\n     /**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */\n      async validateOne(event) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value\n        if (name) {\n            let param = {\n                [name]: value\n            }\n            let v = new SetupPopupValidate(this.props);\n            let error = await v.validateOne(param, name);\n            if (error != null) {\n                this.setValidateMessage(error, true);\n            }\n        }\n    }\n\n    /**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */\n     async validateOneEst(event) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value\n        if (name) {\n            let param = {\n                [name]: value\n            }\n            let v = new EstimationSensorValidate(this.props);\n            let error = await v.validateOne(param, name);\n            if (error != null) {\n                this.setValidateMessage(error, true);\n            }\n        }\n    }\n\n}\nexport default SetupPopup;"]},"metadata":{},"sourceType":"module"}