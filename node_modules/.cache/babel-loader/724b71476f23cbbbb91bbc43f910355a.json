{"ast":null,"code":"/**\n * 验证规则库\n * @author ydr.me\n * @create 2015-07-05 22:40\n */var typeis=require('./typeis.js');var number=require('./number.js');var string=require('./string.js');var lang=require('./_validation-lang.js');var REG_NUMBERIC=/^-?[\\d.]+$/;module.exports=function(Validation){Validation.addRule('trim',function(val,done,param0){if(param0){this.data[this.path]=typeis(val)==='string'||typeis(val)==='number'?String(val).trim():'';}done();});Validation.addRule('type',function(val,done,param0){var the=this;var path=the.path;var isRequired=the.getRuleParams(path,'required');isRequired=isRequired?isRequired[0]:true;var alias=the.getAlias(path)||path;if(!isRequired&&!val){return done(null);}switch(param0){case'array':return done(typeis(val)==='array'?null:string.assign(lang.get('type','array'),alias,param0));case'number':return done(/^-?\\d+(\\.?\\d{0,3}$)|^\\.?\\d{0,3}$|^-$/g.test(val)?null:string.assign(lang.get('type','number'),alias,param0));case'decimal':return done(/^\\d*\\.?\\d*$/.test(val)?null:string.assign(lang.get('type','number'),alias,param0));case'number_positive':return done(/^\\d+(\\.\\d{1,3})?$/.test(val)?null:string.assign(lang.get('type','number'),alias,param0));case'integer':if(typeof val==='number'){val=val.toString();}val=val.replace(/^-/,'');return done(/^(0|[1-9]\\d*)$/.test(val)?null:string.assign(lang.get('type','integer'),alias,param0));case'mobile':return done(/^1\\d{10}$/.test(val)?null:string.assign(lang.get('type','mobile'),alias,param0));case'email':return done(typeis.email(val)?null:string.assign(lang.get('type','email'),alias,param0));case'url':return done(typeis.url(val)?null:string.assign(lang.get('type','url'),alias,param0));case'dateDMY':return done(typeis.date(val)?null:string.assign(lang.get('type','date'),alias,param0));case'dateYMD':return done(typeis.date(val,true)?null:string.assign(lang.get('type','date'),alias,param0));case'dateDMYHm':return done(typeis.dateTimeToMinute(val)?null:string.assign(lang.get('type','date'),alias,param0));case'dateYMDHm':return done(typeis.dateTimeToMinute(val,true)?null:string.assign(lang.get('type','date'),alias,param0));case'numreicAllowZero':if(typeof val==='number'){val=val.toString();}return done(/^[0-9]*$/.test(val)?null:string.assign(lang.get('type','numreicAllowZero'),alias,param0));default:break;}});Validation.addRule('required',function(val,done,param0){if(!param0){return done();}var convertVal=typeof val==='number'?val.toString():val;var isMultiple=_isMultiple(convertVal);var boolean=typeis(convertVal)==='file'?true:(isMultiple?convertVal:convertVal||'').length>0;//done(boolean ? null : '${path}不能为空');\ndone(boolean?null:lang.get('required'));});var _createLength=function _createLength(type){var typeMap={0:'minLength',1:'maxLength'};return function(val,done,param0){param0=number.parseInt(param0);var convertVal=typeof val==='number'?val.toString():val;var requiredParams=this.getRuleParams(this.path,'required');var required=requiredParams?requiredParams[0]:true;var isMultiple=_isMultiple(convertVal);var length=(isMultiple?convertVal:convertVal||'').length;var boolean=type===0?length>=param0:length<=param0;// 未填 && 可选\nif(!length&&!required){return done();}if(isMultiple){done(boolean?null:lang.get(typeMap[type],'select'));}else{done(boolean?null:lang.get(typeMap[type],'input'));}};};Validation.addRule('minLength',_createLength(0));Validation.addRule('maxLength',_createLength(1));Validation.addRule('equal',function(val,done,param0){val=val||'';done(val===this.getData(param0)?null:'${1}必须与'+this.getAlias(param0)+'相同');});var _createNumber=function _createNumber(type){return function(val,done,param0){val=val||'';var isRequired=this.getRuleParams(this.path,'required');isRequired=isRequired?isRequired[0]:true;// 非必填并且是空值\nif(!isRequired&&(val===\"\"||val===null||typeof val===\"undefined\")){return done(null);}if(!REG_NUMBERIC.test(val)){return done('${1}必须为数值格式');}val=number.parseFloat(val);param0=number.parseFloat(param0);var boolean=type===0?val>=param0:val<=param0;done(boolean?null:lang.get(type?'max':'min'));};};Validation.addRule('min',_createNumber(0));Validation.addRule('max',_createNumber(1));Validation.addRule('step',function(val,done,param0){val=val||'';var isRequired=this.getRuleParams(this.path,'required');// 非必填并且是空值\nif(!isRequired&&!val){return done(null);}if(!REG_NUMBERIC.test(val)){return done('${1}必须为数值格式');}var min=this.getRuleParams(this.path,'min')[0];val=number.parseInt(val,0);param0=number.parseInt(param0,0);if(!param0){return done(null);}done((val-min)%param0?'${1}递增步进值必须是'+param0+'，最小值为'+min:null);});var _createSelect=function _createSelect(type){return function(val,done,param0){if(!param0){return done();}if(typeis(val)!=='array'){return done('${1}必须为数组格式');}var length=val.length;// most\nif(type){done(length>param0?lang.get('most'):null);}// least\nelse{done(length<param0?lang.get('least'):null);}};};Validation.addRule('least',_createSelect(0));Validation.addRule('most',_createSelect(1));};//============================================================\n//============================================================\n//============================================================\n/**\n * 判断是否为多值类型\n * @param obj\n * @returns {boolean}\n */function _isMultiple(obj){return typeis.array(obj)||typeis(obj)==='filelist';}","map":{"version":3,"sources":["/Volumes/Data/sources/solarmon_production/solarmon_frontend/src/validator/libs/_validation-rules.js"],"names":["typeis","require","number","string","lang","REG_NUMBERIC","module","exports","Validation","addRule","val","done","param0","data","path","String","trim","the","isRequired","getRuleParams","alias","getAlias","assign","get","test","toString","replace","email","url","date","dateTimeToMinute","convertVal","isMultiple","_isMultiple","boolean","length","_createLength","type","typeMap","parseInt","requiredParams","required","getData","_createNumber","parseFloat","min","_createSelect","obj","array"],"mappings":"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","sourcesContent":["/**\n * 验证规则库\n * @author ydr.me\n * @create 2015-07-05 22:40\n */\n\nvar typeis = require('./typeis.js');\nvar number = require('./number.js');\nvar string = require('./string.js');\nvar lang = require('./_validation-lang.js');\n\nvar REG_NUMBERIC = /^-?[\\d.]+$/;\n\nmodule.exports = function (Validation) {\n    Validation.addRule('trim', function (val, done, param0) {\n        if (param0) {\n            this.data[this.path] = typeis(val) === 'string' || typeis(val) === 'number' ?\n                String(val).trim() : '';\n        }\n\n        done();\n    });\n\n    Validation.addRule('type', function (val, done, param0) {\n        var the = this;\n        var path = the.path;\n        var isRequired = the.getRuleParams(path, 'required');\n        isRequired = isRequired ? isRequired[0] : true;\n        var alias = the.getAlias(path) || path;\n\n        if (!isRequired && !val) {\n            return done(null);\n        }\n\n        switch (param0) {\n            case 'array':\n                return done(typeis(val) === 'array' ? null : string.assign(lang.get('type', 'array'), alias, param0));\n\n            case 'number':\n                return done(/^-?\\d+(\\.?\\d{0,3}$)|^\\.?\\d{0,3}$|^-$/g.test(val) ? null : string.assign(lang.get('type', 'number'), alias, param0));\n            case 'decimal':\n                return done(/^\\d*\\.?\\d*$/.test(val) ? null : string.assign(lang.get('type', 'number'), alias, param0));\n            case 'number_positive':\n                return done(/^\\d+(\\.\\d{1,3})?$/.test(val) ? null : string.assign(lang.get('type', 'number'), alias, param0));\n\n            case 'integer':\n                if (typeof val === 'number') {\n                    val = val.toString();\n                }\n                val = val.replace(/^-/, '');\n                return done(/^(0|[1-9]\\d*)$/.test(val) ? null : string.assign(lang.get('type', 'integer'), alias, param0));\n\n            case 'mobile':\n                return done(/^1\\d{10}$/.test(val) ? null : string.assign(lang.get('type', 'mobile'), alias, param0));\n\n            case 'email':\n                return done(typeis.email(val) ? null : string.assign(lang.get('type', 'email'), alias, param0));\n            case 'url':\n                return done(typeis.url(val) ? null : string.assign(lang.get('type', 'url'), alias, param0));\n            case 'dateDMY':\n                return done(typeis.date(val) ? null : string.assign(lang.get('type', 'date'), alias, param0));\n            case 'dateYMD':\n                return done(typeis.date(val, true) ? null : string.assign(lang.get('type', 'date'), alias, param0));\n            case 'dateDMYHm':\n                return done(typeis.dateTimeToMinute(val) ? null : string.assign(lang.get('type', 'date'), alias, param0));\n            case 'dateYMDHm':\n                return done(typeis.dateTimeToMinute(val, true) ? null : string.assign(lang.get('type', 'date'), alias, param0));\n            case 'numreicAllowZero':\n                if (typeof val === 'number') {\n                    val = val.toString();\n                }\n                return done(/^[0-9]*$/.test(val) ? null : string.assign(lang.get('type', 'numreicAllowZero'), alias, param0));\n            default:\n                break;    \n        }\n    });\n\n\n    Validation.addRule('required', function (val, done, param0) {\n        if (!param0) {\n            return done();\n        }\n        var convertVal = (typeof val === 'number')? val.toString() : val;\n        var isMultiple = _isMultiple(convertVal);\n        var boolean = typeis(convertVal) === 'file' ? true :\n            (isMultiple ? convertVal : (convertVal || '')).length > 0;\n        //done(boolean ? null : '${path}不能为空');\n        done(boolean ? null : lang.get('required'));\n    });\n\n\n    var _createLength = function (type) {\n        var typeMap = {\n            0: 'minLength',\n            1: 'maxLength'\n        };\n\n        return function (val, done, param0) {\n            param0 = number.parseInt(param0);\n            var convertVal = (typeof val === 'number') ? val.toString() : val;\n            var requiredParams = this.getRuleParams(this.path, 'required');\n            var required = requiredParams ? requiredParams[0] : true;\n            var isMultiple = _isMultiple(convertVal);\n            var length = (isMultiple ? convertVal : (convertVal || '')).length;\n            var boolean = type === 0 ? length >= param0 : length <= param0;\n\n            // 未填 && 可选\n            if (!length && !required) {\n                return done();\n            }\n\n            if (isMultiple) {\n                done(boolean ? null : lang.get(typeMap[type], 'select'));\n            } else {\n                done(boolean ? null : lang.get(typeMap[type], 'input'));\n            }\n        };\n    };\n\n    Validation.addRule('minLength', _createLength(0));\n    Validation.addRule('maxLength', _createLength(1));\n\n\n    Validation.addRule('equal', function (val, done, param0) {\n        val = val || '';\n        done(val === this.getData(param0) ? null : '${1}必须与' + this.getAlias(param0) + '相同');\n    });\n\n\n    var _createNumber = function (type) {\n        return function (val, done, param0) {\n            val = val || '';\n\n            var isRequired = this.getRuleParams(this.path, 'required');\n            isRequired = isRequired ? isRequired[0] : true;\n            // 非必填并且是空值\n            if (!isRequired && (val === \"\" || val === null || typeof val === \"undefined\")) {\n                return done(null);\n            }\n\n            if (!REG_NUMBERIC.test(val)) {\n                return done('${1}必须为数值格式');\n            }\n\n            val = number.parseFloat(val);\n            param0 = number.parseFloat(param0);\n\n            var boolean = type === 0 ? val >= param0 : val <= param0;\n\n            done(boolean ? null : lang.get(type ? 'max' : 'min'));\n        };\n    };\n\n    Validation.addRule('min', _createNumber(0));\n    Validation.addRule('max', _createNumber(1));\n    Validation.addRule('step', function (val, done, param0) {\n        val = val || '';\n\n        var isRequired = this.getRuleParams(this.path, 'required');\n\n        // 非必填并且是空值\n        if (!isRequired && !val) {\n            return done(null);\n        }\n\n        if (!REG_NUMBERIC.test(val)) {\n            return done('${1}必须为数值格式');\n        }\n\n        var min = this.getRuleParams(this.path, 'min')[0];\n\n        val = number.parseInt(val, 0);\n        param0 = number.parseInt(param0, 0);\n\n        if (!param0) {\n            return done(null);\n        }\n\n        done((val - min) % param0 ? '${1}递增步进值必须是' + param0 + '，最小值为' + min : null);\n    });\n\n    var _createSelect = function (type) {\n        return function (val, done, param0) {\n            if (!param0) {\n                return done();\n            }\n\n            if (typeis(val) !== 'array') {\n                return done('${1}必须为数组格式');\n            }\n\n            var length = val.length;\n\n            // most\n            if (type) {\n                done(length > param0 ? lang.get('most') : null);\n            }\n            // least\n            else {\n                done(length < param0 ? lang.get('least') : null);\n            }\n        };\n    };\n\n    Validation.addRule('least', _createSelect(0));\n    Validation.addRule('most', _createSelect(1));\n};\n\n\n//============================================================\n//============================================================\n//============================================================\n\n/**\n * 判断是否为多值类型\n * @param obj\n * @returns {boolean}\n */\nfunction _isMultiple(obj) {\n    return typeis.array(obj) || typeis(obj) === 'filelist';\n}\n"]},"metadata":{},"sourceType":"module"}