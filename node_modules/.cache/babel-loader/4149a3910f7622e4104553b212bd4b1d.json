{"ast":null,"code":"import _defineProperty from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import BaseComponent from'../../BaseComponent';import ResetPasswordJsx from'./ResetPassword.jsx';import{withTranslation}from'react-i18next';import ResetPasswordValidate from'./ResetPasswordValidate';import Libs from'../../../utils/Libs';import Constants from'../../../utils/Constants';import EmployeeService from'../../../services/EmployeeService';var ResetPassword=/*#__PURE__*/function(_BaseComponent){_inherits(ResetPassword,_BaseComponent);var _super=_createSuper(ResetPassword);function ResetPassword(props,context){var _this;_classCallCheck(this,ResetPassword);_this=_super.call(this,props,context);_this.jsxTemplate=ResetPasswordJsx;_this.state={curItem:{}};return _this;}_createClass(ResetPassword,[{key:\"onSaveAction\",value:function(){var _onSaveAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var t,curItem,self,errorFlag,token,user,v,errors,regexp,password,password_confirm;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:t=this.props.t;curItem=this.state.curItem,self=this;errorFlag=false;token='';if(Libs.isBlank(this.props)||Libs.isBlank(this.props.location)||Libs.isBlank(this.props.location.search)){window.location.href=Constants.SITE_URL.LOGIN;}token=this.props.location.search;token=token.replace(\"?token=\",\"\");if(Libs.isBlank(token)){window.location.href=Constants.SITE_URL.LOGIN;}user={password:Libs.SHA3(curItem.password),token:token};v=new ResetPasswordValidate(this.props);_context.next=12;return v.FLValidationAll(curItem);case 12:errors=_context.sent;if(!Libs.isBlank(curItem.password)||!Libs.isBlank(curItem.password_confirm)){regexp=/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;password=curItem.password;if(password.length<8||regexp.exec(password)===null){errors=Object.assign(Libs.isObjectEmpty(errors)?{}:errors,{password:t('employee.password_valid_min_8character')});errorFlag=true;}else{if(!Libs.isObjectEmpty(errors)){delete errors[password];}errorFlag=false;}password_confirm=curItem.password_confirm;if(password_confirm!==password||Libs.isBlank(curItem.password_confirm)){errors=Object.assign(Libs.isObjectEmpty(errors)?{}:errors,{password_confirm:t('employee.password_incorrect')});errorFlag=true;}else{errorFlag=false;if(!Libs.isObjectEmpty(errors)){delete errors[password_confirm];}}}if(!errors){_context.next=18;break;}this.setValidateMessage(errors,true);errorFlag=true;return _context.abrupt(\"return\");case 18://remove message validation\nthis.removeAllValidateMessage();if(!errorFlag){_context.next=21;break;}return _context.abrupt(\"return\");case 21:EmployeeService.instance.getResetPassword(user,function(data,status,mess){if(!Libs.isObjectEmpty(data)){self.toast(mess,\"info\");setTimeout(function(){window.location.href=Constants.SITE_URL.LOGIN;}.bind(this),2000);}else{self.toast(mess,\"error\");}},false);case 22:case\"end\":return _context.stop();}}},_callee,this);}));function onSaveAction(){return _onSaveAction.apply(this,arguments);}return onSaveAction;}()/**\r\n     * @description validate a field input\r\n     * @author Long.Pham 13/06/2021\r\n     * @param {*} event \r\n     */},{key:\"validateOne\",value:function(){var _validateOne=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var t,target,name,value,curItem,param,v,error,regexp;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:t=this.props.t;target=event.target;name=target.name;value=target.value;curItem=this.state.curItem;if(!name){_context2.next=15;break;}param=_defineProperty({},name,value);v=new ResetPasswordValidate(this.props);_context2.next=10;return v.validateOne(param,name);case 10:error=_context2.sent;regexp=/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;if(name==='password'){if(value.length<8||regexp.exec(value)===null){error={password:t('employee.password_valid_min_8character')};}else{error={password:''};}}if(name==='password_confirm'&&Libs.isBlank(error.password_confirm)){if(curItem.password!==value){error={password_confirm:t('employee.password_incorrect')};}else{error={password_confirm:''};}}if(error!=null){this.setValidateMessage(error,true);}case 15:case\"end\":return _context2.stop();}}},_callee2,this);}));function validateOne(_x){return _validateOne.apply(this,arguments);}return validateOne;}()},{key:\"render\",value:function render(){return this.jsxTemplate.call(this);}}]);return ResetPassword;}(BaseComponent);var HighOrderComponentTranslated=withTranslation('common')(ResetPassword);export default HighOrderComponentTranslated;","map":{"version":3,"sources":["/Volumes/Data/sources/solarmon_production/solarmon_frontend/src/containers/views/ResetPassword/ResetPassword.js"],"names":["BaseComponent","ResetPasswordJsx","withTranslation","ResetPasswordValidate","Libs","Constants","EmployeeService","ResetPassword","props","context","jsxTemplate","state","curItem","t","self","errorFlag","token","isBlank","location","search","window","href","SITE_URL","LOGIN","replace","user","password","SHA3","v","FLValidationAll","errors","password_confirm","regexp","length","exec","Object","assign","isObjectEmpty","setValidateMessage","removeAllValidateMessage","instance","getResetPassword","data","status","mess","toast","setTimeout","bind","event","target","name","value","param","validateOne","error","call","HighOrderComponentTranslated"],"mappings":"6sCAAA,MAAOA,CAAAA,aAAP,KAA0B,qBAA1B,CACA,MAAOC,CAAAA,gBAAP,KAA6B,qBAA7B,CACA,OAASC,eAAT,KAAgC,eAAhC,CACA,MAAOC,CAAAA,qBAAP,KAAkC,yBAAlC,CACA,MAAOC,CAAAA,IAAP,KAAiB,qBAAjB,CACA,MAAOC,CAAAA,SAAP,KAAsB,0BAAtB,CACA,MAAOC,CAAAA,eAAP,KAA4B,mCAA5B,C,GAEMC,CAAAA,a,sHAEF,uBAAYC,KAAZ,CAAmBC,OAAnB,CAA4B,+CACxB,uBAAMD,KAAN,CAAaC,OAAb,EACA,MAAKC,WAAL,CAAmBT,gBAAnB,CACA,MAAKU,KAAL,CAAa,CACTC,OAAO,CAAE,EADA,CAAb,CAHwB,aAM3B,C,2IAED,qNACUC,CADV,CACgB,KAAKL,KADrB,CACUK,CADV,CAEQD,OAFR,CAEkB,KAAKD,KAAL,CAAWC,OAF7B,CAEsCE,IAFtC,CAE6C,IAF7C,CAGQC,SAHR,CAGoB,KAHpB,CAIQC,KAJR,CAIgB,EAJhB,CAKI,GAAIZ,IAAI,CAACa,OAAL,CAAa,KAAKT,KAAlB,GAA4BJ,IAAI,CAACa,OAAL,CAAa,KAAKT,KAAL,CAAWU,QAAxB,CAA5B,EAAiEd,IAAI,CAACa,OAAL,CAAa,KAAKT,KAAL,CAAWU,QAAX,CAAoBC,MAAjC,CAArE,CAA+G,CAC3GC,MAAM,CAACF,QAAP,CAAgBG,IAAhB,CAAuBhB,SAAS,CAACiB,QAAV,CAAmBC,KAA1C,CACH,CACDP,KAAK,CAAG,KAAKR,KAAL,CAAWU,QAAX,CAAoBC,MAA5B,CACAH,KAAK,CAAGA,KAAK,CAACQ,OAAN,CAAc,SAAd,CAAyB,EAAzB,CAAR,CAEA,GAAIpB,IAAI,CAACa,OAAL,CAAaD,KAAb,CAAJ,CAAyB,CACrBI,MAAM,CAACF,QAAP,CAAgBG,IAAhB,CAAuBhB,SAAS,CAACiB,QAAV,CAAmBC,KAA1C,CACH,CAEGE,IAfR,CAee,CACPC,QAAQ,CAAEtB,IAAI,CAACuB,IAAL,CAAUf,OAAO,CAACc,QAAlB,CADH,CAEPV,KAAK,CAAEA,KAFA,CAff,CAoBQY,CApBR,CAoBY,GAAIzB,CAAAA,qBAAJ,CAA0B,KAAKK,KAA/B,CApBZ,wBAqBuBoB,CAAAA,CAAC,CAACC,eAAF,CAAkBjB,OAAlB,CArBvB,SAqBQkB,MArBR,eAsBI,GAAI,CAAC1B,IAAI,CAACa,OAAL,CAAaL,OAAO,CAACc,QAArB,CAAD,EAAmC,CAACtB,IAAI,CAACa,OAAL,CAAaL,OAAO,CAACmB,gBAArB,CAAxC,CAAgF,CACtEC,MADsE,CAC7D,6CAD6D,CAExEN,QAFwE,CAE7Dd,OAAO,CAACc,QAFqD,CAG5E,GAAIA,QAAQ,CAACO,MAAT,CAAkB,CAAlB,EAAuBD,MAAM,CAACE,IAAP,CAAYR,QAAZ,IAA0B,IAArD,CAA2D,CACvDI,MAAM,CAAGK,MAAM,CAACC,MAAP,CAAchC,IAAI,CAACiC,aAAL,CAAmBP,MAAnB,EAA6B,EAA7B,CAAkCA,MAAhD,CAAwD,CAAEJ,QAAQ,CAAEb,CAAC,CAAC,wCAAD,CAAb,CAAxD,CAAT,CACAE,SAAS,CAAG,IAAZ,CACH,CAHD,IAGO,CACH,GAAI,CAACX,IAAI,CAACiC,aAAL,CAAmBP,MAAnB,CAAL,CAAiC,CAC7B,MAAOA,CAAAA,MAAM,CAACJ,QAAD,CAAb,CACH,CACDX,SAAS,CAAG,KAAZ,CACH,CAEGgB,gBAbwE,CAarDnB,OAAO,CAACmB,gBAb6C,CAc5E,GAAIA,gBAAgB,GAAKL,QAArB,EAAiCtB,IAAI,CAACa,OAAL,CAAaL,OAAO,CAACmB,gBAArB,CAArC,CAA6E,CACzED,MAAM,CAAGK,MAAM,CAACC,MAAP,CAAchC,IAAI,CAACiC,aAAL,CAAmBP,MAAnB,EAA6B,EAA7B,CAAkCA,MAAhD,CAAwD,CAAEC,gBAAgB,CAAElB,CAAC,CAAC,6BAAD,CAArB,CAAxD,CAAT,CACAE,SAAS,CAAG,IAAZ,CACH,CAHD,IAGO,CACHA,SAAS,CAAG,KAAZ,CACA,GAAI,CAACX,IAAI,CAACiC,aAAL,CAAmBP,MAAnB,CAAL,CAAiC,CAC7B,MAAOA,CAAAA,MAAM,CAACC,gBAAD,CAAb,CACH,CACJ,CACJ,CA7CL,IAgDQD,MAhDR,0BAiDQ,KAAKQ,kBAAL,CAAwBR,MAAxB,CAAgC,IAAhC,EACAf,SAAS,CAAG,IAAZ,CAlDR,yCAqDI;AACA,KAAKwB,wBAAL,GAtDJ,IAuDQxB,SAvDR,mEA4DIT,eAAe,CAACkC,QAAhB,CAAyBC,gBAAzB,CAA0ChB,IAA1C,CAAgD,SAAUiB,IAAV,CAAgBC,MAAhB,CAAwBC,IAAxB,CAA8B,CAC1E,GAAI,CAACxC,IAAI,CAACiC,aAAL,CAAmBK,IAAnB,CAAL,CAA+B,CAC3B5B,IAAI,CAAC+B,KAAL,CAAWD,IAAX,CAAiB,MAAjB,EACAE,UAAU,CACN,UAAY,CAAE1B,MAAM,CAACF,QAAP,CAAgBG,IAAhB,CAAuBhB,SAAS,CAACiB,QAAV,CAAmBC,KAA1C,CAAkD,CAAhE,CAAiEwB,IAAjE,CAAsE,IAAtE,CADM,CACuE,IADvE,CAAV,CAGH,CALD,IAMK,CACDjC,IAAI,CAAC+B,KAAL,CAAWD,IAAX,CAAiB,OAAjB,EACH,CACJ,CAVD,CAUG,KAVH,EA5DJ,4D,8FA0EA;AACJ;AACA;AACA;AACA,O,+GACI,kBAAkBI,KAAlB,2KACUnC,CADV,CACgB,KAAKL,KADrB,CACUK,CADV,CAEQoC,MAFR,CAEiBD,KAAK,CAACC,MAFvB,CAGQC,IAHR,CAGeD,MAAM,CAACC,IAHtB,CAIQC,KAJR,CAIgBF,MAAM,CAACE,KAJvB,CAKQvC,OALR,CAKkB,KAAKD,KAAL,CAAWC,OAL7B,KAMQsC,IANR,2BAOYE,KAPZ,oBAQaF,IARb,CAQoBC,KARpB,EAUYvB,CAVZ,CAUgB,GAAIzB,CAAAA,qBAAJ,CAA0B,KAAKK,KAA/B,CAVhB,yBAW0BoB,CAAAA,CAAC,CAACyB,WAAF,CAAcD,KAAd,CAAqBF,IAArB,CAX1B,SAWYI,KAXZ,gBAYctB,MAZd,CAYuB,6CAZvB,CAaQ,GAAIkB,IAAI,GAAK,UAAb,CAAyB,CACrB,GAAIC,KAAK,CAAClB,MAAN,CAAe,CAAf,EAAoBD,MAAM,CAACE,IAAP,CAAYiB,KAAZ,IAAuB,IAA/C,CAAqD,CACjDG,KAAK,CAAG,CAAE5B,QAAQ,CAAEb,CAAC,CAAC,wCAAD,CAAb,CAAR,CACH,CAFD,IAEO,CACHyC,KAAK,CAAG,CAAE5B,QAAQ,CAAE,EAAZ,CAAR,CACH,CACJ,CAED,GAAIwB,IAAI,GAAK,kBAAT,EAA+B9C,IAAI,CAACa,OAAL,CAAaqC,KAAK,CAACvB,gBAAnB,CAAnC,CAAyE,CACrE,GAAInB,OAAO,CAACc,QAAR,GAAqByB,KAAzB,CAAgC,CAC5BG,KAAK,CAAG,CAAEvB,gBAAgB,CAAElB,CAAC,CAAC,6BAAD,CAArB,CAAR,CACH,CAFD,IAEO,CACHyC,KAAK,CAAG,CAAEvB,gBAAgB,CAAE,EAApB,CAAR,CACH,CACJ,CAED,GAAIuB,KAAK,EAAI,IAAb,CAAmB,CACf,KAAKhB,kBAAL,CAAwBgB,KAAxB,CAA+B,IAA/B,EACH,CA/BT,8D,mHAmCA,iBAAS,CACL,MAAO,MAAK5C,WAAL,CAAiB6C,IAAjB,CAAsB,IAAtB,CAAP,CACH,C,2BA9HuBvD,a,EAkI5B,GAAMwD,CAAAA,4BAA4B,CAAGtD,eAAe,CAAC,QAAD,CAAf,CAA0BK,aAA1B,CAArC,CACA,cAAeiD,CAAAA,4BAAf","sourcesContent":["import BaseComponent from '../../BaseComponent';\r\nimport ResetPasswordJsx from './ResetPassword.jsx';\r\nimport { withTranslation } from 'react-i18next';\r\nimport ResetPasswordValidate from './ResetPasswordValidate';\r\nimport Libs from '../../../utils/Libs';\r\nimport Constants from '../../../utils/Constants';\r\nimport EmployeeService from '../../../services/EmployeeService';\r\n\r\nclass ResetPassword extends BaseComponent {\r\n\r\n    constructor(props, context) {\r\n        super(props, context);\r\n        this.jsxTemplate = ResetPasswordJsx;\r\n        this.state = {\r\n            curItem: {}\r\n        };\r\n    }\r\n\r\n    async onSaveAction() {\r\n        var { t } = this.props;\r\n        let curItem = this.state.curItem, self = this;\r\n        var errorFlag = false;\r\n        var token = '';\r\n        if (Libs.isBlank(this.props) || Libs.isBlank(this.props.location) || Libs.isBlank(this.props.location.search)) {\r\n            window.location.href = Constants.SITE_URL.LOGIN;\r\n        }\r\n        token = this.props.location.search;\r\n        token = token.replace(\"?token=\", \"\");\r\n\r\n        if (Libs.isBlank(token)) {\r\n            window.location.href = Constants.SITE_URL.LOGIN;\r\n        }\r\n\r\n        let user = {\r\n            password: Libs.SHA3(curItem.password),\r\n            token: token\r\n        };\r\n\r\n        let v = new ResetPasswordValidate(this.props);\r\n        let errors = await v.FLValidationAll(curItem);\r\n        if (!Libs.isBlank(curItem.password) || !Libs.isBlank(curItem.password_confirm)) {\r\n            const regexp = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;\r\n            var password = curItem.password;\r\n            if (password.length < 8 || regexp.exec(password) === null) {\r\n                errors = Object.assign(Libs.isObjectEmpty(errors) ? {} : errors, { password: t('employee.password_valid_min_8character') });\r\n                errorFlag = true;\r\n            } else {\r\n                if (!Libs.isObjectEmpty(errors)) {\r\n                    delete errors[password];\r\n                }\r\n                errorFlag = false;\r\n            }\r\n\r\n            var password_confirm = curItem.password_confirm;\r\n            if (password_confirm !== password || Libs.isBlank(curItem.password_confirm)) {\r\n                errors = Object.assign(Libs.isObjectEmpty(errors) ? {} : errors, { password_confirm: t('employee.password_incorrect') });\r\n                errorFlag = true;\r\n            } else {\r\n                errorFlag = false;\r\n                if (!Libs.isObjectEmpty(errors)) {\r\n                    delete errors[password_confirm];\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        if (errors) {\r\n            this.setValidateMessage(errors, true);\r\n            errorFlag = true;\r\n            return;\r\n        }\r\n        //remove message validation\r\n        this.removeAllValidateMessage();\r\n        if (errorFlag) {\r\n            return;\r\n        }\r\n\r\n\r\n        EmployeeService.instance.getResetPassword(user, function (data, status, mess) {\r\n            if (!Libs.isObjectEmpty(data)) {\r\n                self.toast(mess, \"info\");\r\n                setTimeout(\r\n                    function () { window.location.href = Constants.SITE_URL.LOGIN; }.bind(this), 2000\r\n                );\r\n            }\r\n            else {\r\n                self.toast(mess, \"error\");\r\n            }\r\n        }, false);\r\n    }\r\n\r\n\r\n    /**\r\n     * @description validate a field input\r\n     * @author Long.Pham 13/06/2021\r\n     * @param {*} event \r\n     */\r\n    async validateOne(event) {\r\n        var { t } = this.props;\r\n        let target = event.target;\r\n        let name = target.name;\r\n        let value = target.value;\r\n        var curItem = this.state.curItem;\r\n        if (name) {\r\n            let param = {\r\n                [name]: value\r\n            }\r\n            let v = new ResetPasswordValidate(this.props);\r\n            let error = await v.validateOne(param, name);\r\n            const regexp = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;\r\n            if (name === 'password') {\r\n                if (value.length < 8 || regexp.exec(value) === null) {\r\n                    error = { password: t('employee.password_valid_min_8character') };\r\n                } else {\r\n                    error = { password: '' };\r\n                }\r\n            }\r\n\r\n            if (name === 'password_confirm' && Libs.isBlank(error.password_confirm)) {\r\n                if (curItem.password !== value) {\r\n                    error = { password_confirm: t('employee.password_incorrect') };\r\n                } else {\r\n                    error = { password_confirm: '' };\r\n                }\r\n            }\r\n\r\n            if (error != null) {\r\n                this.setValidateMessage(error, true);\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return this.jsxTemplate.call(this);\r\n    }\r\n\r\n}\r\n\r\nconst HighOrderComponentTranslated = withTranslation('common')(ResetPassword)\r\nexport default HighOrderComponentTranslated;"]},"metadata":{},"sourceType":"module"}