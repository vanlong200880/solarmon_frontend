{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Volumes/Data/sources/solarmon_production/solarmon_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import BaseComponent from'../../../../BaseComponent';import Libs from'../../../../../utils/Libs';import Constants from'../../../../../utils/Constants';import AddPopupJsx from'./AddPopup.jsx';import AddPopupValidate from'./AddPopupValidate';import RoleService from'../../../../../services/RoleService';import EmployeeService from'../../../../../services/EmployeeService';var AddPopup=/*#__PURE__*/function(_BaseComponent){_inherits(AddPopup,_BaseComponent);var _super=_createSuper(AddPopup);function AddPopup(props){var _this;_classCallCheck(this,AddPopup);_this=_super.call(this,props);_this.onFileAvatarChange=function(event){var t=_this.props.t;var target=event.target;var file=target.files[0];if(!file||file===undefined||file===null)return;var fileName=file.name,fileSize=file.size;var checkExtFile=Libs.checkExtensionFile(fileName,1);var msgAvatarError=null;if(!checkExtFile){msgAvatarError=t('message.msg_err_ext_image_file');}else if(fileSize<=0){msgAvatarError=t('message.msg_err_file_size');}else if(fileSize>Constants.COMMON.MAX_IMAGE_SIZE){msgAvatarError=t('message.msg_err_max_size_upload');}var self=_assertThisInitialized(_this);var curItem=_this.state.curItem;if(!Libs.isBlank(msgAvatarError)){curItem.file_upload='';curItem.file_message=msgAvatarError;_this.setState({curItem:curItem});return;}else{curItem.file_message='';_this.setState({curItem:curItem});}//Read file upload\nvar reader=new FileReader();reader.onload=function(e){curItem.file_upload=e.target.result;curItem.file_name=fileName;self.setState({curItem:curItem});};reader.readAsDataURL(file);};_this.onClickDeleteAvatar=function(event){var curItem=_this.state.curItem;curItem.file_message='';curItem.file_upload='';curItem.avatar_full=null;curItem.avatar=null;_this.setState({curItem:curItem});};_this.state={curItem:_this.props.curItem,allLanguage:_this.props.allLanguage,dataRoles:[],dataRegency:[]};_this.jsxTemplate=AddPopupJsx;return _this;}/**\n     * @description Called immediately after the component is mounted in the DOM. Called after the render function\n     * @author Long.Pham 12/05/2021\n     */_createClass(AddPopup,[{key:\"componentDidMount\",value:function componentDidMount(){var curItem=this.state.curItem;if(curItem.screen_mode===Constants.SCREEN_MODE.ADD){curItem.status=1;curItem.role_data=[];curItem.regency_data=[];}this.getDataRole();// this.getDataRegency();\n}/**\n     * setValue method to Input\n     * @author Long.Pham 2019-01-17\n     */},{key:\"handleRoleInputChange\",value:function handleRoleInputChange(event,index){var target=event.target;var name=target.name;var value=target.value;if(target.type==='checkbox'){value=target.checked?1:0;}if(name){var _this$state=this.state,curItem=_this$state.curItem,dataRoles=_this$state.dataRoles;var role_data=curItem.role_data;var item=dataRoles[index];if(Libs.isObjectEmpty(item))return;if(value===1){role_data.push({id_employee:'',id_role:item.id});}else{if(Libs.isArrayData(role_data)){role_data.map(function(v,index){if(v.id_role===item.id){role_data.splice(index,1);}});}}dataRoles[index].is_checked=value;curItem.role_data=role_data;if(Libs.isArrayData(role_data)){curItem.role_message=null;}this.setState({curItem:curItem,dataRoles:dataRoles});}}/**\n     * setValue method to Input\n     * @author Long.Pham 2019-01-17\n     */},{key:\"handleRegencyInputChange\",value:function handleRegencyInputChange(event,index){var target=event.target;var name=target.name;var value=target.value;if(target.type==='checkbox'){value=target.checked?1:0;}if(name){var _this$state2=this.state,curItem=_this$state2.curItem,dataRegency=_this$state2.dataRegency;var regency_data=curItem.regency_data;var item=dataRegency[index];if(Libs.isObjectEmpty(item))return;if(value===1){regency_data.push({id_employee:'',id_regency:item.id});}else{if(Libs.isArrayData(regency_data)){regency_data.map(function(k,index){if(k.id_regency===item.id){regency_data.splice(index,1);}});}}dataRegency[index].is_checked=value;curItem.regency_data=regency_data;this.setState({curItem:curItem,dataRegency:dataRegency});}}/**\n    * ge list roles\n    * @author Long.Pham 2019-06-03\n    */},{key:\"getDataRole\",value:function getDataRole(){var self=this;var params={id_language:this.employee.id_language};RoleService.instance.getDropdownList(params,function(data,total_row){if(Libs.isArrayData(data)){self.setState({dataRoles:data},function(){var curItem=self.state.curItem;if(curItem.screen_mode==Constants.SCREEN_MODE.EDIT){var dataRoles=self.state.dataRoles;if(Libs.isArrayData(dataRoles)){dataRoles.map(function(v,i){var findItem=Libs.find(curItem.role_data,'id_role',v.id);if(!Libs.isObjectEmpty(findItem)){dataRoles[i].is_checked=1;}});}self.setState({dataRoles:dataRoles});}});}});}},{key:\"generatePassword\",value:function generatePassword(){var curItem=this.state.curItem;var password=Libs.generateStrRandom(2,2,2,2);curItem.password=password;curItem.password_confirm=password;this.setState({curItem:curItem});this.setValidateMessage({password:''},true);this.setValidateMessage({password_confirm:''},true);}/**\n     * @description Upload icon  \n     * @author Long.Pham 12/05/2021\n     */},{key:\"validateOne\",value:/**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */function(){var _validateOne=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var t,target,name,value,curItem,param,v,error,regexp;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:t=this.props.t;target=event.target;name=target.name;value=target.value;curItem=this.state.curItem;if(!name){_context.next=15;break;}param=_defineProperty({},name,value);v=new AddPopupValidate(this.props);_context.next=10;return v.validateOne(param,name);case 10:error=_context.sent;regexp=/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;if(name==='password'){if(value.length<8||regexp.exec(value)===null){error={password:t('employee.password_valid_min_8character')};}else{error={password:''};}}if(name==='password_confirm'&&Libs.isBlank(error.password_confirm)){if(curItem.password!==value){error={password_confirm:t('employee.password_incorrect')};}else{error={password_confirm:''};}}if(error!=null){this.setValidateMessage(error,true);}case 15:case\"end\":return _context.stop();}}},_callee,this);}));function validateOne(_x){return _validateOne.apply(this,arguments);}return validateOne;}()/**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */},{key:\"onSave\",value:function(){var _onSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var t,curItem,self,params,errorFlag,screenMode,v,errors,regexp,password,password_confirm;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:t=this.props.t;curItem=this.state.curItem,self=this;params=Object.assign({},curItem);errorFlag=false;screenMode=!Libs.isBlank(curItem.id)?Constants.SCREEN_MODE.EDIT:!Libs.isBlank(this.props.curItem.screen_mode)?this.props.curItem.screen_mode:Constants.SCREEN_MODE.ADD;v=new AddPopupValidate(this.props);_context2.next=8;return v.FLValidationAll(curItem);case 8:errors=_context2.sent;if(screenMode===Constants.SCREEN_MODE.ADD||!Libs.isBlank(curItem.password)||!Libs.isBlank(curItem.password_confirm)){regexp=/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;password=curItem.password;if(password.length<8||regexp.exec(password)===null){errors=Object.assign(Libs.isObjectEmpty(errors)?{}:errors,{password:t('employee.password_valid_min_8character')});errorFlag=true;}else{if(!Libs.isObjectEmpty(errors)){delete errors[password];}errorFlag=false;}password_confirm=curItem.password_confirm;if(password_confirm!==password||Libs.isBlank(curItem.password_confirm)){errors=Object.assign(Libs.isObjectEmpty(errors)?{}:errors,{password_confirm:t('employee.password_incorrect')});errorFlag=true;}else{errorFlag=false;if(!Libs.isObjectEmpty(errors)){delete errors[password_confirm];}}}if(!Libs.isArrayData(curItem.role_data)){curItem.role_message=t('employee.role_data');self.setState({curItem:curItem},function(){self.toast(t('employee.role_data'),\"error\");});errorFlag=true;}else{curItem.role_message=null;errorFlag=false;self.setState({curItem:curItem});}if(!errors){_context2.next=15;break;}this.setValidateMessage(errors,true);errorFlag=true;return _context2.abrupt(\"return\");case 15://remove message validation\nthis.removeAllValidateMessage();if(!errorFlag){_context2.next=18;break;}return _context2.abrupt(\"return\");case 18:params.screen_mode=screenMode;params.id_language=this.employee.id_language;params.iso_code=this.employee.iso_code;params.password=Libs.SHA3(curItem.password);params.created_by=this.employee.first_name+\" \"+this.employee.last_name;EmployeeService.instance.save(params,function(status,data,msg){if(status){self.toast(msg,\"info\");self.props.onClickCloseAdd(true);}else if(data){self.setValidateMessage(data);}else if(!Libs.isBlank(msg)){self.toast(msg,\"error\");}},true);case 24:case\"end\":return _context2.stop();}}},_callee2,this);}));function onSave(){return _onSave.apply(this,arguments);}return onSave;}()}]);return AddPopup;}(BaseComponent);export default AddPopup;","map":{"version":3,"sources":["/Volumes/Data/sources/solarmon_production/solarmon_frontend/src/containers/views/desktop/ModuleSystem/Employees/AddPopup.js"],"names":["BaseComponent","Libs","Constants","AddPopupJsx","AddPopupValidate","RoleService","EmployeeService","AddPopup","props","onFileAvatarChange","event","t","target","file","files","undefined","fileName","name","fileSize","size","checkExtFile","checkExtensionFile","msgAvatarError","COMMON","MAX_IMAGE_SIZE","self","curItem","state","isBlank","file_upload","file_message","setState","reader","FileReader","onload","e","result","file_name","readAsDataURL","onClickDeleteAvatar","avatar_full","avatar","allLanguage","dataRoles","dataRegency","jsxTemplate","screen_mode","SCREEN_MODE","ADD","status","role_data","regency_data","getDataRole","index","value","type","checked","item","isObjectEmpty","push","id_employee","id_role","id","isArrayData","map","v","splice","is_checked","role_message","id_regency","k","params","id_language","employee","instance","getDropdownList","data","total_row","EDIT","i","findItem","find","password","generateStrRandom","password_confirm","setValidateMessage","param","validateOne","error","regexp","length","exec","Object","assign","errorFlag","screenMode","FLValidationAll","errors","toast","removeAllValidateMessage","iso_code","SHA3","created_by","first_name","last_name","save","msg","onClickCloseAdd"],"mappings":"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","sourcesContent":["\nimport BaseComponent from '../../../../BaseComponent';\nimport Libs from '../../../../../utils/Libs';\nimport Constants from '../../../../../utils/Constants';\nimport AddPopupJsx from './AddPopup.jsx';\nimport AddPopupValidate from './AddPopupValidate';\nimport RoleService from '../../../../../services/RoleService';\nimport EmployeeService from '../../../../../services/EmployeeService';\n\nclass AddPopup extends BaseComponent {\n    constructor(props) {\n        super(props);\n        this.state = {\n            curItem: this.props.curItem,\n            allLanguage: this.props.allLanguage,\n            dataRoles: [],\n            dataRegency: []\n        }\n\n        this.jsxTemplate = AddPopupJsx;\n    }\n    /**\n     * @description Called immediately after the component is mounted in the DOM. Called after the render function\n     * @author Long.Pham 12/05/2021\n     */\n    componentDidMount() {\n        var curItem = this.state.curItem;\n        if (curItem.screen_mode === Constants.SCREEN_MODE.ADD) {\n            curItem.status = 1;\n            curItem.role_data = [];\n            curItem.regency_data = [];\n        }\n        this.getDataRole();\n        // this.getDataRegency();\n    }\n\n    /**\n     * setValue method to Input\n     * @author Long.Pham 2019-01-17\n     */\n    handleRoleInputChange(event, index) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value;\n        if (target.type === 'checkbox') {\n            value = target.checked ? 1 : 0;\n        }\n        if (name) {\n            let { curItem, dataRoles } = this.state;\n\n            var role_data = curItem.role_data;\n            var item = dataRoles[index];\n            if (Libs.isObjectEmpty(item)) return;\n\n            if (value === 1) {\n                role_data.push({\n                    id_employee: '',\n                    id_role: item.id\n                });\n            } else {\n                if (Libs.isArrayData(role_data)) {\n                    role_data.map((v, index) => {\n                        if (v.id_role === item.id) {\n                            role_data.splice(index, 1);\n                        }\n                    })\n                }\n            }\n\n            dataRoles[index].is_checked = value;\n            curItem.role_data = role_data;\n\n            if (Libs.isArrayData(role_data)) {\n                curItem.role_message = null;\n            }\n\n            this.setState({\n                curItem: curItem,\n                dataRoles: dataRoles\n            });\n        }\n    }\n\n\n    /**\n     * setValue method to Input\n     * @author Long.Pham 2019-01-17\n     */\n    handleRegencyInputChange(event, index) {\n        let target = event.target;\n        let name = target.name;\n        let value = target.value;\n        if (target.type === 'checkbox') {\n            value = target.checked ? 1 : 0;\n        }\n        if (name) {\n            let { curItem, dataRegency } = this.state;\n\n            var regency_data = curItem.regency_data;\n            var item = dataRegency[index];\n            if (Libs.isObjectEmpty(item)) return;\n\n            if (value === 1) {\n                regency_data.push({\n                    id_employee: '',\n                    id_regency: item.id\n                });\n            } else {\n                \n                if (Libs.isArrayData(regency_data)) {\n                    regency_data.map((k, index) => {\n                        if (k.id_regency === item.id) {\n                            regency_data.splice(index, 1);\n                        }\n                    })\n                }\n            }\n\n            dataRegency[index].is_checked = value;\n            curItem.regency_data = regency_data;\n            this.setState({\n                curItem: curItem,\n                dataRegency: dataRegency\n            });\n        }\n    }\n\n\n    /**\n    * ge list roles\n    * @author Long.Pham 2019-06-03\n    */\n    getDataRole() {\n        let self = this;\n        var params = {\n            id_language: this.employee.id_language\n        };\n\n        RoleService.instance.getDropdownList(params, (data, total_row) => {\n            if (Libs.isArrayData(data)) {\n                self.setState({\n                    dataRoles: data\n                }, () => {\n                    let curItem = self.state.curItem;\n\n                    if (curItem.screen_mode == Constants.SCREEN_MODE.EDIT) {\n\n                        var dataRoles = self.state.dataRoles;\n                        if (Libs.isArrayData(dataRoles)) {\n                            dataRoles.map((v, i) => {\n                                var findItem = Libs.find(curItem.role_data, 'id_role', v.id);\n                                if (!Libs.isObjectEmpty(findItem)) {\n                                    dataRoles[i].is_checked = 1;\n                                }\n                            })\n                        }\n                        self.setState({\n                            dataRoles: dataRoles\n                        });\n                    }\n                });\n            }\n        })\n    }\n\n\n    generatePassword() {\n        var curItem = this.state.curItem;\n        var password = Libs.generateStrRandom(2, 2, 2, 2);\n        curItem.password = password;\n        curItem.password_confirm = password;\n        this.setState({ curItem: curItem });\n        this.setValidateMessage({ password: '' }, true);\n        this.setValidateMessage({ password_confirm: '' }, true);\n    }\n\n    /**\n     * @description Upload icon  \n     * @author Long.Pham 12/05/2021\n     */\n    onFileAvatarChange = (event) => {\n        var { t } = this.props;\n        var target = event.target;\n        var file = target.files[0];\n        if (!file || file === undefined || file === null) return;\n        var fileName = file.name, fileSize = file.size;\n        var checkExtFile = Libs.checkExtensionFile(fileName, 1);\n        var msgAvatarError = null;\n        if (!checkExtFile) {\n            msgAvatarError = t('message.msg_err_ext_image_file')\n        }\n        else if (fileSize <= 0) {\n            msgAvatarError = t('message.msg_err_file_size');\n        }\n        else if (fileSize > Constants.COMMON.MAX_IMAGE_SIZE) {\n            msgAvatarError = t('message.msg_err_max_size_upload');\n        }\n\n        var self = this;\n        var { curItem } = this.state;\n        if (!Libs.isBlank(msgAvatarError)) {\n            curItem.file_upload = '';\n            curItem.file_message = msgAvatarError;\n            this.setState({\n                curItem: curItem\n            });\n\n            return;\n        } else {\n            curItem.file_message = '';\n            this.setState({\n                curItem: curItem\n            });\n        }\n\n        //Read file upload\n        var reader = new FileReader();\n        reader.onload = function (e) {\n            curItem.file_upload = e.target.result;\n            curItem.file_name = fileName;\n            self.setState({\n                curItem: curItem\n            });\n        };\n        reader.readAsDataURL(file);\n    }\n\n\n    /**\n     * @description Delete icon upload \n     * @author Long.Pham 12/05/2021\n     */\n    onClickDeleteAvatar = (event) => {\n        var { curItem } = this.state;\n        curItem.file_message = '';\n        curItem.file_upload = '';\n        curItem.avatar_full = null;\n        curItem.avatar = null;\n\n        this.setState({\n            curItem: curItem\n        });\n    }\n\n\n\n    /**\n     * @description validate a field input\n     * @author Long.Pham 12/05/2021\n     * @param {*} event \n     */\n    async validateOne(event) {\n        var { t } = this.props;\n        let target = event.target;\n        let name = target.name;\n        let value = target.value;\n        var curItem = this.state.curItem;\n        if (name) {\n            let param = {\n                [name]: value\n            }\n            let v = new AddPopupValidate(this.props);\n            let error = await v.validateOne(param, name);\n            const regexp = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;\n            if (name === 'password') {\n                if (value.length < 8 || regexp.exec(value) === null) {\n                    error = { password: t('employee.password_valid_min_8character') };\n                } else {\n                    error = { password: '' };\n                }\n            }\n\n            if (name === 'password_confirm' && Libs.isBlank(error.password_confirm)) {\n                if (curItem.password !== value) {\n                    error = { password_confirm: t('employee.password_incorrect') };\n                } else {\n                    error = { password_confirm: '' };\n                }\n            }\n\n            if (error != null) {\n                this.setValidateMessage(error, true);\n            }\n        }\n    }\n\n\n    /**\n     * @description save data\n     * @author long.pham 12/05/2021\n     */\n    async onSave() {\n        var { t } = this.props;\n        var curItem = this.state.curItem, self = this;\n        var params = Object.assign({}, curItem);\n        var errorFlag = false;\n        var screenMode = (!Libs.isBlank(curItem.id)) ? Constants.SCREEN_MODE.EDIT : ((!Libs.isBlank(this.props.curItem.screen_mode)) ? this.props.curItem.screen_mode : Constants.SCREEN_MODE.ADD);\n        let v = new AddPopupValidate(this.props);\n        let errors = await v.FLValidationAll(curItem);\n\n        if (screenMode === Constants.SCREEN_MODE.ADD || !Libs.isBlank(curItem.password) || !Libs.isBlank(curItem.password_confirm)) {\n            const regexp = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/;\n            var password = curItem.password;\n            if (password.length < 8 || regexp.exec(password) === null) {\n                errors = Object.assign(Libs.isObjectEmpty(errors) ? {} : errors, { password: t('employee.password_valid_min_8character') });\n                errorFlag = true;\n            } else {\n                if (!Libs.isObjectEmpty(errors)) {\n                    delete errors[password];\n                }\n                errorFlag = false;\n            }\n\n            var password_confirm = curItem.password_confirm;\n            if (password_confirm !== password || Libs.isBlank(curItem.password_confirm)) {\n                errors = Object.assign(Libs.isObjectEmpty(errors) ? {} : errors, { password_confirm: t('employee.password_incorrect') });\n                errorFlag = true;\n            } else {\n                errorFlag = false;\n                if (!Libs.isObjectEmpty(errors)) {\n                    delete errors[password_confirm];\n                }\n            }\n        }\n\n\n\n        if (!Libs.isArrayData(curItem.role_data)) {\n            curItem.role_message = t('employee.role_data');\n            self.setState({\n                curItem: curItem\n            }, () => {\n                self.toast(t('employee.role_data'), \"error\");\n            });\n            errorFlag = true;\n\n        } else {\n            curItem.role_message = null;\n            errorFlag = false;\n            self.setState({\n                curItem: curItem\n            });\n        }\n\n        if (errors) {\n            this.setValidateMessage(errors, true);\n            errorFlag = true;\n            return;\n        }\n        //remove message validation\n        this.removeAllValidateMessage();\n        if (errorFlag) {\n            return;\n        }\n        \n        params.screen_mode = screenMode;\n        params.id_language = this.employee.id_language;\n        params.iso_code = this.employee.iso_code;\n        params.password = Libs.SHA3(curItem.password);\n        params.created_by = this.employee.first_name + \" \" + this.employee.last_name;\n\n        EmployeeService.instance.save(params, function (status, data, msg) {\n            if (status) {\n                self.toast(msg, \"info\");\n                self.props.onClickCloseAdd(true);\n            }\n            else if (data) {\n                self.setValidateMessage(data);\n            }\n            else if (!Libs.isBlank(msg)) {\n                self.toast(msg, \"error\");\n            }\n        }, true);\n    }\n}\nexport default AddPopup;"]},"metadata":{},"sourceType":"module"}